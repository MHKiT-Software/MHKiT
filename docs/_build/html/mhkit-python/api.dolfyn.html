

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-164358105-1');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DOLfYN Module &mdash; MHKiT v0.9.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5b801204" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=5ea31d45" />
      <link rel="stylesheet" type="text/css" href="../_static/css/mhkit.css?v=20290a2c" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c20ff342"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mooring Module" href="api.mooring.html" />
    <link rel="prev" title="Loads Module" href="api.loads.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MHKiT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">MHKiT-Python Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab_installation.html">MHKiT-MATLAB Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module.html">Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../api.html#mhkit-python-api">MHKiT-Python API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.qc.html">QC Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.wave.html">Wave Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.river.html">River Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.tidal.html">Tidal Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.power.html">Power Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.loads.html">Loads Module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">DOLfYN Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adp-submodule">ADP Submodule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adv-submodule">ADV Submodule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#io-submodule">IO Submodule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-submodule">Rotate Submodule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleaning-data">Cleaning Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#motion-correction">Motion Correction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#velocity-analysis">Velocity Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adv-turbulence-analysis">ADV Turbulence Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ad2cp-turbulence-analysis">AD2CP Turbulence Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tools">Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time">Time</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api.mooring.html">Mooring Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.utils.html">Utils Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.acoustics.html">Passive Acoustics Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#mhkit-matlab-api">MHKiT-MATLAB API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API Documentation</a></li>
      <li class="breadcrumb-item active">DOLfYN Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/mhkit-python/api.dolfyn.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dolfyn-module">
<span id="dolfyn-api"></span><h1>DOLfYN Module<a class="headerlink" href="#dolfyn-module" title="Link to this heading"></a></h1>
<p>The DOLfYN module contains a set of functions to analyze
binary Nortek or TRDI files. <strong>Instrument datafiles</strong> are
processed and returned as an xarray dataset.</p>
<p>There a couple ways to start using the dolfyn module. The
first way is to import the entire module using
<cite>import mhkit.dolfyn as dolfyn</cite>.
Many functions are directly available from the main dolfyn
import:</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read" title="mhkit.dolfyn.io.api.read"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read</span></code></a></p></td>
<td><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI (.000, .PD0, .ENX, etc.) data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read_example" title="mhkit.dolfyn.io.api.read_example"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_example</span></code></a></p></td>
<td><p>Read an ADCP or ADV datafile from the examples directory.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save" title="mhkit.dolfyn.io.api.save"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save</span></code></a></p></td>
<td><p>Save xarray dataset as netCDF (.nc).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load" title="mhkit.dolfyn.io.api.load"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></a></p></td>
<td><p>Load xarray dataset from netCDF (.nc)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save_mat" title="mhkit.dolfyn.io.api.save_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save_mat</span></code></a></p></td>
<td><p>Save xarray dataset as a MATLAB (.mat) file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load_mat" title="mhkit.dolfyn.io.api.load_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_mat</span></code></a></p></td>
<td><p>Load xarray dataset from MATLAB (.mat) file, complimentary to <cite>save_mat()</cite></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.rotate2" title="mhkit.dolfyn.rotate.api.rotate2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rotate2</span></code></a></p></td>
<td><p>Rotate a dataset to a new coordinate system.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.calc_principal_heading" title="mhkit.dolfyn.rotate.api.calc_principal_heading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_principal_heading</span></code></a></p></td>
<td><p>Compute the principal angle of the horizontal velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.set_declination" title="mhkit.dolfyn.rotate.api.set_declination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_declination</span></code></a></p></td>
<td><p>Set the magnetic declination</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.set_inst2head_rotmat" title="mhkit.dolfyn.rotate.api.set_inst2head_rotmat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_inst2head_rotmat</span></code></a></p></td>
<td><p>Set the instrument to head rotation matrix for the Nortek ADV if it hasn't already been set through a '.userdata.json' file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.euler2orient" title="mhkit.dolfyn.rotate.base.euler2orient"><code class="xref py py-obj docutils literal notranslate"><span class="pre">euler2orient</span></code></a></p></td>
<td><p>Calculate the orientation matrix from DOLfYN-defined euler angles.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.orient2euler" title="mhkit.dolfyn.rotate.base.orient2euler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">orient2euler</span></code></a></p></td>
<td><p>Calculate DOLfYN-defined euler angles from the orientation matrix.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.quaternion2orient" title="mhkit.dolfyn.rotate.base.quaternion2orient"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quaternion2orient</span></code></a></p></td>
<td><p>Calculate orientation from Nortek AHRS quaternions, where q = [W, X, Y, Z] instead of the standard q = [X, Y, Z, W] = [q1, q2, q3, q4]</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">VelBinner</span></code></a></p></td>
<td><p>This is the base binning (averaging) tool.</p></td>
</tr>
</tbody>
</table>
<section id="adp-submodule">
<h2>ADP Submodule<a class="headerlink" href="#adp-submodule" title="Link to this heading"></a></h2>
<p>The other two ways are to import the instrument-specific
modules.
The ADP module contains routines for reading and working with
ADP/ADCP data and is imported using
<cite>from mhkit.dolfyn.adp import api</cite>. It contains:</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">read</span></code></p></td>
<td><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI (.000, .PD0, .ENX, etc.) data file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></p></td>
<td><p>Load xarray dataset from netCDF (.nc)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">rotate2</span></code></p></td>
<td><p>Rotate a dataset to a new coordinate system.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_principal_heading</span></code></p></td>
<td><p>Compute the principal angle of the horizontal velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">clean</span></code></p></td>
<td><p>Module containing functions to clean data.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">VelBinner</span></code></p></td>
<td><p>This is the base binning (averaging) tool.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ADPBinner</span></code></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="adv-submodule">
<h2>ADV Submodule<a class="headerlink" href="#adv-submodule" title="Link to this heading"></a></h2>
<p>The ADV module contains routines for reading and working with
ADV data and is imported using
<cite>from mhkit.dolfyn.adv import api</cite>. It contains:</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">read</span></code></p></td>
<td><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI (.000, .PD0, .ENX, etc.) data file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></p></td>
<td><p>Load xarray dataset from netCDF (.nc)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">rotate2</span></code></p></td>
<td><p>Rotate a dataset to a new coordinate system.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_principal_heading</span></code></p></td>
<td><p>Compute the principal angle of the horizontal velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_inst2head_rotmat</span></code></p></td>
<td><p>Set the instrument to head rotation matrix for the Nortek ADV if it hasn't already been set through a '.userdata.json' file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">clean</span></code></p></td>
<td><p>Module containing functions to clean data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">correct_motion</span></code></p></td>
<td><p>This function performs motion correction on an IMU-ADV data object.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">VelBinner</span></code></p></td>
<td><p>This is the base binning (averaging) tool.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ADVBinner</span></code></p></td>
<td><p>A class that builds upon <cite>VelBinner</cite> for calculating turbulence statistics and velocity spectra from ADV data</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">turbulence_statistics</span></code></p></td>
<td><p>Functional version of <cite>ADVBinner</cite> that computes a suite of turbulence statistics for the input dataset, and returns a <cite>binned</cite> data object.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="io-submodule">
<h2>IO Submodule<a class="headerlink" href="#io-submodule" title="Link to this heading"></a></h2>
<p>The io submodule contains the following functions to read
binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or TRDI
(.000, .PD0, .ENX, etc.) data file.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read" title="mhkit.dolfyn.io.api.read"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read</span></code></a></p></td>
<td><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI (.000, .PD0, .ENX, etc.) data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read_example" title="mhkit.dolfyn.io.api.read_example"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_example</span></code></a></p></td>
<td><p>Read an ADCP or ADV datafile from the examples directory.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save" title="mhkit.dolfyn.io.api.save"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save</span></code></a></p></td>
<td><p>Save xarray dataset as netCDF (.nc).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load" title="mhkit.dolfyn.io.api.load"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></a></p></td>
<td><p>Load xarray dataset from netCDF (.nc)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save_mat" title="mhkit.dolfyn.io.api.save_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save_mat</span></code></a></p></td>
<td><p>Save xarray dataset as a MATLAB (.mat) file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load_mat" title="mhkit.dolfyn.io.api.load_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_mat</span></code></a></p></td>
<td><p>Load xarray dataset from MATLAB (.mat) file, complimentary to <cite>save_mat()</cite></p></td>
</tr>
</tbody>
</table>
<dl class="py function" id="module-mhkit.dolfyn.io.api">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.read">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.read" title="Link to this definition"></a></dt>
<dd><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI
(.000, .PD0, .ENX, etc.) data file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – Filename of instrument file to read.</p></li>
<li><p><strong>userdata</strong> (True, False, or string of userdata.json filename (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)) – Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.</p></li>
<li><p><strong>nens</strong> (<em>None</em><em>, </em><em>int</em><em> or </em><em>2-element tuple</em><em> (</em><em>start</em><em>, </em><em>stop</em><em>)</em>) – Number of pings or ensembles to read from the file.
Default is None, read entire file</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – Passed to instrument-specific parser.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from instrument datafile.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.read_example">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">read_example</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#read_example"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.read_example" title="Link to this definition"></a></dt>
<dd><p>Read an ADCP or ADV datafile from the examples directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – <p>A few available files:</p>
<blockquote>
<div><p>AWAC_test01.wpr
BenchFile01.ad2cp
RDI_test01.000
vector_burst_mode01.VEC
vector_data01.VEC
vector_data_imu01.VEC
winriver01.PD0
winriver02.PD0</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.save">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NETCDF4'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'netcdf4'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compression</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.save" title="Link to this definition"></a></dt>
<dd><p>Save xarray dataset as netCDF (.nc).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Dataset to save</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.nc’ extension</p></li>
<li><p><strong>compression</strong> (<em>bool</em>) – When true, compress all variables with zlib complevel=1.
Default is False</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – These are passed directly to <code class="xref py py-func docutils literal notranslate"><span class="pre">xarray.Dataset.to_netcdf()</span></code></p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Drops ‘config’ lines.</p>
<p>Rewrites variable encoding dict</p>
<p>More detailed compression options can be specified by specifying
‘encoding’ in kwargs. The values in encoding will take precedence
over whatever is set according to the compression option above.
See the xarray.to_netcdf documentation for more details.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.load">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.load" title="Link to this definition"></a></dt>
<dd><p>Load xarray dataset from netCDF (.nc)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.nc’ extension</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.save_mat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">save_mat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datenum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#save_mat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.save_mat" title="Link to this definition"></a></dt>
<dd><p>Save xarray dataset as a MATLAB (.mat) file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Dataset to save</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.mat’ extension</p></li>
<li><p><strong>datenum</strong> (<em>bool</em>) – If true, converts time to datenum. If false, time will be saved
in “epoch time”.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The xarray data format is saved as a MATLAB structure with the fields
‘vars, coords, config, units’. Converts time to datenum</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.io.savemat</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.api.load_mat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.api.</span></span><span class="sig-name descname"><span class="pre">load_mat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datenum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#load_mat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.load_mat" title="Link to this definition"></a></dt>
<dd><p>Load xarray dataset from MATLAB (.mat) file, complimentary to <cite>save_mat()</cite></p>
<p>A .mat file must contain the fields: {vars, coords, config, units},
where ‘coords’ contain the dimensions of all variables in ‘vars’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.mat’ extension</p></li>
<li><p><strong>datenum</strong> (<em>bool</em>) – If true, converts time from datenum. If false, converts time from
“epoch time”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.io.loadmat</span></code></p>
</div>
</dd></dl>

<dl class="py function" id="module-mhkit.dolfyn.io.nortek">
<span id="module-mhkit.dolfyn.io.base"></span><dt class="sig sig-object py" id="mhkit.dolfyn.io.nortek.read_nortek">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.nortek.</span></span><span class="sig-name descname"><span class="pre">read_nortek</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_checksum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/nortek.html#read_nortek"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.nortek.read_nortek" title="Link to this definition"></a></dt>
<dd><p>Read a classic Nortek (AWAC and Vector) datafile</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – Filename of Nortek file to read.</p></li>
<li><p><strong>userdata</strong> (<em>bool</em><em>, or </em><em>string</em><em> of </em><em>userdata.json filename</em>) – Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.
Default = True</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) – Logs debugger ouput if true. Default = False</p></li>
<li><p><strong>do_checksum</strong> (<em>bool</em>) – Whether to perform the checksum of each data block. Default = False</p></li>
<li><p><strong>nens</strong> (<em>None</em><em>, </em><em>int</em><em> or </em><em>2-element tuple</em><em> (</em><em>start</em><em>, </em><em>stop</em><em>)</em>) – Number of pings or ensembles to read from the file.
Default is None, read entire file</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="py function" id="module-mhkit.dolfyn.io.nortek2">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.nortek2.read_signature">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.nortek2.</span></span><span class="sig-name descname"><span class="pre">read_signature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rebuild_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dual_profile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/nortek2.html#read_signature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.nortek2.read_signature" title="Link to this definition"></a></dt>
<dd><p>Read a Nortek Signature (.ad2cp) datafile</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – The filename of the file to load.</p></li>
<li><p><strong>userdata</strong> (<em>bool</em>) – To search for and use a .userdata.json or not</p></li>
<li><p><strong>nens</strong> (<em>None</em><em>, </em><em>int</em><em> or </em><em>2-element tuple</em><em> (</em><em>start</em><em>, </em><em>stop</em><em>)</em>) – Number of pings or ensembles to read from the file.
Default is None, read entire file</p></li>
<li><p><strong>rebuild_index</strong> (<em>bool</em>) – Force rebuild of dolfyn-written datafile index. Useful for code updates.
Default = False</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) – Logs debugger ouput if true. Default = False</p></li>
<li><p><strong>dual_profile</strong> (<em>bool</em>) – Set to true if instrument is running multiple profiles. Default = False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.nortek2.split_dp_datasets">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.nortek2.</span></span><span class="sig-name descname"><span class="pre">split_dp_datasets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/nortek2.html#split_dp_datasets"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.nortek2.split_dp_datasets" title="Link to this definition"></a></dt>
<dd><p>Splits a dataset containing dual profiles into individual profiles</p>
</dd></dl>

<dl class="py function" id="module-mhkit.dolfyn.io.rdi">
<dt class="sig sig-object py" id="mhkit.dolfyn.io.rdi.read_rdi">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.rdi.</span></span><span class="sig-name descname"><span class="pre">read_rdi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmdas_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">winriver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/rdi.html#read_rdi"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.io.rdi.read_rdi" title="Link to this definition"></a></dt>
<dd><p>Read a TRDI binary data file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – Filename of TRDI file to read.</p></li>
<li><p><strong>userdata</strong> (<em>True</em><em>, </em><em>False</em><em>, or </em><em>string</em><em> of </em><em>userdata.json filename</em>) – Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file. Default = True</p></li>
<li><p><strong>nens</strong> (<em>None</em><em>, </em><em>int</em><em> or </em><em>2-element tuple</em><em> (</em><em>start</em><em>, </em><em>stop</em><em>)</em>) – Number of pings or ensembles to read from the file.
Default is None, read entire file</p></li>
<li><p><strong>debug_level</strong> (<em>int</em>) – Debug level [0 - 2]. Default = -1</p></li>
<li><p><strong>vmdas_search</strong> (<em>bool</em>) – Search from the end of each ensemble for the VMDAS navigation
block.  The byte offsets are sometimes incorrect. Default = False</p></li>
<li><p><strong>winriver</strong> (<em>bool</em>) – If file is winriver or not. Automatically set by dolfyn, this is helpful
for debugging. Default = False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="rotate-submodule">
<h2>Rotate Submodule<a class="headerlink" href="#rotate-submodule" title="Link to this heading"></a></h2>
<p>The rotate submodule contains tools to rotate a dataset
to different coordinate systems. When a file is read into
dolfyn, the data will be stored in the same coordinate
system it was saved in. The different coordinate systems
are “beam” &lt;-&gt; “inst” &lt;-&gt; “earth” &lt;-&gt; “principal”. “Beam”
and “inst” are manufacturer/instrument specific and refer
to the along-beam (either 3 or 4 beams) and instrument (XYZ)
reference frame. Instrument reference frames differ across
sensors, but the rotate code takes this into account when
rotating into the “earth” frame, defined as East-North-Up
(ENU). The earth frame can then be rotated to the principal
axes, defined as streamwise-cross_stream-vertical.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.rotate2" title="mhkit.dolfyn.rotate.api.rotate2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rotate2</span></code></a></p></td>
<td><p>Rotate a dataset to a new coordinate system.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.calc_principal_heading" title="mhkit.dolfyn.rotate.api.calc_principal_heading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_principal_heading</span></code></a></p></td>
<td><p>Compute the principal angle of the horizontal velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.set_declination" title="mhkit.dolfyn.rotate.api.set_declination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_declination</span></code></a></p></td>
<td><p>Set the magnetic declination</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.set_inst2head_rotmat" title="mhkit.dolfyn.rotate.api.set_inst2head_rotmat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_inst2head_rotmat</span></code></a></p></td>
<td><p>Set the instrument to head rotation matrix for the Nortek ADV if it hasn't already been set through a '.userdata.json' file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.euler2orient" title="mhkit.dolfyn.rotate.base.euler2orient"><code class="xref py py-obj docutils literal notranslate"><span class="pre">euler2orient</span></code></a></p></td>
<td><p>Calculate the orientation matrix from DOLfYN-defined euler angles.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.orient2euler" title="mhkit.dolfyn.rotate.base.orient2euler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">orient2euler</span></code></a></p></td>
<td><p>Calculate DOLfYN-defined euler angles from the orientation matrix.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.quaternion2orient" title="mhkit.dolfyn.rotate.base.quaternion2orient"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quaternion2orient</span></code></a></p></td>
<td><p>Calculate orientation from Nortek AHRS quaternions, where q = [W, X, Y, Z] instead of the standard q = [X, Y, Z, W] = [q1, q2, q3, q4]</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.base.calc_tilt" title="mhkit.dolfyn.rotate.base.calc_tilt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_tilt</span></code></a></p></td>
<td><p>Calculate &quot;tilt&quot;, the vertical inclination, from pitch and roll.</p></td>
</tr>
</tbody>
</table>
<dl class="py function" id="module-mhkit.dolfyn.rotate.api">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.api.rotate2">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.api.</span></span><span class="sig-name descname"><span class="pre">rotate2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_frame</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'earth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#rotate2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.rotate2" title="Link to this definition"></a></dt>
<dd><p>Rotate a dataset to a new coordinate system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xr.Dataset</em>) – The dolfyn dataset (ADV or ADCP) to rotate.</p></li>
<li><p><strong>out_frame</strong> (<em>string {'beam'</em><em>, </em><em>'inst'</em><em>, </em><em>'earth'</em><em>, </em><em>'principal'}</em>) – The coordinate system to rotate the data into.</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.
Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new rotated dataset <strong>when ``inplace=False``</strong>, otherwise
returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul>
<li><p>This function rotates all variables in <code class="docutils literal notranslate"><span class="pre">ds.attrs['rotate_vars']</span></code>.</p></li>
<li><p>In order to rotate to the ‘principal’ frame, a value should exist for
<code class="docutils literal notranslate"><span class="pre">ds.attrs['principal_heading']</span></code>. The function
<code class="xref py py-func docutils literal notranslate"><span class="pre">calc_principal_heading</span></code>
is recommended for this purpose, e.g.:</p>
<blockquote>
<div><p>ds.attrs[‘principal_heading’] = dolfyn.calc_principal_heading(ds[‘vel’].mean(range))</p>
</div></blockquote>
<p>where here we are using the depth-averaged velocity to calculate
the principal direction.</p>
</li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.api.calc_principal_heading">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.api.</span></span><span class="sig-name descname"><span class="pre">calc_principal_heading</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tidal_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#calc_principal_heading"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.calc_principal_heading" title="Link to this definition"></a></dt>
<dd><p>Compute the principal angle of the horizontal velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<em>np.ndarray</em><em> (</em><em>2</em><em>,</em><em>...</em><em>,</em><em>Nt</em><em>)</em><em>, or </em><em>(</em><em>3</em><em>,</em><em>...</em><em>,</em><em>Nt</em><em>)</em>) – The 2D or 3D velocity array (3rd-dim is ignored in this calculation)</p></li>
<li><p><strong>tidal_mode</strong> (<em>bool</em>) – If true, range is set from 0 to +/-180 degrees. If false, range is 0 to
360 degrees. Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>p_heading</strong> (<em>float or ndarray</em>) – The principal heading in degrees clockwise from North.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>When tidal_mode=True, this tool calculates the heading that is
aligned with the bidirectional flow. It does so following these
steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>rotates vectors with negative velocity by 180 degrees</p></li>
<li><p>then doubles those angles to make a complete circle again</p></li>
<li><p>computes a mean direction from this, and halves that angle
(to undo the doubled-angles in step 2)</p></li>
<li><p>The returned angle is forced to be between 0 and 180. So, you
may need to add 180 to this if you want your positive
direction to be in the western-half of the plane.</p></li>
</ol>
</div></blockquote>
<p>Otherwise, this function simply computes the average direction
using a vector method.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.api.set_declination">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.api.</span></span><span class="sig-name descname"><span class="pre">set_declination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">declin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#set_declination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.set_declination" title="Link to this definition"></a></dt>
<dd><p>Set the magnetic declination</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (xarray.Dataset or <code class="xref py py-class docutils literal notranslate"><span class="pre">dolfyn.velocity.Velocity</span></code>) – The input dataset or velocity class</p></li>
<li><p><strong>declination</strong> (<em>float</em>) – The value of the magnetic declination in degrees (positive
values specify that Magnetic North is clockwise from True North)</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.
Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new dataset with declination set <strong>when
``inplace=False``</strong>, otherwise returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function modifies the data object in the following ways:</p>
<ul class="simple">
<li><p>If the dataset is in the <em>earth</em> reference frame at the time of
setting declination, it will be rotated into the “<em>True-East</em>,
<em>True-North</em>, Up” (hereafter, ETU) coordinate system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dat['orientmat']</span></code> is modified to be an ETU to
instrument (XYZ) rotation matrix (rather than the magnetic-ENU to
XYZ rotation matrix). Therefore, all rotations to/from the ‘earth’
frame will now be to/from this ETU coordinate system.</p></li>
<li><p>The value of the specified declination will be stored in
<code class="docutils literal notranslate"><span class="pre">dat.attrs['declination']</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dat['heading']</span></code> is adjusted for declination
(i.e., it is relative to True North).</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">dat.attrs['principal_heading']</span></code> is set, it is
adjusted to account for the orientation of the new ‘True’
earth coordinate system (i.e., calling set_declination on a
data object in the principal coordinate system, then calling
dat.rotate2(‘earth’) will yield a data object in the new
‘True’ earth coordinate system)</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.api.set_inst2head_rotmat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.api.</span></span><span class="sig-name descname"><span class="pre">set_inst2head_rotmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#set_inst2head_rotmat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.set_inst2head_rotmat" title="Link to this definition"></a></dt>
<dd><p>Set the instrument to head rotation matrix for the Nortek ADV if it
hasn’t already been set through a ‘.userdata.json’ file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The data set to assign inst2head_rotmat</p></li>
<li><p><strong>rotmat</strong> (<em>float</em>) – 3x3 rotation matrix</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.
Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new dataset with inst2head_rotmat set <strong>when
``inplace=False``</strong>, otherwise returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If the data object is in earth or principal coords, it is first
rotated to ‘inst’ before assigning inst2head_rotmat, it is then
rotated back to the coordinate system in which it was input. This
way the inst2head_rotmat gets applied correctly (in inst
coordinate system).</p>
</dd></dl>

<dl class="py function" id="module-mhkit.dolfyn.rotate.base">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.base.euler2orient">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.base.</span></span><span class="sig-name descname"><span class="pre">euler2orient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">heading</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pitch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roll</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'degree'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/base.html#euler2orient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.base.euler2orient" title="Link to this definition"></a></dt>
<dd><p>Calculate the orientation matrix from DOLfYN-defined euler angles.</p>
<p>This function is not likely to be called during data processing since it requires
DOLfYN-defined euler angles. It is intended for testing DOLfYN.</p>
<p>The matrices H, P, R are the transpose of the matrices for rotation about z, y, x
as shown here <a class="reference external" href="https://en.wikipedia.org/wiki/Rotation_matrix">https://en.wikipedia.org/wiki/Rotation_matrix</a>. The transpose is used
because in DOLfYN the orientation matrix is organized for
rotation from EARTH –&gt; INST, while the wiki’s matrices are organized for
rotation from INST –&gt; EARTH.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>heading</strong> (<em>numpy.ndarray</em>) – The heading angle.</p></li>
<li><p><strong>pitch</strong> (<em>numpy.ndarray</em>) – The pitch angle.</p></li>
<li><p><strong>roll</strong> (<em>numpy.ndarray</em>) – The roll angle.</p></li>
<li><p><strong>units</strong> (<em>str</em>) – Units in degrees or radians.  is ‘degrees’</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>omat</strong> (<em>numpy.ndarray (3x3xtime)</em>) – The orientation matrix of the data. The returned orientation
matrix obeys the following conventions:</p>
<blockquote>
<div><ul class="simple">
<li><p>a “ZYX” rotation order. That is, these variables are computed
assuming that rotation from the earth -&gt; instrument frame happens
by rotating around the z-axis first (heading), then rotating
around the y-axis (pitch), then rotating around the x-axis (roll).
Note this requires matrix multiplication in the reverse order.</p></li>
<li><p>heading is defined as the direction the x-axis points, positive
clockwise from North (this is <em>opposite</em> the right-hand-rule
around the Z-axis), range 0-360 degrees.</p></li>
<li><p>pitch is positive when the x-axis pitches up (this is <em>opposite</em> the
right-hand-rule around the Y-axis)</p></li>
<li><p>roll is positive according to the right-hand-rule around the
instrument’s x-axis</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.base.orient2euler">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.base.</span></span><span class="sig-name descname"><span class="pre">orient2euler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">omat</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/base.html#orient2euler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.base.orient2euler" title="Link to this definition"></a></dt>
<dd><p>Calculate DOLfYN-defined euler angles from the orientation matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>omat</strong> (<em>numpy.ndarray</em>) – The orientation matrix</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>heading</strong> (<em>numpy.ndarray</em>) – The heading angle. Heading is defined as the direction the x-axis points,
positive clockwise from North (this is <em>opposite</em> the right-hand-rule
around the Z-axis), range 0-360 degrees.</p></li>
<li><p><strong>pitch</strong> (<em>np.ndarray</em>) – The pitch angle (degrees). Pitch is positive when the x-axis
pitches up (this is <em>opposite</em> the right-hand-rule around the Y-axis).</p></li>
<li><p><strong>roll</strong> (<em>np.ndarray</em>) – The roll angle (degrees). Roll is positive according to the
right-hand-rule around the instrument’s x-axis.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.base.quaternion2orient">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.base.</span></span><span class="sig-name descname"><span class="pre">quaternion2orient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">quaternions</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/base.html#quaternion2orient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.base.quaternion2orient" title="Link to this definition"></a></dt>
<dd><p>Calculate orientation from Nortek AHRS quaternions, where q = [W, X, Y, Z]
instead of the standard q = [X, Y, Z, W] = [q1, q2, q3, q4]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>quaternions</strong> (<em>xarray.DataArray</em>) – Quaternion dataArray from the raw dataset</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>orientmat</strong> (<em>numpy.ndarray</em>) – The earth2inst rotation maxtrix as calculated from the quaternions</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.rotate.base.calc_tilt">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.base.</span></span><span class="sig-name descname"><span class="pre">calc_tilt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pitch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roll</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'degree'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/base.html#calc_tilt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.base.calc_tilt" title="Link to this definition"></a></dt>
<dd><p>Calculate “tilt”, the vertical inclination, from pitch and roll.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>roll</strong> (<em>numpy.ndarray</em><em> or </em><em>xarray.DataArray</em>) – Instrument roll in degrees</p></li>
<li><p><strong>pitch</strong> (<em>numpy.ndarray</em><em> or </em><em>xarray.DataArray</em>) – Instrument pitch in degrees</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tilt</strong> (<em>numpy.ndarray</em>) – Vertical inclination of the instrument in degrees</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="cleaning-data">
<h2>Cleaning Data<a class="headerlink" href="#cleaning-data" title="Link to this heading"></a></h2>
<p>The clean submodule contains basic quality control tools
specific to ADCP and ADVs.</p>
<section id="module-mhkit.dolfyn.adp.clean">
<span id="adp-cleaning"></span><h3>ADP Cleaning<a class="headerlink" href="#module-mhkit.dolfyn.adp.clean" title="Link to this heading"></a></h3>
<p>Module containing functions to clean data.</p>
<blockquote>
<div><table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.set_range_offset" title="mhkit.dolfyn.adp.clean.set_range_offset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_range_offset</span></code></a></p></td>
<td><p>Adds an instrument's height above seafloor (for an up-facing instrument) or depth below water surface (for a down-facing instrument) to the range coordinate.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.water_depth_from_amplitude" title="mhkit.dolfyn.adp.clean.water_depth_from_amplitude"><code class="xref py py-obj docutils literal notranslate"><span class="pre">water_depth_from_amplitude</span></code></a></p></td>
<td><p>Find the surface (water level or seafloor) from amplitude data and adds the variable &quot;depth&quot; to the input Dataset.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.water_depth_from_pressure" title="mhkit.dolfyn.adp.clean.water_depth_from_pressure"><code class="xref py py-obj docutils literal notranslate"><span class="pre">water_depth_from_pressure</span></code></a></p></td>
<td><p>Calculates the distance to the water surface.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.remove_surface_interference" title="mhkit.dolfyn.adp.clean.remove_surface_interference"><code class="xref py py-obj docutils literal notranslate"><span class="pre">remove_surface_interference</span></code></a></p></td>
<td><p>Mask the values of 3D data (vel, amp, corr, echo) that are beyond the surface.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.correlation_filter" title="mhkit.dolfyn.adp.clean.correlation_filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">correlation_filter</span></code></a></p></td>
<td><p>Filters out data where correlation is below a threshold in the along-beam correlation data.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.medfilt_orient" title="mhkit.dolfyn.adp.clean.medfilt_orient"><code class="xref py py-obj docutils literal notranslate"><span class="pre">medfilt_orient</span></code></a></p></td>
<td><p>Median filters the orientation data (heading-pitch-roll or quaternions)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.val_exceeds_thresh" title="mhkit.dolfyn.adp.clean.val_exceeds_thresh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">val_exceeds_thresh</span></code></a></p></td>
<td><p>Find values of a variable that exceed a threshold value, and assign &quot;val&quot; to the velocity data where the threshold is exceeded.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.fillgaps_time" title="mhkit.dolfyn.adp.clean.fillgaps_time"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fillgaps_time</span></code></a></p></td>
<td><p>Fill gaps (nan values) in var across time using the specified method</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.clean.fillgaps_depth" title="mhkit.dolfyn.adp.clean.fillgaps_depth"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fillgaps_depth</span></code></a></p></td>
<td><p>Fill gaps (nan values) in var along the depth profile using the specified method</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.set_range_offset">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">set_range_offset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">range_offset</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#set_range_offset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.set_range_offset" title="Link to this definition"></a></dt>
<dd><p>Adds an instrument’s height above seafloor (for an up-facing instrument)
or depth below water surface (for a down-facing instrument) to the range
coordinate. Also adds an attribute to the Dataset with the current
“range_offset” distance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The ADCP dataset to adjust ‘range’ on</p></li>
<li><p><strong>range_offset</strong> (<em>numeric</em>) – Deployment location in the water column, in [m]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The ADCP dataset with applied range_offset</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p><cite>Center of bin 1 = range_offset + blank_dist + cell_size</cite></p>
<p>Nortek doesn’t take <cite>range_offset</cite> into account, so the range that DOLfYN
calculates distance is from the ADCP transducers. TRDI asks for <cite>range_offset</cite>
input in their deployment software and is thereby known by DOLfYN.</p>
<p>If the ADCP is mounted on a tripod on the seafloor, <cite>range_offset</cite> will be
the height of the tripod +/- any extra distance to the transducer faces.
If the instrument is vessel-mounted, <cite>range_offset</cite> is the distance between
the surface and downward-facing ADCP’s transducers.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.find_surface">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">find_surface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#find_surface"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.find_surface" title="Link to this definition"></a></dt>
<dd><p>Deprecated function. Use <cite>water_depth_from_amplitude</cite> instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.water_depth_from_amplitude">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">water_depth_from_amplitude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfilt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#water_depth_from_amplitude"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.water_depth_from_amplitude" title="Link to this definition"></a></dt>
<dd><p>Find the surface (water level or seafloor) from amplitude data and
adds the variable “depth” to the input Dataset.</p>
<p>Depth is either water depth or the distance from the ADCP to
surface/seafloor, depending on if “range_offset” has been set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The full adcp dataset</p></li>
<li><p><strong>thresh</strong> (<em>int</em>) – Specifies the threshold used in detecting the surface. Default = 10
(The amount that amplitude must increase by near the surface for it to
be considered a surface hit.)</p></li>
<li><p><strong>nfilt</strong> (<em>int</em>) – Specifies the width of the median filter applied, must be odd.
Default is None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None, operates “in place” and adds the variable “depth” to the</em></p></li>
<li><p><em>input dataset</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.find_surface_from_P">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">find_surface_from_P</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#find_surface_from_P"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.find_surface_from_P" title="Link to this definition"></a></dt>
<dd><p>Deprecated function. Use <cite>water_depth_from_pressure</cite> instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.water_depth_from_pressure">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">water_depth_from_pressure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">salinity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">35</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#water_depth_from_pressure"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.water_depth_from_pressure" title="Link to this definition"></a></dt>
<dd><p>Calculates the distance to the water surface. Temperature and salinity
are used to calculate seawater density, which is in turn used with the
pressure data to calculate depth.</p>
<p>Depth is either water depth or the distance from the ADCP to
surface/seafloor, depending on if “range_offset” has been set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The full adcp dataset</p></li>
<li><p><strong>salinity</strong> (<em>numeric</em>) – Water salinity in psu. Default = 35</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None, operates “in place” and adds the variables “water_density” and</em></p></li>
<li><p><em>”depth” to the input dataset.</em></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Requires that the instrument’s pressure sensor was calibrated/zeroed
before deployment to remove atmospheric pressure.</p>
<p>Calculates seawater density using a linear approximation of the sea
water equation of state:</p>
<div class="math notranslate nohighlight">
\[\rho - \rho_0 = -\alpha (T-T_0) + \beta (S-S_0) + \kappa P\]</div>
<p>Where <span class="math notranslate nohighlight">\(\rho\)</span> is water density, <span class="math notranslate nohighlight">\(T\)</span> is water temperature,
<span class="math notranslate nohighlight">\(P\)</span> is water pressure, <span class="math notranslate nohighlight">\(S\)</span> is practical salinity,
<span class="math notranslate nohighlight">\(\alpha\)</span> is the thermal expansion coefficient, <span class="math notranslate nohighlight">\(\beta\)</span> is
the haline contraction coefficient, and <span class="math notranslate nohighlight">\(\kappa\)</span> is adiabatic
compressibility.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.nan_beyond_surface">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">nan_beyond_surface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#nan_beyond_surface"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.nan_beyond_surface" title="Link to this definition"></a></dt>
<dd><p>Deprecated function. Use <cite>remove_surface_interference</cite> instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.remove_surface_interference">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">remove_surface_interference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_angle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#remove_surface_interference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.remove_surface_interference" title="Link to this definition"></a></dt>
<dd><p>Mask the values of 3D data (vel, amp, corr, echo) that are beyond the surface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The adcp dataset to clean</p></li>
<li><p><strong>val</strong> (<em>nan</em><em> or </em><em>numeric</em>) – Specifies the value to set the bad values to. Default is <cite>numpy.nan</cite></p></li>
<li><p><strong>beam_angle</strong> (<em>int</em>) – ADCP beam inclination angle in degrees. Default = dataset.attrs[‘beam_angle’]</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True the existing data object is modified. When False
a copy is returned. Default = False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Sets the adcp dataset where relevant arrays with values greater than <cite>depth</cite>
set to NaN</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Surface interference expected to happen at
<cite>distance &gt; range * cos(beam angle) - cell size</cite></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.correlation_filter">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">correlation_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#correlation_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.correlation_filter" title="Link to this definition"></a></dt>
<dd><p>Filters out data where correlation is below a threshold in the
along-beam correlation data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The adcp dataset to clean.</p></li>
<li><p><strong>thresh</strong> (<em>numeric</em>) – The maximum value of correlation to screen, in counts or %.
Default = 50</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True the existing data object is modified. When False
a copy is returned. Default = False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Elements in velocity, correlation, and amplitude are removed if below the
correlation threshold</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Does not edit correlation or amplitude data.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.medfilt_orient">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">medfilt_orient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfilt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#medfilt_orient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.medfilt_orient" title="Link to this definition"></a></dt>
<dd><p>Median filters the orientation data (heading-pitch-roll or quaternions)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The adcp dataset to clean</p></li>
<li><p><strong>nfilt</strong> (<em>numeric</em>) – The length of the median-filtering kernel. Must be odd.
Default = 7</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The adcp dataset with the filtered orientation data</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal.medfilt</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.val_exceeds_thresh">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">val_exceeds_thresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#val_exceeds_thresh"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.val_exceeds_thresh" title="Link to this definition"></a></dt>
<dd><p>Find values of a variable that exceed a threshold value,
and assign “val” to the velocity data where the threshold is
exceeded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>xarray.DataArray</em>) – Variable to clean</p></li>
<li><p><strong>thresh</strong> (<em>numeric</em>) – The maximum value of velocity to screen. Default = 5</p></li>
<li><p><strong>val</strong> (<em>nan</em><em> or </em><em>numeric</em>) – Specifies the value to set the bad values to. Default is <cite>numpy.nan</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.DataArray</em>) – The adcp dataarray with datapoints beyond thresh are set to <cite>val</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.fillgaps_time">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">fillgaps_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cubic'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxgap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#fillgaps_time"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.fillgaps_time" title="Link to this definition"></a></dt>
<dd><p>Fill gaps (nan values) in var across time using the specified method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>xarray.DataArray</em>) – The variable to clean</p></li>
<li><p><strong>method</strong> (<em>string</em>) – Interpolation method to use. Default is ‘cubic’</p></li>
<li><p><strong>maxgap</strong> (<em>numeric</em>) – Maximum gap of missing data to interpolate across. Default is None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>xarray.DataArray</em>) – The input DataArray ‘var’ with gaps in ‘var’ interpolated across time</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">xarray.DataArray.interpolate_na</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.clean.fillgaps_depth">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.clean.</span></span><span class="sig-name descname"><span class="pre">fillgaps_depth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cubic'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxgap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/clean.html#fillgaps_depth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.clean.fillgaps_depth" title="Link to this definition"></a></dt>
<dd><p>Fill gaps (nan values) in var along the depth profile using the specified method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>xarray.DataArray</em>) – The variable to clean</p></li>
<li><p><strong>method</strong> (<em>string</em>) – Interpolation method to use. Default is ‘cubic’</p></li>
<li><p><strong>maxgap</strong> (<em>numeric</em>) – Maximum gap of missing data to interpolate across. Default is None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>xarray.DataArray</em>) – The input DataArray ‘var’ with gaps in ‘var’ interpolated across depth</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">xarray.DataArray.interpolate_na</span></code></p>
</div>
</dd></dl>

</section>
<section id="module-mhkit.dolfyn.adv.clean">
<span id="adv-cleaning"></span><h3>ADV Cleaning<a class="headerlink" href="#module-mhkit.dolfyn.adv.clean" title="Link to this heading"></a></h3>
<p>Module containing functions to clean data</p>
<blockquote>
<div><table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.clean.clean_fill" title="mhkit.dolfyn.adv.clean.clean_fill"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clean_fill</span></code></a></p></td>
<td><p>Interpolate over mask values in timeseries data using the specified method</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.clean.fill_nan_ensemble_mean" title="mhkit.dolfyn.adv.clean.fill_nan_ensemble_mean"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fill_nan_ensemble_mean</span></code></a></p></td>
<td><p>Fill missing values with the ensemble mean.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.clean.spike_thresh" title="mhkit.dolfyn.adv.clean.spike_thresh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spike_thresh</span></code></a></p></td>
<td><p>Returns a logical vector where a spike in <cite>u</cite> of magnitude greater than <cite>thresh</cite> occurs.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.clean.range_limit" title="mhkit.dolfyn.adv.clean.range_limit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">range_limit</span></code></a></p></td>
<td><p>Returns a logical vector that is True where the values of <cite>u</cite> are outside of <cite>range</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.clean.GN2002" title="mhkit.dolfyn.adv.clean.GN2002"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GN2002</span></code></a></p></td>
<td><p>The Goring &amp; Nikora 2002 'despiking' method, with Wahl2003 correction.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.clean.clean_fill">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.clean.</span></span><span class="sig-name descname"><span class="pre">clean_fill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cubic'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxgap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/clean.html#clean_fill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.clean.clean_fill" title="Link to this definition"></a></dt>
<dd><p>Interpolate over mask values in timeseries data using the specified method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>xarray.DataArray</em>) – The dataArray to clean.</p></li>
<li><p><strong>mask</strong> (<em>bool</em>) – Logical tensor of elements to “nan” out (from <cite>spikeThresh</cite>, <cite>rangeLimit</cite>,
or <cite>GN2002</cite>) and replace</p></li>
<li><p><strong>npt</strong> (<em>int</em>) – The number of points on either side of the bad values that
interpolation occurs over</p></li>
<li><p><strong>method</strong> (<em>string</em>) – Interpolation method to use (linear, cubic, pchip, etc). Default is ‘cubic’</p></li>
<li><p><strong>maxgap</strong> (<em>numeric</em>) – Maximum gap of missing data to interpolate across. Default is None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>da</strong> (<em>xarray.DataArray</em>) – The dataArray with nan’s filled in</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">xarray.DataArray.interpolate_na</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.clean.fill_nan_ensemble_mean">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.clean.</span></span><span class="sig-name descname"><span class="pre">fill_nan_ensemble_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/clean.html#fill_nan_ensemble_mean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.clean.fill_nan_ensemble_mean" title="Link to this definition"></a></dt>
<dd><p>Fill missing values with the ensemble mean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>xarray.DataArray</em><em> (</em><em>...</em><em>, </em><em>time</em><em>)</em>) – The dataArray to clean. Can be 1D or 2D.</p></li>
<li><p><strong>mask</strong> (<em>bool</em>) – Logical tensor of elements to “nan” out (from <cite>spikeThresh</cite>, <cite>rangeLimit</cite>,
or <cite>GN2002</cite>) and replace</p></li>
<li><p><strong>fs</strong> (<em>int</em>) – Instrument sampling frequency</p></li>
<li><p><strong>window</strong> (<em>int</em>) – Size of window in seconds used to calculate ensemble means</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>da</strong> (<em>xarray.DataArray</em>) – The dataArray with nan’s filled in</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Gaps larger than the ensemble size will not get filled in.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.clean.spike_thresh">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.clean.</span></span><span class="sig-name descname"><span class="pre">spike_thresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/clean.html#spike_thresh"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.clean.spike_thresh" title="Link to this definition"></a></dt>
<dd><p>Returns a logical vector where a spike in <cite>u</cite> of magnitude greater than
<cite>thresh</cite> occurs. Both ‘Negative’ and ‘positive’ spikes are found.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>xarray.DataArray</em>) – The timeseries data to clean.</p></li>
<li><p><strong>thresh</strong> (<em>int</em>) – Magnitude of velocity spike, must be positive. Default = 10</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>mask</strong> (<em>numpy.ndarray</em>) – Logical vector with spikes labeled as ‘True’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.clean.range_limit">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.clean.</span></span><span class="sig-name descname"><span class="pre">range_limit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[-5,</span> <span class="pre">5]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/clean.html#range_limit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.clean.range_limit" title="Link to this definition"></a></dt>
<dd><p>Returns a logical vector that is True where the values of <cite>u</cite> are
outside of <cite>range</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>xarray.DataArray</em>) – The timeseries data to clean.</p></li>
<li><p><strong>range</strong> (<em>list</em>) – Min and max magnitudes beyond which are masked. Default is [-5, 5]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>mask</strong> (<em>numpy.ndarray</em>) – Logical vector with spikes labeled as ‘True’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.clean.GN2002">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.clean.</span></span><span class="sig-name descname"><span class="pre">GN2002</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/clean.html#GN2002"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.clean.GN2002" title="Link to this definition"></a></dt>
<dd><p>The Goring &amp; Nikora 2002 ‘despiking’ method, with Wahl2003 correction.
Returns a logical vector that is true where spikes are identified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>xarray.DataArray</em>) – The velocity array (1D or 3D) to clean.</p></li>
<li><p><strong>npt</strong> (<em>int</em>) – The number of points over which to perform the method. Default = 5000</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>mask</strong> (<em>numpy.ndarray</em>) – Logical vector with spikes labeled as ‘True’</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="motion-correction">
<h2>Motion Correction<a class="headerlink" href="#motion-correction" title="Link to this heading"></a></h2>
<p>The motion correction submodule contains tools to correct
Nortek Vector ADV-IMU data using the onboard IMU, if
equipped. Requires <a class="reference external" href="https://dolfyn.readthedocs.io/en/stable/motion-correction.html">proper setup</a>
prior to collecting data.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.motion.correct_motion" title="mhkit.dolfyn.adv.motion.correct_motion"><code class="xref py py-obj docutils literal notranslate"><span class="pre">correct_motion</span></code></a></p></td>
<td><p>This function performs motion correction on an IMU-ADV data object.</p></td>
</tr>
</tbody>
</table>
<dl class="py exception">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.MissingDataError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.motion.</span></span><span class="sig-name descname"><span class="pre">MissingDataError</span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#MissingDataError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.MissingDataError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.DataAlreadyProcessedError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.motion.</span></span><span class="sig-name descname"><span class="pre">DataAlreadyProcessedError</span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#DataAlreadyProcessedError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.DataAlreadyProcessedError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.MissingRequiredDataError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.motion.</span></span><span class="sig-name descname"><span class="pre">MissingRequiredDataError</span></span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#MissingRequiredDataError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.MissingRequiredDataError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.CalcMotion">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.motion.</span></span><span class="sig-name descname"><span class="pre">CalcMotion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accel_filtfreq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vel_filtfreq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_earth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#CalcMotion"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.CalcMotion" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A ‘calculator’ for computing the velocity of points that are
rigidly connected to an ADV-body with an IMU.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The IMU-adv data that will be used to compute motion.</p></li>
<li><p><strong>accel_filtfreq</strong> (<em>float</em>) – The frequency at which to high-pass filter the acceleration
sigal to remove low-frequency drift. Default = 0.03 Hz</p></li>
<li><p><strong>vel_filtfreq</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – a second frequency to high-pass filter the integrated
acceleration.  Default = 1/3 of <cite>accel_filtfreq</cite></p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.CalcMotion.reshape">
<span class="sig-name descname"><span class="pre">reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#CalcMotion.reshape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.CalcMotion.reshape" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.CalcMotion.calc_velacc">
<span class="sig-name descname"><span class="pre">calc_velacc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#CalcMotion.calc_velacc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.CalcMotion.calc_velacc" title="Link to this definition"></a></dt>
<dd><p>Calculates the translational velocity from the high-pass
filtered acceleration signal.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>velacc</strong> (<em>numpy.ndarray (3 x n_time)</em>) – The acceleration-induced velocity array (3, n_time).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.CalcMotion.calc_velrot">
<span class="sig-name descname"><span class="pre">calc_velrot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_earth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#CalcMotion.calc_velrot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.CalcMotion.calc_velrot" title="Link to this definition"></a></dt>
<dd><p>Calculate the induced velocity due to rotations of the
instrument about the IMU center.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>vec</strong> (<em>numpy.ndarray</em><em> (</em><em>len</em><em>(</em><em>3</em><em>) or </em><em>3 x M</em><em>)</em>) – The vector in meters (or vectors) from the body-origin
(center of head end-cap) to the point of interest (in the
body coord-sys).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>velrot</strong> (<em>numpy.ndarray (3 x M x N_time)</em>) – The rotation-induced velocity array (3, n_time).</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.motion.correct_motion">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.motion.</span></span><span class="sig-name descname"><span class="pre">correct_motion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accel_filtfreq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vel_filtfreq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_earth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separate_probes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/motion.html#correct_motion"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.motion.correct_motion" title="Link to this definition"></a></dt>
<dd><p>This function performs motion correction on an IMU-ADV data
object. The IMU and ADV data should be tightly synchronized and
contained in a single data object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Cleaned ADV dataset in “inst” coordinates</p></li>
<li><p><strong>accel_filtfreq</strong> (<em>float</em>) – the frequency at which to high-pass filter the acceleration
sigal to remove low-frequency drift.</p></li>
<li><p><strong>vel_filtfreq</strong> (<em>float</em>) – a second frequency to high-pass filter the integrated
acceleration.  Optional, default = 1/3 of <cite>accel_filtfreq</cite></p></li>
<li><p><strong>to_earth</strong> (<em>bool</em>) – All variables in the ds.props[‘rotate_vars’] list will be
rotated into either the earth frame (to_earth=True) or the
instrument frame (to_earth=False). Optional, default = True</p></li>
<li><p><strong>separate_probes</strong> (<em>bool</em>) – a flag to perform motion-correction at the probe tips, and
perform motion correction in beam-coordinates, then transform
back into XYZ/earth coordinates. This correction seems to be
lower than the noise levels of the ADV, so the default is to not
use it (False).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul>
<li><p><em>This function returns None, it operates on the input data object,</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ds</span></code>. The following attributes are added to <cite>ds</cite> – <code class="docutils literal notranslate"><span class="pre">velraw</span></code> is the uncorrected velocity</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">velrot</span></code> is the rotational component of the head motion (from</dt><dd><p>angrt)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">velacc</span></code> is the translational component of the head motion (from</dt><dd><p>accel, the high-pass filtered accel sigal)</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">acclow</span></code> is the low-pass filtered accel sigal (i.e.,</p>
</li>
<li><p>The primary velocity vector attribute, <code class="docutils literal notranslate"><span class="pre">vel</span></code>, is motion corrected</p></li>
<li><p><em>such that</em> – vel = velraw + velrot + velacc</p></li>
<li><p><em>The sigs are correct in this equation. The measured velocity</em></p></li>
<li><p><em>induced by head-motion is *in the opposite direction</em> of the head*</p></li>
<li><p><em>motion.  i.e. when the head moves one way in stationary flow, it</em></p></li>
<li><p><em>measures a velocity in the opposite direction. Therefore, to</em></p></li>
<li><p><em>remove the motion from the raw sigal we *add</em> the head motion.*</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Acceleration signals from inertial sensors are notorious for
having a small bias that can drift slowly in time. When
integrating these sigals to estimate velocity the bias is
amplified and leads to large errors in the estimated
velocity. There are two methods for removing these errors,</p>
<ol class="arabic simple">
<li><p>high-pass filter the acceleration sigal prior and/or after
integrating. This implicitly assumes that the low-frequency
translational velocity is zero.</p></li>
<li><p>provide a slowly-varying reference position (often from a GPS)
to an IMU that can use the sigal (usually using Kalman
filters) to debias the acceleration sigal.</p></li>
</ol>
<p>Because method (1) removes <cite>real</cite> low-frequency acceleration,
method (2) is more accurate. However, providing reference position
estimates to undersea instruments is practically challenging and
expensive. Therefore, lacking the ability to use method (2), this
function utilizes method (1).</p>
<p>For deployments in which the ADV is mounted on a mooring, or other
semi-fixed structure, the assumption of zero low-frequency
translational velocity is a reasonable one. However, for
deployments on ships, gliders, or other moving objects it is
not. The measured velocity, after motion-correction, will still
hold some of this contamination and will be a sum of the ADV
motion and the measured velocity on long time scales.  If
low-frequency motion is known separate from the ADV (e.g. from a
bottom-tracking ADP, or from a ship’s GPS), it may be possible to
remove that sigal from the ADV sigal in post-processing.</p>
</dd></dl>

</section>
<section id="velocity-analysis">
<h2>Velocity Analysis<a class="headerlink" href="#velocity-analysis" title="Link to this heading"></a></h2>
<p>Analysis in DOLfYN is primarily handled through the
<cite>VelBinner</cite> class. Below is a list of functions that can
be called from <cite>VelBinner</cite>.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">VelBinner</span></code></a></p></td>
<td><p>This is the base binning (averaging) tool.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.bin_average" title="mhkit.dolfyn.velocity.VelBinner.bin_average"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bin_average</span></code></a></p></td>
<td><p>Bin the dataset and calculate the ensemble averages of each variable.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.bin_variance" title="mhkit.dolfyn.velocity.VelBinner.bin_variance"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bin_variance</span></code></a></p></td>
<td><p>Bin the dataset and calculate the ensemble variances of each variable.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.autocovariance" title="mhkit.dolfyn.velocity.VelBinner.autocovariance"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocovariance</span></code></a></p></td>
<td><p>Calculate the auto-covariance of the raw-signal <cite>veldat</cite></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.turbulence_intensity" title="mhkit.dolfyn.velocity.VelBinner.turbulence_intensity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">turbulence_intensity</span></code></a></p></td>
<td><p>Calculate noise-corrected turbulence intensity.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.turbulent_kinetic_energy" title="mhkit.dolfyn.velocity.VelBinner.turbulent_kinetic_energy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">turbulent_kinetic_energy</span></code></a></p></td>
<td><p>Calculate the turbulent kinetic energy (TKE) (variances of u,v,w).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner.power_spectral_density" title="mhkit.dolfyn.velocity.VelBinner.power_spectral_density"><code class="xref py py-obj docutils literal notranslate"><span class="pre">power_spectral_density</span></code></a></p></td>
<td><p>Calculate the power spectral density of velocity.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.reshape" title="mhkit.dolfyn.binned.TimeBinner.reshape"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reshape</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.detrend" title="mhkit.dolfyn.binned.TimeBinner.detrend"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrend</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad) and remove the best-fit trend line from each bin.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.demean" title="mhkit.dolfyn.binned.TimeBinner.demean"><code class="xref py py-obj docutils literal notranslate"><span class="pre">demean</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad) and remove the mean from each bin.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.mean" title="mhkit.dolfyn.binned.TimeBinner.mean"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mean</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad) and take the mean of each bin along the specified <cite>axis</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.variance" title="mhkit.dolfyn.binned.TimeBinner.variance"><code class="xref py py-obj docutils literal notranslate"><span class="pre">variance</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad) and take the variance of each bin along the specified <cite>axis</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner.standard_deviation" title="mhkit.dolfyn.binned.TimeBinner.standard_deviation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">standard_deviation</span></code></a></p></td>
<td><p>Reshape the array <cite>arr</cite> to shape (...,n,n_bin+n_pad) and take the standard deviation of each bin along the specified <cite>axis</cite>.</p></td>
</tr>
</tbody>
</table>
<dl class="py class" id="module-mhkit.dolfyn.velocity">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.velocity.</span></span><span class="sig-name descname"><span class="pre">Velocity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#Velocity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>All ADCP and ADV xarray datasets wrap this base class.</p>
<p>The turbulence-related attributes defined within this class
assume that the  <code class="docutils literal notranslate"><span class="pre">'tke_vec'</span></code> and <code class="docutils literal notranslate"><span class="pre">'stress_vec'</span></code> data entries are
included in the dataset. These are typically calculated using a
<a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-class docutils literal notranslate"><span class="pre">VelBinner</span></code></a> tool, but the method for calculating these
variables can depend on the details of the measurement
(instrument, it’s configuration, orientation, etc.).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-class docutils literal notranslate"><span class="pre">VelBinner</span></code></a></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.rotate2">
<span class="sig-name descname"><span class="pre">rotate2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out_frame</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'earth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#Velocity.rotate2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.rotate2" title="Link to this definition"></a></dt>
<dd><p>Rotate the dataset to a new coordinate system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>out_frame</strong> (<em>string {'beam'</em><em>, </em><em>'inst'</em><em>, </em><em>'earth'</em><em>, </em><em>'principal'}</em>) – The coordinate system to rotate the data into.</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True the existing data object is modified. When False
a copy is returned. Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns the rotated dataset <strong>when ``inplace=False``</strong>, otherwise
returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul>
<li><p>This function rotates all variables in <code class="docutils literal notranslate"><span class="pre">ds.attrs['rotate_vars']</span></code>.</p></li>
<li><p>To rotate to the ‘principal’ frame, a value of
<code class="docutils literal notranslate"><span class="pre">ds.attrs['principal_heading']</span></code> must exist. The function
<code class="xref py py-func docutils literal notranslate"><span class="pre">calc_principal_heading</span></code>
is recommended for this purpose, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;principal_heading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dolfyn</span><span class="o">.</span><span class="n">calc_principal_heading</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
</pre></div>
</div>
<p>where here we are using the depth-averaged velocity to calculate
the principal direction.</p>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.set_declination">
<span class="sig-name descname"><span class="pre">set_declination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">declin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#Velocity.set_declination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.set_declination" title="Link to this definition"></a></dt>
<dd><p>Set the magnetic declination</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>declination</strong> (<em>float</em>) – The value of the magnetic declination in degrees (positive
values specify that Magnetic North is clockwise from True North)</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True the existing data object is modified. When False
a copy is returned. Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns the rotated dataset <strong>when ``inplace=False``</strong>, otherwise
returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method modifies the data object in the following ways:</p>
<ul class="simple">
<li><p>If the dataset is in the <em>earth</em> reference frame at the time of</p></li>
</ul>
<p>setting declination, it will be rotated into the “<em>True-East</em>,
<em>True-North</em>, Up” (hereafter, ETU) coordinate system</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dat['orientmat']</span></code> is modified to be an ETU to</p></li>
</ul>
<p>instrument (XYZ) rotation matrix (rather than the magnetic-ENU to
XYZ rotation matrix). Therefore, all rotations to/from the ‘earth’
frame will now be to/from this ETU coordinate system.</p>
<ul class="simple">
<li><p>The value of the specified declination will be stored in</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">dat.attrs['declination']</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dat['heading']</span></code> is adjusted for declination</p></li>
</ul>
<p>(i.e., it is relative to True North).</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">dat.attrs['principal_heading']</span></code> is set, it is</p></li>
</ul>
<p>adjusted to account for the orientation of the new ‘True’
earth coordinate system (i.e., calling set_declination on a
data object in the principal coordinate system, then calling
dat.rotate2(‘earth’) will yield a data object in the new
‘True’ earth coordinate system)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.set_inst2head_rotmat">
<span class="sig-name descname"><span class="pre">set_inst2head_rotmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rotmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#Velocity.set_inst2head_rotmat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.set_inst2head_rotmat" title="Link to this definition"></a></dt>
<dd><p>Set the instrument to head rotation matrix for the Nortek ADV if it
hasn’t already been set through a ‘.userdata.json’ file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rotmat</strong> (<em>float</em>) – 3x3 rotation matrix</p></li>
<li><p><strong>inplace</strong> (<em>bool</em>) – When True the existing data object is rotated. When False
a copy is returned that is rotated. Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns the rotated dataset <strong>when ``inplace=False``</strong>, otherwise
returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If the data object is in earth or principal coords, it is first
rotated to ‘inst’ before assigning inst2head_rotmat, it is then
rotated back to the coordinate system in which it was input. This
way the inst2head_rotmat gets applied correctly (in inst
coordinate system).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#Velocity.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.save" title="Link to this definition"></a></dt>
<dd><p>Save the data object (underlying xarray dataset) as netCDF (.nc).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.nc’ extension</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – These are passed directly to <code class="xref py py-func docutils literal notranslate"><span class="pre">xarray.Dataset.to_netcdf()</span></code>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See DOLfYN’s <code class="xref py py-func docutils literal notranslate"><span class="pre">save</span></code> function for
additional details.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.variables">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">variables</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.variables" title="Link to this definition"></a></dt>
<dd><p>A sorted list of the variable names in the dataset.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.attrs">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">attrs</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.attrs" title="Link to this definition"></a></dt>
<dd><p>The attributes in the dataset.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.coords">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">coords</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.coords" title="Link to this definition"></a></dt>
<dd><p>The coordinates in the dataset.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.u">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">u</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.u" title="Link to this definition"></a></dt>
<dd><p>The first velocity component.</p>
<p>This is simply a shortcut to self[‘vel’][0]. Therefore,
depending on the coordinate system of the data object
(self.attrs[‘coord_sys’]), it is:</p>
<ul class="simple">
<li><p>beam:      beam1</p></li>
<li><p>inst:      x</p></li>
<li><p>earth:     east</p></li>
<li><p>principal: streamwise</p></li>
</ul>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.v">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">v</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.v" title="Link to this definition"></a></dt>
<dd><p>The second velocity component.</p>
<p>This is simply a shortcut to self[‘vel’][1]. Therefore,
depending on the coordinate system of the data object
(self.attrs[‘coord_sys’]), it is:</p>
<ul class="simple">
<li><p>beam:      beam2</p></li>
<li><p>inst:      y</p></li>
<li><p>earth:     north</p></li>
<li><p>principal: cross-stream</p></li>
</ul>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.w">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">w</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.w" title="Link to this definition"></a></dt>
<dd><p>The third velocity component.</p>
<p>This is simply a shortcut to self[‘vel’][2]. Therefore,
depending on the coordinate system of the data object
(self.attrs[‘coord_sys’]), it is:</p>
<ul class="simple">
<li><p>beam:      beam3</p></li>
<li><p>inst:      z</p></li>
<li><p>earth:     up</p></li>
<li><p>principal: up</p></li>
</ul>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.U">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">U</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.U" title="Link to this definition"></a></dt>
<dd><p>Horizontal velocity as a complex quantity</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.U_mag">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">U_mag</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.U_mag" title="Link to this definition"></a></dt>
<dd><p>Horizontal velocity magnitude</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.U_dir">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">U_dir</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.U_dir" title="Link to this definition"></a></dt>
<dd><p>Angle of horizontal velocity vector. Direction is ‘to’,
as opposed to ‘from’. This function calculates angle as
“degrees CCW from X/East/streamwise” and then converts it to
“degrees CW from X/North/streamwise”.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.E_coh">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">E_coh</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.E_coh" title="Link to this definition"></a></dt>
<dd><p>Coherent turbulent energy</p>
<p>Niel Kelley’s ‘coherent turbulence energy’, which is the RMS
of the Reynold’s stresses.</p>
<p>See: NREL Technical Report TP-500-52353</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.I_tke">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">I_tke</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.I_tke" title="Link to this definition"></a></dt>
<dd><p>Turbulent kinetic energy intensity.</p>
<p>Ratio of sqrt(tke) to horizontal velocity magnitude.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.I">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">I</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.I" title="Link to this definition"></a></dt>
<dd><p>Turbulence intensity.</p>
<p>Ratio of standard deviation of horizontal velocity
to horizontal velocity magnitude.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.tke">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tke</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.tke" title="Link to this definition"></a></dt>
<dd><p>Turbulent kinetic energy (sum of the three components)</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.upvp_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">upvp_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.upvp_" title="Link to this definition"></a></dt>
<dd><p>u’v’bar Reynolds stress</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.upwp_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">upwp_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.upwp_" title="Link to this definition"></a></dt>
<dd><p>u’w’bar Reynolds stress</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.vpwp_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">vpwp_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.vpwp_" title="Link to this definition"></a></dt>
<dd><p>v’w’bar Reynolds stress</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.upup_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">upup_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.upup_" title="Link to this definition"></a></dt>
<dd><p>u’u’bar component of the tke</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.vpvp_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">vpvp_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.vpvp_" title="Link to this definition"></a></dt>
<dd><p>v’v’bar component of the tke</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.Velocity.wpwp_">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">wpwp_</span></span><a class="headerlink" href="#mhkit.dolfyn.velocity.Velocity.wpwp_" title="Link to this definition"></a></dt>
<dd><p>w’w’bar component of the tke</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.velocity.</span></span><span class="sig-name descname"><span class="pre">VelBinner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft_coh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mhkit.dolfyn.binned.TimeBinner" title="mhkit.dolfyn.binned.TimeBinner"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeBinner</span></code></a></p>
<p>This is the base binning (averaging) tool.
All DOLfYN binning tools derive from this base class.</p>
<p class="rubric">Examples</p>
<p>The VelBinner class is used to compute averages and turbulence
statistics from ‘raw’ (not averaged) ADV or ADP measurements, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First read or load some data.</span>
<span class="n">rawdat</span> <span class="o">=</span> <span class="n">dolfyn</span><span class="o">.</span><span class="n">read_example</span><span class="p">(</span><span class="s1">&#39;BenchFile01.ad2cp&#39;</span><span class="p">)</span>

<span class="c1"># Now initialize the averaging tool:</span>
<span class="n">binner</span> <span class="o">=</span> <span class="n">dolfyn</span><span class="o">.</span><span class="n">VelBinner</span><span class="p">(</span><span class="n">n_bin</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">rawdat</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>

<span class="c1"># This computes the basic averages</span>
<span class="n">avg</span> <span class="o">=</span> <span class="n">binner</span><span class="o">.</span><span class="n">bin_average</span><span class="p">(</span><span class="n">rawdat</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.tke">
<span class="sig-name descname"><span class="pre">tke</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;xarray.DataArray</span> <span class="pre">'tke'</span> <span class="pre">(tke:</span> <span class="pre">3)&gt;</span> <span class="pre">Size:</span> <span class="pre">60B</span> <span class="pre">array(['upup_',</span> <span class="pre">'vpvp_',</span> <span class="pre">'wpwp_'],</span> <span class="pre">dtype='&lt;U5')</span> <span class="pre">Dimensions</span> <span class="pre">without</span> <span class="pre">coordinates:</span> <span class="pre">tke</span> <span class="pre">Attributes:</span>&#160;&#160;&#160;&#160; <span class="pre">units:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160;&#160;&#160;&#160; <span class="pre">long_name:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Turbulent</span> <span class="pre">Kinetic</span> <span class="pre">Energy</span> <span class="pre">Vector</span> <span class="pre">Components</span>&#160;&#160;&#160;&#160; <span class="pre">coverage_content_type:</span>&#160; <span class="pre">coordinate</span></em><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.tke" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.tau">
<span class="sig-name descname"><span class="pre">tau</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;xarray.DataArray</span> <span class="pre">'tau'</span> <span class="pre">(tau:</span> <span class="pre">3)&gt;</span> <span class="pre">Size:</span> <span class="pre">60B</span> <span class="pre">array(['upvp_',</span> <span class="pre">'upwp_',</span> <span class="pre">'vpwp_'],</span> <span class="pre">dtype='&lt;U5')</span> <span class="pre">Dimensions</span> <span class="pre">without</span> <span class="pre">coordinates:</span> <span class="pre">tau</span> <span class="pre">Attributes:</span>&#160;&#160;&#160;&#160; <span class="pre">units:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160;&#160;&#160;&#160; <span class="pre">long_name:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Reynolds</span> <span class="pre">Stress</span> <span class="pre">Vector</span> <span class="pre">Components</span>&#160;&#160;&#160;&#160; <span class="pre">coverage_content_type:</span>&#160; <span class="pre">coordinate</span></em><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.tau" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.S">
<span class="sig-name descname"><span class="pre">S</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;xarray.DataArray</span> <span class="pre">'S'</span> <span class="pre">(S:</span> <span class="pre">3)&gt;</span> <span class="pre">Size:</span> <span class="pre">36B</span> <span class="pre">array(['Sxx',</span> <span class="pre">'Syy',</span> <span class="pre">'Szz'],</span> <span class="pre">dtype='&lt;U3')</span> <span class="pre">Dimensions</span> <span class="pre">without</span> <span class="pre">coordinates:</span> <span class="pre">S</span> <span class="pre">Attributes:</span>&#160;&#160;&#160;&#160; <span class="pre">units:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160;&#160;&#160;&#160; <span class="pre">long_name:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Power</span> <span class="pre">Spectral</span> <span class="pre">Density</span> <span class="pre">Vector</span> <span class="pre">Components</span>&#160;&#160;&#160;&#160; <span class="pre">coverage_content_type:</span>&#160; <span class="pre">coordinate</span></em><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.S" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.C">
<span class="sig-name descname"><span class="pre">C</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;xarray.DataArray</span> <span class="pre">'C'</span> <span class="pre">(C:</span> <span class="pre">3)&gt;</span> <span class="pre">Size:</span> <span class="pre">36B</span> <span class="pre">array(['Cxy',</span> <span class="pre">'Cxz',</span> <span class="pre">'Cyz'],</span> <span class="pre">dtype='&lt;U3')</span> <span class="pre">Dimensions</span> <span class="pre">without</span> <span class="pre">coordinates:</span> <span class="pre">C</span> <span class="pre">Attributes:</span>&#160;&#160;&#160;&#160; <span class="pre">units:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160;&#160;&#160;&#160; <span class="pre">long_name:</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Cross-Spectral</span> <span class="pre">Density</span> <span class="pre">Vector</span> <span class="pre">Components</span>&#160;&#160;&#160;&#160; <span class="pre">coverage_content_type:</span>&#160; <span class="pre">coordinate</span></em><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.C" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.bin_average">
<span class="sig-name descname"><span class="pre">bin_average</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.bin_average"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.bin_average" title="Link to this definition"></a></dt>
<dd><p>Bin the dataset and calculate the ensemble averages of each
variable.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_ds</strong> (<em>xarray.Dataset</em>) – The raw data structure to be binned</p></li>
<li><p><strong>out_ds</strong> (<em>xarray.Dataset</em>) – The bin’d (output) data object to which averaged data is added.</p></li>
<li><p><strong>names</strong> (<em>list</em><em> of </em><em>strings</em>) – The names of variables to be averaged.  If <cite>names</cite> is None,
all data in <cite>raw_ds</cite> will be binned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out_ds</strong> (<em>xarray.Dataset</em>) – The new (or updated when out_ds is not None) dataset
with the averages of all the variables in raw_ds.</p>
</dd>
</dl>
<p>:raises AttributeError : when out_ds is supplied as input (not None):
:raises and the values in out_ds.attrs are inconsistent with:
:raises raw_ds.attrs or the properties of this VelBinner (n_bin,:
:raises n_fft, fs, etc.):</p>
<p class="rubric">Notes</p>
<p>raw_ds.attrs are copied to out_ds.attrs. Inconsistencies
between the two (when out_ds is specified as input) raise an
AttributeError.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.bin_variance">
<span class="sig-name descname"><span class="pre">bin_variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'_var'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.bin_variance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.bin_variance" title="Link to this definition"></a></dt>
<dd><p>Bin the dataset and calculate the ensemble variances of each
variable. Complementary to <cite>bin_average()</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_ds</strong> (<em>xarray.Dataset</em>) – The raw data structure to be binned.</p></li>
<li><p><strong>out_ds</strong> (<em>xarray.Dataset</em>) – The binned (output) dataset to which variance data is added,
nominally dataset output from <cite>bin_average()</cite></p></li>
<li><p><strong>names</strong> (<em>list</em><em> of </em><em>strings</em>) – The names of variables of which to calculate variance.  If
<cite>names</cite> is None, all data in <cite>raw_ds</cite> will be binned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out_ds</strong> (<em>xarray.Dataset</em>) – The new (or updated when out_ds is not None) dataset
with the variance of all the variables in raw_ds.</p>
</dd>
</dl>
<p>:raises AttributeError : when out_ds is supplied as input (not None):
:raises and the values in out_ds.attrs are inconsistent with:
:raises raw_ds.attrs or the properties of this VelBinner (n_bin,:
:raises n_fft, fs, etc.):</p>
<p class="rubric">Notes</p>
<p>raw_ds.attrs are copied to out_ds.attrs. Inconsistencies
between the two (when out_ds is specified as input) raise an
AttributeError.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.autocovariance">
<span class="sig-name descname"><span class="pre">autocovariance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">veldat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.autocovariance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.autocovariance" title="Link to this definition"></a></dt>
<dd><p>Calculate the auto-covariance of the raw-signal <cite>veldat</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>veldat</strong> (<em>xarray.DataArray</em>) – The raw dataArray of which to calculate auto-covariance</p></li>
<li><p><strong>n_bin</strong> (<em>float</em>) – Number of data elements to use</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>da</strong> (<em>xarray.DataArray</em>) – The auto-covariance of veldat</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>As opposed to cross-covariance, which returns the full
cross-covariance between two arrays, this function only
returns a quarter of the full auto-covariance. It computes the
auto-covariance over half of the range, then averages the two
sides (to return a ‘quartered’ covariance).</p>
<p>This has the advantage that the 0 index is actually zero-lag.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.turbulence_intensity">
<span class="sig-name descname"><span class="pre">turbulence_intensity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">U_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.turbulence_intensity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.turbulence_intensity" title="Link to this definition"></a></dt>
<dd><p>Calculate noise-corrected turbulence intensity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>U_mag</strong> (<em>xarray.DataArray</em>) – Raw horizontal velocity magnitude</p></li>
<li><p><strong>noise</strong> (<em>numeric</em>) – Instrument noise level in same units as velocity. Typically
found from <cite>&lt;adv or adp&gt;.turbulence.doppler_noise_level</cite>.
Default: None.</p></li>
<li><p><strong>thresh</strong> (<em>numeric</em>) – Theshold below which TI will not be calculated</p></li>
<li><p><strong>detrend</strong> (<em>bool</em><em> (</em><em>default: False</em><em>)</em>) – Detrend the velocity data (True), or simply de-mean it
(False), prior to computing TI.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.turbulent_kinetic_energy">
<span class="sig-name descname"><span class="pre">turbulent_kinetic_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">veldat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.turbulent_kinetic_energy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.turbulent_kinetic_energy" title="Link to this definition"></a></dt>
<dd><p>Calculate the turbulent kinetic energy (TKE) (variances
of u,v,w).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>veldat</strong> (<em>xarray.DataArray</em>) – Velocity data array from ADV or single beam from ADCP.
The last dimension is assumed to be time.</p></li>
<li><p><strong>noise</strong> (<em>float</em><em> or </em><em>array-like</em>) – Instrument noise level in same units as velocity. Typically
found from <cite>&lt;adv or adp&gt;.turbulence.doppler_noise_level</cite>.
Default: None.</p></li>
<li><p><strong>detrend</strong> (<em>bool</em><em> (</em><em>default: False</em><em>)</em>) – Detrend the velocity data (True), or simply de-mean it
(False), prior to computing TKE. Note: the PSD routines
use detrend, so if you want to have the same amount of
variance here as there use <code class="docutils literal notranslate"><span class="pre">detrend=True</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tke_vec</strong> (<em>xarray.DataArray</em>) – dataArray containing u’u’_, v’v’_ and w’w’_</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.velocity.VelBinner.power_spectral_density">
<span class="sig-name descname"><span class="pre">power_spectral_density</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">veldat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rad/s'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/velocity.html#VelBinner.power_spectral_density"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.velocity.VelBinner.power_spectral_density" title="Link to this definition"></a></dt>
<dd><p>Calculate the power spectral density of velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>veldat</strong> (<em>xr.DataArray</em>) – The raw velocity data (of dims ‘dir’ and ‘time’).</p></li>
<li><p><strong>freq_units</strong> (<em>string</em>) – Frequency units of the returned spectra in either Hz or rad/s
(<cite>f</cite> or <span class="math notranslate nohighlight">\(\omega\)</span>)</p></li>
<li><p><strong>fs</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – The sample rate. Default is <cite>binner.fs</cite></p></li>
<li><p><strong>window</strong> (<em>string</em><em> or </em><em>array</em>) – Specify the window function.
Options: 1, None, ‘hann’, ‘hamm’</p></li>
<li><p><strong>noise</strong> (<em>numeric</em><em> or </em><em>array</em>) – Instrument noise level in same units as velocity.
Default: 0 (ADCP) or [0, 0, 0] (ADV).</p></li>
<li><p><strong>n_bin</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – The bin-size. Default: from the binner.</p></li>
<li><p><strong>n_fft</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – The fft size. Default: from the binner.</p></li>
<li><p><strong>n_pad</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – The number of values to pad with zero. Default = 0.</p></li>
<li><p><strong>step</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – Controls amount of overlap in fft. Default: the step size is
chosen to maximize data use, minimize nens, and have a
minimum of 50% overlap.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>psd</strong> (<em>xarray.DataArray (3, M, N_FFT)</em>) – The spectra in the ‘u’, ‘v’, and ‘w’ directions.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-mhkit.dolfyn.binned">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.binned.</span></span><span class="sig-name descname"><span class="pre">TimeBinner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft_coh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.reshape">
<span class="sig-name descname"><span class="pre">reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.reshape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.reshape" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>n_pad</strong> (<em>int</em>) – Is used to add <cite>n_pad</cite>/2 points from the end of the previous
ensemble to the top of the current, and <cite>n_pad</cite>/2 points
from the top of the next ensemble to the bottom of the
current.  Zeros are padded in the upper-left and lower-right
corners of the matrix (beginning/end of timeseries).  In
this case, the array shape will be (…,`n`,`n_pad`+`n_bin`)</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p><cite>n_bin</cite> can be non-integer, in which case the output array
size will be <cite>n_pad`+`n_bin</cite>, and the decimal will
cause skipping of some data points in <cite>arr</cite>.  In particular,
every mod(<cite>n_bin</cite>,1) bins will have a skipped point. For
example:
- for n_bin=2048.2 every 1/5 bins will have a skipped point.
- for n_bin=4096.9 every 9/10 bins will have a skipped point.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.detrend">
<span class="sig-name descname"><span class="pre">detrend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.detrend"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.detrend" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad)
and remove the best-fit trend line from each bin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis along which to take mean. Default = -1</p></li>
<li><p><strong>n_pad</strong> (<em>int</em>) – Is used to add <cite>n_pad</cite>/2 points from the end of the previous
ensemble to the top of the current, and <cite>n_pad</cite>/2 points
from the top of the next ensemble to the bottom of the
current.  Zeros are padded in the upper-left and lower-right
corners of the matrix (beginning/end of timeseries).  In
this case, the array shape will be (…,`n`,`n_pad`+`n_bin`).
Default = 0</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.demean">
<span class="sig-name descname"><span class="pre">demean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.demean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.demean" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad)
and remove the mean from each bin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis along which to take mean. Default = -1</p></li>
<li><p><strong>n_pad</strong> (<em>int</em>) – Is used to add <cite>n_pad</cite>/2 points from the end of the previous
ensemble to the top of the current, and <cite>n_pad</cite>/2 points
from the top of the next ensemble to the bottom of the
current.  Zeros are padded in the upper-left and lower-right
corners of the matrix (beginning/end of timeseries).  In
this case, the array shape will be (…,`n`,`n_pad`+`n_bin`).
Default = 0</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.mean">
<span class="sig-name descname"><span class="pre">mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.mean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.mean" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad)
and take the mean of each bin along the specified <cite>axis</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis along which to take mean. Default = -1</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.variance">
<span class="sig-name descname"><span class="pre">variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.variance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.variance" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad)
and take the variance of each bin along the specified <cite>axis</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis along which to take variance. Default = -1</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.binned.TimeBinner.standard_deviation">
<span class="sig-name descname"><span class="pre">standard_deviation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/binned.html#TimeBinner.standard_deviation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.binned.TimeBinner.standard_deviation" title="Link to this definition"></a></dt>
<dd><p>Reshape the array <cite>arr</cite> to shape (…,n,n_bin+n_pad)
and take the standard deviation of each bin along the
specified <cite>axis</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.ndarray</em>)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis along which to take std dev. Default = -1</p></li>
<li><p><strong>n_bin</strong> (<em>int</em>) – Override this binner’s n_bin. Default is <cite>binner.n_bin</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="adv-turbulence-analysis">
<h2>ADV Turbulence Analysis<a class="headerlink" href="#adv-turbulence-analysis" title="Link to this heading"></a></h2>
<p>Functions for analyzing ADV data via the <cite>ADVBinner</cite> class,
beyond those described in <cite>VelBinner</cite>.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner" title="mhkit.dolfyn.adv.turbulence.ADVBinner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ADVBinner</span></code></a></p></td>
<td><p>A class that builds upon <cite>VelBinner</cite> for calculating turbulence statistics and velocity spectra from ADV data</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.turbulence_statistics" title="mhkit.dolfyn.adv.turbulence.turbulence_statistics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">turbulence_statistics</span></code></a></p></td>
<td><p>Functional version of <cite>ADVBinner</cite> that computes a suite of turbulence statistics for the input dataset, and returns a <cite>binned</cite> data object.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.reynolds_stress" title="mhkit.dolfyn.adv.turbulence.ADVBinner.reynolds_stress"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reynolds_stress</span></code></a></p></td>
<td><p>Calculate the specific Reynolds stresses (covariances of u,v,w in m^2/s^2)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.cross_spectral_density" title="mhkit.dolfyn.adv.turbulence.ADVBinner.cross_spectral_density"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cross_spectral_density</span></code></a></p></td>
<td><p>Calculate the cross-spectral density of velocity components.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.doppler_noise_level" title="mhkit.dolfyn.adv.turbulence.ADVBinner.doppler_noise_level"><code class="xref py py-obj docutils literal notranslate"><span class="pre">doppler_noise_level</span></code></a></p></td>
<td><p>Calculate bias due to Doppler noise using the noise floor of the velocity spectra.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.check_turbulence_cascade_slope" title="mhkit.dolfyn.adv.turbulence.ADVBinner.check_turbulence_cascade_slope"><code class="xref py py-obj docutils literal notranslate"><span class="pre">check_turbulence_cascade_slope</span></code></a></p></td>
<td><p>This function calculates the slope of the PSD, the power spectra of velocity, within the given frequency range.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_LT83" title="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_LT83"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dissipation_rate_LT83</span></code></a></p></td>
<td><p>Calculate the dissipation rate from the PSD</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_SF" title="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_SF"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dissipation_rate_SF</span></code></a></p></td>
<td><p>Calculate dissipation rate using the &quot;structure function&quot; (SF) method</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_TE01" title="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_TE01"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dissipation_rate_TE01</span></code></a></p></td>
<td><p>Calculate the dissipation rate according to TE01.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.integral_length_scales" title="mhkit.dolfyn.adv.turbulence.ADVBinner.integral_length_scales"><code class="xref py py-obj docutils literal notranslate"><span class="pre">integral_length_scales</span></code></a></p></td>
<td><p>Calculate integral length scales.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.turbulence.</span></span><span class="sig-name descname"><span class="pre">ADVBinner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft_coh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-class docutils literal notranslate"><span class="pre">VelBinner</span></code></a></p>
<p>A class that builds upon <cite>VelBinner</cite> for calculating turbulence
statistics and velocity spectra from ADV data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_bin</strong> (<em>int</em>) – The length of each <cite>bin</cite>, in number of points, for this averaging
operator.</p></li>
<li><p><strong>fs</strong> (<em>int</em>) – Instrument sampling frequency in Hz</p></li>
<li><p><strong>n_fft</strong> (<em>int</em>) – The length of the FFT for computing spectra (must be &lt;= n_bin).
Optional, default <cite>n_fft</cite> = <cite>n_bin</cite></p></li>
<li><p><strong>n_fft_coh</strong> (<em>int</em>) – <p>Number of data points to use for coherence and cross-spectra fft’s.
Optional, default <cite>n_fft_coh</cite> = <cite>n_fft</cite></p>
<blockquote>
<div><dl class="simple">
<dt>noise<span class="classifier">float or array-like</span></dt><dd><p>Instrument noise level in same units as velocity. Typically
found from <cite>adv.turbulence.doppler_noise_level</cite>.
Default: None.</p>
</dd>
</dl>
</div></blockquote>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.reynolds_stress">
<span class="sig-name descname"><span class="pre">reynolds_stress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">veldat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.reynolds_stress"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.reynolds_stress" title="Link to this definition"></a></dt>
<dd><p>Calculate the specific Reynolds stresses
(covariances of u,v,w in m^2/s^2)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>veldat</strong> (<em>xr.DataArray</em>) – A velocity data array. The last dimension is assumed
to be time.</p></li>
<li><p><strong>detrend</strong> (<em>bool</em>) – Detrend the velocity data (True), or simply de-mean it
(False), prior to computing stress. Note: the psd routines
use detrend, so if you want to have the same amount of
variance here as there use <code class="docutils literal notranslate"><span class="pre">detrend=True</span></code>.
Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>xarray.DataArray</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.cross_spectral_density">
<span class="sig-name descname"><span class="pre">cross_spectral_density</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">veldat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rad/s'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft_coh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.cross_spectral_density"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.cross_spectral_density" title="Link to this definition"></a></dt>
<dd><p>Calculate the cross-spectral density of velocity components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>veldat</strong> (<em>xarray.DataArray</em>) – The raw 3D velocity data.</p></li>
<li><p><strong>freq_units</strong> (<em>string</em>) – Frequency units of the returned spectra in either Hz or rad/s
(<cite>f</cite> or <span class="math notranslate nohighlight">\(\omega\)</span>)</p></li>
<li><p><strong>fs</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – The sample rate. Default = <cite>binner.fs</cite></p></li>
<li><p><strong>window</strong> (<em>string</em><em> or </em><em>array</em>) – Specify the window function.
Options: 1, None, ‘hann’, ‘hamm’</p></li>
<li><p><strong>n_bin</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – The bin-size. Default = <cite>binner.n_bin</cite></p></li>
<li><p><strong>n_fft_coh</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – The fft size. Default = <cite>binner.n_fft_coh</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>csd</strong> (<em>xarray.DataArray (3, M, N_FFT)</em>) – The first-dimension of the cross-spectrum is the three
different cross-spectra: ‘uv’, ‘uw’, ‘vw’.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.doppler_noise_level">
<span class="sig-name descname"><span class="pre">doppler_noise_level</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pct_fN</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.doppler_noise_level"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.doppler_noise_level" title="Link to this definition"></a></dt>
<dd><p>Calculate bias due to Doppler noise using the noise floor
of the velocity spectra.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>dir</em><em>, </em><em>time</em><em>, </em><em>f</em><em>)</em>) – The ADV power spectral density of velocity (auto-spectra)</p></li>
<li><p><strong>pct_fN</strong> (<em>float</em>) – Percent of Nyquist frequency to calculate characeristic frequency</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>doppler_noise (xarray.DataArray)</em> – Doppler noise level in units of m/s</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Approximates bias from</p>
<p>where :math: <cite>sigma_{noise}</cite> is the bias due to Doppler noise,
<cite>N</cite> is the constant variance or spectral density, and <cite>f_{c}</cite>
is the characteristic frequency.</p>
<p>The characteristic frequency is then found as</p>
<p>where <cite>f_{s}/2</cite> is the Nyquist frequency.</p>
<p>Richard, Jean-Baptiste, et al. “Method for identification of Doppler noise
levels in turbulent flow measurements dedicated to tidal energy.” International
Journal of Marine Energy 3 (2013): 52-64.</p>
<p>Thiébaut, Maxime, et al. “Investigating the flow dynamics and turbulence at a
tidal-stream energy site in a highly energetic estuary.” Renewable Energy 195
(2022): 252-262.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.check_turbulence_cascade_slope">
<span class="sig-name descname"><span class="pre">check_turbulence_cascade_slope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[6.28,</span> <span class="pre">12.57]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.check_turbulence_cascade_slope"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.check_turbulence_cascade_slope" title="Link to this definition"></a></dt>
<dd><p>This function calculates the slope of the PSD, the power spectra
of velocity, within the given frequency range. The purpose of this
function is to check that the region of the PSD containing the
isotropic turbulence cascade decreases at a rate of <span class="math notranslate nohighlight">\(f^{-5/3}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>[</em><em>time</em><em>,</em><em>] </em><em>freq</em><em>)</em>) – The power spectral density (1D or 2D)</p></li>
<li><p><strong>freq_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>) </em><em>(</em><em>default:</em><em> [</em><em>6.28</em><em>, </em><em>12.57</em><em>]</em><em>)</em>) – The range over which the isotropic turbulence cascade occurs, in
units of the psd frequency vector (Hz or rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>(m, b)</strong> (<em>tuple (slope, y-intercept)</em>) – A tuple containing the coefficients of the log-adjusted linear
regression between PSD and frequency</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Calculates slope based on the <cite>standard</cite> formula for dissipation:</p>
<div class="math notranslate nohighlight">
\[S(k) = \alpha \epsilon^{2/3} k^{-5/3} + N\]</div>
<p>The slope of the isotropic turbulence cascade, which should be
equal to <span class="math notranslate nohighlight">\(k^{-5/3}\)</span> or <span class="math notranslate nohighlight">\(f^{-5/3}\)</span>, where k and f are
the wavenumber and frequency vectors, is estimated using linear
regression with a log transformation:</p>
<div class="math notranslate nohighlight">
\[log10(y) = m*log10(x) + b\]</div>
<p>Which is equivalent to</p>
<div class="math notranslate nohighlight">
\[y = 10^{b} x^{m}\]</div>
<p>Where <span class="math notranslate nohighlight">\(y\)</span> is S(k) or S(f), <span class="math notranslate nohighlight">\(x\)</span> is k or f, <span class="math notranslate nohighlight">\(m\)</span>
is the slope (ideally -5/3), and <span class="math notranslate nohighlight">\(10^{b}\)</span> is the intercept of
y at x^m=1.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_LT83">
<span class="sig-name descname"><span class="pre">dissipation_rate_LT83</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">U_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[6.28,</span> <span class="pre">12.57]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.dissipation_rate_LT83"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_LT83" title="Link to this definition"></a></dt>
<dd><p>Calculate the dissipation rate from the PSD</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>...</em><em>,</em><em>time</em><em>,</em><em>f</em><em>)</em>) – The power spectral density</p></li>
<li><p><strong>U_mag</strong> (<em>xarray.DataArray</em><em> (</em><em>...</em><em>,</em><em>time</em><em>)</em>) – The bin-averaged horizontal velocity [m/s] (from dataset shortcut)</p></li>
<li><p><strong>freq_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>)</em>) – The range over which to integrate/average the spectrum, in units
of the psd frequency vector (Hz or rad/s).
Default = [6.28, 12.57] rad/s</p></li>
<li><p><strong>noise</strong> (<em>float</em><em> or </em><em>array-like</em>) – Instrument noise level in same units as velocity. Typically
found from <cite>adv.turbulence.calc_doppler_noise</cite>.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>epsilon</strong> (<em>xarray.DataArray (…,n_time)</em>) – dataArray of the dissipation rate</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This uses the <cite>standard</cite> formula for dissipation:</p>
<div class="math notranslate nohighlight">
\[S(k) = \alpha \epsilon^{2/3} k^{-5/3} + N\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha = 0.5\)</span> (1.5 for all three velocity
components), <cite>k</cite> is wavenumber, <cite>S(k)</cite> is the turbulent
kinetic energy spectrum, and <a href="#id1"><span class="problematic" id="id2">`</span></a>N’ is the doppler noise level
associated with the TKE spectrum.</p>
<p>With <span class="math notranslate nohighlight">\(k \rightarrow \omega / U\)</span>, then – to preserve variance –
<span class="math notranslate nohighlight">\(S(k) = U S(\omega)\)</span>, and so this becomes:</p>
<div class="math notranslate nohighlight">
\[S(\omega) = \alpha \epsilon^{2/3} \omega^{-5/3} U^{2/3} + N\]</div>
<p>With <span class="math notranslate nohighlight">\(k \rightarrow (2\pi f) / U\)</span>, then</p>
<div class="math notranslate nohighlight">
\[S(\omega) = \alpha \epsilon^{2/3} f^{-5/3} (U/(2*\pi))^{2/3} + N\]</div>
<p>LT83 : Lumley and Terray, “Kinematics of turbulence convected
by a random wave field”. JPO, 1983, vol13, pp2000-2007.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_SF">
<span class="sig-name descname"><span class="pre">dissipation_rate_SF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel_raw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">U_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2.0,</span> <span class="pre">4.0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.dissipation_rate_SF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_SF" title="Link to this definition"></a></dt>
<dd><p>Calculate dissipation rate using the “structure function” (SF) method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel_raw</strong> (<em>xarray.DataArray</em><em> (</em><em>time</em><em>)</em>) – The raw velocity data upon which to perform the SF technique.</p></li>
<li><p><strong>U_mag</strong> (<em>xarray.DataArray</em>) – The bin-averaged horizontal velocity (from dataset shortcut)</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – The sample rate of <cite>vel_raw</cite> [Hz]</p></li>
<li><p><strong>freq_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>)</em>) – The frequency range over which to compute the SF [Hz]
(i.e. the frequency range within which the isotropic
turbulence cascade falls).
Default = [2., 4.] Hz</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>epsilon</strong> (<em>xarray.DataArray</em>) – dataArray of the dissipation rate</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_TE01">
<span class="sig-name descname"><span class="pre">dissipation_rate_TE01</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dat_raw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dat_avg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[6.28,</span> <span class="pre">12.57]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.dissipation_rate_TE01"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.dissipation_rate_TE01" title="Link to this definition"></a></dt>
<dd><p>Calculate the dissipation rate according to TE01.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dat_raw</strong> (<em>xarray.Dataset</em>) – The raw (off the instrument) adv dataset</p></li>
<li><p><strong>dat_avg</strong> (<em>xarray.Dataset</em>) – The bin-averaged adv dataset (calc’d from ‘calc_turbulence’ or
‘do_avg’). The spectra (psd) and basic turbulence statistics
(‘tke_vec’ and ‘stress_vec’) must already be computed.</p></li>
<li><p><strong>freq_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>)</em>) – The range over which to integrate/average the spectrum, in units
of the psd frequency vector (Hz or rad/s).
Default = [6.28, 12.57] rad/s</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>TE01 : Trowbridge, J and Elgar, S, “Turbulence measurements in
the Surf Zone”. JPO, 2001, vol31, pp2403-2417.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.ADVBinner.integral_length_scales">
<span class="sig-name descname"><span class="pre">integral_length_scales</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a_cov</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">U_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#ADVBinner.integral_length_scales"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.ADVBinner.integral_length_scales" title="Link to this definition"></a></dt>
<dd><p>Calculate integral length scales.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a_cov</strong> (<em>xarray.DataArray</em>) – The auto-covariance array (i.e. computed using <cite>autocovariance</cite>).</p></li>
<li><p><strong>U_mag</strong> (<em>xarray.DataArray</em>) – The bin-averaged horizontal velocity (from dataset shortcut)</p></li>
<li><p><strong>fs</strong> (<em>numeric</em>) – The raw sample rate</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>L_int</strong> (<em>numpy.ndarray (…, n_time)</em>) – The integral length scale (T_int*U_mag).</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The integral time scale (T_int) is the lag-time at which the
auto-covariance falls to 1/e.</p>
<p>If T_int is not reached, L_int will default to ‘0’.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.adv.turbulence.turbulence_statistics">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adv.turbulence.</span></span><span class="sig-name descname"><span class="pre">turbulence_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds_raw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rad/s'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adv/turbulence.html#turbulence_statistics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adv.turbulence.turbulence_statistics" title="Link to this definition"></a></dt>
<dd><p>Functional version of <cite>ADVBinner</cite> that computes a suite of turbulence
statistics for the input dataset, and returns a <cite>binned</cite> data object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds_raw</strong> (<em>xarray.Dataset</em>) – The raw adv datset to <cite>bin</cite>, average and compute
turbulence statistics of.</p></li>
<li><p><strong>freq_units</strong> (<em>string</em>) – Frequency units of the returned spectra in either Hz or rad/s
(<cite>f</cite> or <span class="math notranslate nohighlight">\(\omega\)</span>). Default is ‘rad/s’</p></li>
<li><p><strong>window</strong> (<em>string</em><em> or </em><em>array</em>) – The window to use for calculating spectra.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Returns an ‘binned’ (i.e. ‘averaged’) data object. All
fields (variables) of the input data object are averaged in n_bin
chunks. This object also computes the following items over
those chunks:</p>
<ul class="simple">
<li><p>tke_vec : The energy in each component, each components is
alternatively accessible as:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">upup_</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">vpvp_</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">wpwp_</span></code>)</p></li>
<li><p>stress_vec : The Reynolds stresses, each component is
alternatively accessible as:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">upwp_</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">vpwp_</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">upvp_</span></code>)</p></li>
<li><p>U_std : The standard deviation of the horizontal
velocity <cite>U_mag</cite>.</p></li>
<li><p>psd : DataArray containing the spectra of the velocity
in radial frequency units. The data-array contains:
- vel : the velocity spectra array (m^2/s/rad))
- omega : the radial frequncy (rad/s)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="ad2cp-turbulence-analysis">
<h2>AD2CP Turbulence Analysis<a class="headerlink" href="#ad2cp-turbulence-analysis" title="Link to this heading"></a></h2>
<p>Functions for analyzing turbulence from AD2CP measurements
via the <cite>ADPBinner</cite> class.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner" title="mhkit.dolfyn.adp.turbulence.ADPBinner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ADPBinner</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dudz" title="mhkit.dolfyn.adp.turbulence.ADPBinner.dudz"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dudz</span></code></a></p></td>
<td><p>The shear in the first velocity component.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dvdz" title="mhkit.dolfyn.adp.turbulence.ADPBinner.dvdz"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dvdz</span></code></a></p></td>
<td><p>The shear in the second velocity component.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dwdz" title="mhkit.dolfyn.adp.turbulence.ADPBinner.dwdz"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dwdz</span></code></a></p></td>
<td><p>The shear in the third velocity component.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.shear_squared" title="mhkit.dolfyn.adp.turbulence.ADPBinner.shear_squared"><code class="xref py py-obj docutils literal notranslate"><span class="pre">shear_squared</span></code></a></p></td>
<td><p>The horizontal shear squared.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.doppler_noise_level" title="mhkit.dolfyn.adp.turbulence.ADPBinner.doppler_noise_level"><code class="xref py py-obj docutils literal notranslate"><span class="pre">doppler_noise_level</span></code></a></p></td>
<td><p>Calculate bias due to Doppler noise using the noise floor of the velocity spectra.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.reynolds_stress_4beam" title="mhkit.dolfyn.adp.turbulence.ADPBinner.reynolds_stress_4beam"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reynolds_stress_4beam</span></code></a></p></td>
<td><p>Calculate the stresses from the covariance of along-beam velocity measurements</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.stress_tensor_5beam" title="mhkit.dolfyn.adp.turbulence.ADPBinner.stress_tensor_5beam"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stress_tensor_5beam</span></code></a></p></td>
<td><p>Calculate the stresses from the covariance of along-beam velocity measurements</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.check_turbulence_cascade_slope" title="mhkit.dolfyn.adp.turbulence.ADPBinner.check_turbulence_cascade_slope"><code class="xref py py-obj docutils literal notranslate"><span class="pre">check_turbulence_cascade_slope</span></code></a></p></td>
<td><p>This function calculates the slope of the PSD, the power spectra of velocity, within the given frequency range.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_LT83" title="mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_LT83"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dissipation_rate_LT83</span></code></a></p></td>
<td><p>Calculate the TKE dissipation rate from the velocity spectra.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_SF" title="mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_SF"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dissipation_rate_SF</span></code></a></p></td>
<td><p>Calculate TKE dissipation rate from ADCP along-beam velocity using the &quot;structure function&quot; (SF) method.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.friction_velocity" title="mhkit.dolfyn.adp.turbulence.ADPBinner.friction_velocity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">friction_velocity</span></code></a></p></td>
<td><p>Approximate friction velocity from shear stress using a logarithmic profile.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.turbulence.</span></span><span class="sig-name descname"><span class="pre">ADPBinner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_bin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_fft_coh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'up'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_style</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'centered_extended'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mhkit.dolfyn.velocity.VelBinner" title="mhkit.dolfyn.velocity.VelBinner"><code class="xref py py-class docutils literal notranslate"><span class="pre">VelBinner</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.dudz">
<span class="sig-name descname"><span class="pre">dudz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.dudz"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dudz" title="Link to this definition"></a></dt>
<dd><p>The shear in the first velocity component.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<em>xarray.DataArray</em>) – ADCP raw velocity</p></li>
<li><p><strong>orientation</strong> (<em>str</em><em>, </em><em>default=ADPBinner.orientation</em>) – Direction ADCP is facing (‘up’ or ‘down’)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dudz</strong> (<em>xarray.DataArray</em>) – Vertical shear in the X-direction</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The derivative direction is along the profiler’s ‘z’
coordinate (‘dz’ is actually diff(self[‘range’])), not necessarily the
‘true vertical’ direction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.dvdz">
<span class="sig-name descname"><span class="pre">dvdz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.dvdz"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dvdz" title="Link to this definition"></a></dt>
<dd><p>The shear in the second velocity component.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<em>xarray.DataArray</em>) – ADCP raw velocity</p></li>
<li><p><strong>orientation</strong> (<em>str</em><em>, </em><em>default=ADPBinner.orientation</em>) – Direction ADCP is facing (‘up’ or ‘down’)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dvdz</strong> (<em>xarray.DataArray</em>) – Vertical shear in the Y-direction</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The derivative direction is along the profiler’s ‘z’
coordinate (‘dz’ is actually diff(self[‘range’])), not necessarily the
‘true vertical’ direction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.dwdz">
<span class="sig-name descname"><span class="pre">dwdz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.dwdz"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dwdz" title="Link to this definition"></a></dt>
<dd><p>The shear in the third velocity component.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<em>xarray.DataArray</em>) – ADCP raw velocity</p></li>
<li><p><strong>orientation</strong> (<em>str</em><em>, </em><em>default=ADPBinner.orientation</em>) – Direction ADCP is facing (‘up’ or ‘down’)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dwdz</strong> (<em>xarray.DataArray</em>) – Vertical shear in the Z-direction</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The derivative direction is along the profiler’s ‘z’
coordinate (‘dz’ is actually diff(self[‘range’])), not necessarily the
‘true vertical’ direction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.shear_squared">
<span class="sig-name descname"><span class="pre">shear_squared</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.shear_squared"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.shear_squared" title="Link to this definition"></a></dt>
<dd><p>The horizontal shear squared.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>vel</strong> (<em>xarray.DataArray</em>) – ADCP raw velocity</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>xarray.DataArray</em>) – Shear squared in 1/s^2</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is actually (dudz)^2 + (dvdz)^2. So, if those variables
are not actually vertical derivatives of the horizontal
velocity, then this is not the ‘horizontal shear squared’.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="math notranslate nohighlight">\(dudz\)</span>, <span class="math notranslate nohighlight">\(dvdz\)</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.doppler_noise_level">
<span class="sig-name descname"><span class="pre">doppler_noise_level</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pct_fN</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.doppler_noise_level"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.doppler_noise_level" title="Link to this definition"></a></dt>
<dd><p>Calculate bias due to Doppler noise using the noise floor
of the velocity spectra.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>time</em><em>, </em><em>f</em><em>)</em>) – The velocity spectra from a single depth bin (range), typically
in the mid-water range</p></li>
<li><p><strong>pct_fN</strong> (<em>float</em>) – Percent of Nyquist frequency to calculate characeristic frequency</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>doppler_noise (xarray.DataArray)</em> – Doppler noise level in units of m/s</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Approximates bias from</p>
<p>where :math: <cite>sigma_{noise}</cite> is the bias due to Doppler noise,
<cite>N</cite> is the constant variance or spectral density, and <cite>f_{c}</cite>
is the characteristic frequency.</p>
<p>The characteristic frequency is then found as</p>
<p>where <cite>f_{s}/2</cite> is the Nyquist frequency.</p>
<p>Richard, Jean-Baptiste, et al. “Method for identification of Doppler noise
levels in turbulent flow measurements dedicated to tidal energy.” International
Journal of Marine Energy 3 (2013): 52-64.</p>
<p>Thiébaut, Maxime, et al. “Investigating the flow dynamics and turbulence at a
tidal-stream energy site in a highly energetic estuary.” Renewable Energy 195
(2022): 252-262.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.reynolds_stress_4beam">
<span class="sig-name descname"><span class="pre">reynolds_stress_4beam</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_angle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.reynolds_stress_4beam"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.reynolds_stress_4beam" title="Link to this definition"></a></dt>
<dd><p>Calculate the stresses from the covariance of along-beam
velocity measurements</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Raw dataset in beam coordinates</p></li>
<li><p><strong>noise</strong> (<em>int</em><em> or </em><em>xarray.DataArray</em><em> (</em><em>time</em><em>)</em>) – Doppler noise level in units of m/s</p></li>
<li><p><strong>orientation</strong> (<em>str</em><em>, </em><em>default=ds.attrs</em><em>[</em><em>'orientation'</em><em>]</em>) – Direction ADCP is facing (‘up’ or ‘down’)</p></li>
<li><p><strong>beam_angle</strong> (<em>int</em><em>, </em><em>default=ds.attrs</em><em>[</em><em>'beam_angle'</em><em>]</em>) – ADCP beam angle in units of degrees</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>stress_vec</strong> (<em>xarray.DataArray(s)</em>) – Stress vector with u’w’_ and v’w’_ components</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Assumes zero mean pitch and roll.</p>
<p>Assumes ADCP instrument coordinate system is aligned with principal flow
directions.</p>
<p>Stacey, Mark T., Stephen G. Monismith, and Jon R. Burau. “Measurements
of Reynolds stress profiles in unstratified tidal flow.” Journal of
Geophysical Research: Oceans 104.C5 (1999): 10933-10949.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.stress_tensor_5beam">
<span class="sig-name descname"><span class="pre">stress_tensor_5beam</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_angle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tke_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.stress_tensor_5beam"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.stress_tensor_5beam" title="Link to this definition"></a></dt>
<dd><p>Calculate the stresses from the covariance of along-beam
velocity measurements</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Raw dataset in beam coordinates</p></li>
<li><p><strong>noise</strong> (<em>int</em><em> or </em><em>xarray.DataArray with dim 'time'</em><em>, </em><em>default=0</em>) – Doppler noise level in units of m/s</p></li>
<li><p><strong>orientation</strong> (<em>str</em><em>, </em><em>default=ds.attrs</em><em>[</em><em>'orientation'</em><em>]</em>) – Direction ADCP is facing (‘up’ or ‘down’)</p></li>
<li><p><strong>beam_angle</strong> (<em>int</em><em>, </em><em>default=ds.attrs</em><em>[</em><em>'beam_angle'</em><em>]</em>) – ADCP beam angle in units of degrees</p></li>
<li><p><strong>tke_only</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If true, only calculates tke components</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tke_vec(, stress_vec)</strong> (<em>xarray.DataArray or tuple[xarray.DataArray]</em>) – If tke_only is set to False, function returns <cite>tke_vec</cite> and <cite>stress_vec</cite>.
Otherwise only <cite>tke_vec</cite> is returned</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Assumes small-angle approximation is applicable.</p>
<p>Assumes ADCP instrument coordinate system is aligned with principal flow
directions, i.e. u’, v’ and w’ are aligned to the instrument’s (XYZ)
frame of reference.</p>
<p>The stress equations here utilize u’v’_ to account for small variations
in pitch and roll. u’v’_ cannot be directly calculated by a 5-beam ADCP,
so it is approximated by the covariance of <cite>u</cite> and <cite>v</cite>. The uncertainty
introduced by using this approximation is small if deviations from pitch
and roll are small (&lt;= 5 degrees).</p>
<p>Dewey, R., and S. Stringer. “Reynolds stresses and turbulent kinetic
energy estimates from various ADCP beam configurations: Theory.” J. of
Phys. Ocean (2007): 1-35.</p>
<p>Guerra, Maricarmen, and Jim Thomson. “Turbulence measurements from
five-beam acoustic Doppler current profilers.” Journal of Atmospheric
and Oceanic Technology 34.6 (2017): 1267-1284.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.check_turbulence_cascade_slope">
<span class="sig-name descname"><span class="pre">check_turbulence_cascade_slope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.2,</span> <span class="pre">0.4]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.check_turbulence_cascade_slope"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.check_turbulence_cascade_slope" title="Link to this definition"></a></dt>
<dd><p>This function calculates the slope of the PSD, the power spectra
of velocity, within the given frequency range. The purpose of this
function is to check that the region of the PSD containing the
isotropic turbulence cascade decreases at a rate of <span class="math notranslate nohighlight">\(f^{-5/3}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>[</em><em>[</em><em>range</em><em>,</em><em>] </em><em>time</em><em>,</em><em>] </em><em>freq</em><em>)</em>) – The power spectral density (1D, 2D or 3D)</p></li>
<li><p><strong>freq_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>) </em><em>(</em><em>default:</em><em> [</em><em>6.28</em><em>, </em><em>12.57</em><em>]</em><em>)</em>) – The range over which the isotropic turbulence cascade occurs, in
units of the psd frequency vector (Hz or rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>(m, b)</strong> (<em>tuple (slope, y-intercept)</em>) – A tuple containing the coefficients of the log-adjusted linear
regression between PSD and frequency</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Calculates slope based on the <cite>standard</cite> formula for dissipation:</p>
<div class="math notranslate nohighlight">
\[S(k) = \alpha \epsilon^{2/3} k^{-5/3} + N\]</div>
<p>The slope of the isotropic turbulence cascade, which should be
equal to <span class="math notranslate nohighlight">\(k^{-5/3}\)</span> or <span class="math notranslate nohighlight">\(f^{-5/3}\)</span>, where k and f are
the wavenumber and frequency vectors, is estimated using linear
regression with a log transformation:</p>
<div class="math notranslate nohighlight">
\[log10(y) = m*log10(x) + b\]</div>
<p>Which is equivalent to</p>
<div class="math notranslate nohighlight">
\[y = 10^{b} x^{m}\]</div>
<p>Where <span class="math notranslate nohighlight">\(y\)</span> is S(k) or S(f), <span class="math notranslate nohighlight">\(x\)</span> is k or f, <span class="math notranslate nohighlight">\(m\)</span>
is the slope (ideally -5/3), and <span class="math notranslate nohighlight">\(10^{b}\)</span> is the intercept of
y at x^m=1.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_LT83">
<span class="sig-name descname"><span class="pre">dissipation_rate_LT83</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">U_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.2,</span> <span class="pre">0.4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.dissipation_rate_LT83"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_LT83" title="Link to this definition"></a></dt>
<dd><p>Calculate the TKE dissipation rate from the velocity spectra.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psd</strong> (<em>xarray.DataArray</em><em> (</em><em>time</em><em>,</em><em>f</em><em>)</em>) – The power spectral density from a single depth bin (range)</p></li>
<li><p><strong>U_mag</strong> (<em>xarray.DataArray</em><em> (</em><em>time</em><em>)</em>) – The bin-averaged horizontal velocity (a.k.a. speed) from a single depth bin (range)</p></li>
<li><p><strong>f_range</strong> (<em>iterable</em><em>(</em><em>2</em><em>)</em>) – The range over which to integrate/average the spectrum, in units
of the psd frequency vector (Hz or rad/s)</p></li>
<li><p><strong>noise</strong> (<em>float</em><em> or </em><em>array-like</em>) – Instrument noise level in same units as velocity. Typically
found from <cite>adp.turbulence.doppler_noise_level</cite>.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dissipation_rate</strong> (<em>xarray.DataArray (…,n_time)</em>) – Turbulent kinetic energy dissipation rate</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This uses the <cite>standard</cite> formula for dissipation:</p>
<div class="math notranslate nohighlight">
\[S(k) = \alpha \epsilon^{2/3} k^{-5/3} + N\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha = 0.5\)</span> (1.5 for all three velocity
components), <cite>k</cite> is wavenumber, <cite>S(k)</cite> is the turbulent
kinetic energy spectrum, and <a href="#id3"><span class="problematic" id="id4">`</span></a>N’ is the doppler noise level
associated with the TKE spectrum.</p>
<p>With <span class="math notranslate nohighlight">\(k \rightarrow \omega / U\)</span>, then – to preserve variance –
<span class="math notranslate nohighlight">\(S(k) = U S(\omega)\)</span>, and so this becomes:</p>
<div class="math notranslate nohighlight">
\[S(\omega) = \alpha \epsilon^{2/3} \omega^{-5/3} U^{2/3} + N\]</div>
<p>With <span class="math notranslate nohighlight">\(k \rightarrow (2\pi f) / U\)</span>, then</p>
<div class="math notranslate nohighlight">
\[S(\omega) = \alpha \epsilon^{2/3} f^{-5/3} (U/(2*\pi))^{2/3} + N\]</div>
<p>LT83 : Lumley and Terray, “Kinematics of turbulence convected
by a random wave field”. JPO, 1983, vol13, pp2000-2007.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_SF">
<span class="sig-name descname"><span class="pre">dissipation_rate_SF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vel_raw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">5]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.dissipation_rate_SF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.dissipation_rate_SF" title="Link to this definition"></a></dt>
<dd><p>Calculate TKE dissipation rate from ADCP along-beam velocity using the
“structure function” (SF) method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel_raw</strong> (<em>xarray.DataArray</em>) – The raw beam velocity data (one beam, last dimension time) upon
which to perform the SF technique.</p></li>
<li><p><strong>r_range</strong> (<em>numeric</em><em>, </em><em>default=</em><em>[</em><em>1</em><em>,</em><em>5</em><em>]</em>) – Range of r in [m] to calc dissipation across. Low end of range should be
bin size, upper end of range is limited to the length of largest eddies
in the inertial subrange.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>dissipation_rate</strong> (<em>xarray.DataArray (range, time)</em>) – Dissipation rate estimated from the structure function</p></li>
<li><p><strong>noise</strong> (<em>xarray.DataArray (range, time)</em>) – Noise offset estimated from the structure function at r = 0</p></li>
<li><p><strong>structure_function</strong> (<em>xarray.DataArray (range, r, time)</em>) – Structure function D(z,r)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Dissipation rate outputted by this function is only valid if the isotropic
turbulence cascade can be seen in the TKE spectra.</p>
<p>Velocity data must be in beam coordinates and should be cleaned of surface
interference.</p>
<p>This method calculates the 2nd order structure function:</p>
<div class="math notranslate nohighlight">
\[D(z,r) = [(u'(z) - u`(z+r))^2]\]</div>
<p>where <cite>u’</cite> is the velocity fluctuation <cite>z</cite> is the depth bin,
<cite>r</cite> is the separation between depth bins, and [] denotes a time average
(size ‘ADPBinner.n_bin’).</p>
<p>The stucture function can then be used to estimate the dissipation rate:</p>
<div class="math notranslate nohighlight">
\[D(z,r) = C^2 \epsilon^{2/3} r^{2/3} + N\]</div>
<p>where <cite>C</cite> is a constant (set to 2.1), <cite>epsilon</cite> is the dissipation rate,
and <cite>N</cite> is the offset due to noise. Noise is then calculated by</p>
<div class="math notranslate nohighlight">
\[\sigma = (N/2)^{1/2}\]</div>
<p>Wiles, et al, “A novel technique for measuring the rate of
turbulent dissipation in the marine environment”
GRL, 2006, 33, L21608.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mhkit.dolfyn.adp.turbulence.ADPBinner.friction_velocity">
<span class="sig-name descname"><span class="pre">friction_velocity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds_avg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upwp_</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_inds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">slice(1,</span> <span class="pre">5,</span> <span class="pre">None)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/adp/turbulence.html#ADPBinner.friction_velocity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.adp.turbulence.ADPBinner.friction_velocity" title="Link to this definition"></a></dt>
<dd><p>Approximate friction velocity from shear stress using a
logarithmic profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds_avg</strong> (<em>xarray.Dataset</em>) – Bin-averaged dataset containing <cite>stress_vec</cite></p></li>
<li><p><strong>upwp</strong> (<em>xarray.DataArray</em>) – First component of Reynolds shear stress vector, “u-prime v-prime bar”
Ex <cite>ds_avg[‘stress_vec’].sel(tau=’upwp_’)</cite></p></li>
<li><p><strong>z_inds</strong> (<em>slice</em><em>(</em><em>int</em><em>,</em><em>int</em><em>)</em>) – Depth indices to use for profile. Default = slice(1, 5)</p></li>
<li><p><strong>H</strong> (<em>numeric</em><em> (</em><em>default=`ds_avg.depth`</em><em>)</em>) – Total water depth</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>u_star</strong> (<em>xarray.DataArray</em>) – Friction velocity</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="tools">
<h2>Tools<a class="headerlink" href="#tools" title="Link to this heading"></a></h2>
<p>Spectral analysis and miscellaneous DOLfYN functions are
stored here. These functions are used throughout DOLfYN’s
core code and may also be helpful to users in general.</p>
<section id="module-mhkit.dolfyn.tools.fft">
<span id="fft-based-functions"></span><h3>FFT-based Functions<a class="headerlink" href="#module-mhkit.dolfyn.tools.fft" title="Link to this heading"></a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.fft.fft_frequency" title="mhkit.dolfyn.tools.fft.fft_frequency"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fft_frequency</span></code></a></p></td>
<td><p>Compute the frequency vector for a given <cite>nfft</cite> and <cite>fs</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.fft.psd_1D" title="mhkit.dolfyn.tools.fft.psd_1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">psd_1D</span></code></a></p></td>
<td><p>Compute the power spectral density (PSD).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.fft.cpsd_1D" title="mhkit.dolfyn.tools.fft.cpsd_1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpsd_1D</span></code></a></p></td>
<td><p>Compute the cross power spectral density (CPSD) of the signals <cite>a</cite> and <cite>b</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.fft.cpsd_quasisync_1D" title="mhkit.dolfyn.tools.fft.cpsd_quasisync_1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpsd_quasisync_1D</span></code></a></p></td>
<td><p>Compute the cross power spectral density (CPSD) of the signals <cite>a</cite> and <cite>b</cite>.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.fft.fft_frequency">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.fft.</span></span><span class="sig-name descname"><span class="pre">fft_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nfft</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/fft.html#fft_frequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.fft.fft_frequency" title="Link to this definition"></a></dt>
<dd><p>Compute the frequency vector for a given <cite>nfft</cite> and <cite>fs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> (<em>float</em>) – The sampling frequency (e.g. samples/sec)</p></li>
<li><p><strong>nfft</strong> (<em>int</em>) – The number of samples in a window.</p></li>
<li><p><strong>full</strong> (<em>bool</em>) – Whether to return half frequencies (positive), or the full frequencies.
Default = False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>freq</strong> (<em>numpy.ndarray</em>) – The frequency vector, in same units as ‘fs’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.fft.cpsd_quasisync_1D">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.fft.</span></span><span class="sig-name descname"><span class="pre">cpsd_quasisync_1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfft</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/fft.html#cpsd_quasisync_1D"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.fft.cpsd_quasisync_1D" title="Link to this definition"></a></dt>
<dd><p>Compute the cross power spectral density (CPSD) of the signals <cite>a</cite> and <cite>b</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The first signal.</p></li>
<li><p><strong>b</strong> (<em>numpy.ndarray</em>) – The second signal.</p></li>
<li><p><strong>nfft</strong> (<em>int</em>) – The number of points in the fft.</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – The sample rate (e.g. sample/second).</p></li>
<li><p><strong>window</strong> (<em>{None</em><em>, </em><em>1</em><em>, </em><em>'hann'</em><em>, </em><em>numpy.ndarray}</em>) – The window to use (default: ‘hann’). Valid entries are:
- None,1               : uses a ‘boxcar’ or ones window.
- ‘hann’               : hanning window.
- a length(nfft) array : use this as the window directly.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cpsd</strong> (<em>numpy.ndarray</em>) – The cross-spectral density of <cite>a</cite> and <cite>b</cite>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">psd()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">coherence_1D()</span></code>, <a class="reference internal" href="#mhkit.dolfyn.tools.fft.cpsd_1D" title="mhkit.dolfyn.tools.fft.cpsd_1D"><code class="xref py py-func docutils literal notranslate"><span class="pre">cpsd_1D()</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.fft</span></code></p>
</div>
<p class="rubric">Notes</p>
<p><cite>a</cite> and <cite>b</cite> do not need to be ‘tightly’ synchronized, and can even
be different lengths, but the first- and last-index of both series
should be synchronized (to whatever degree you want unbiased
phases).</p>
<p>This performs:</p>
<div class="math notranslate nohighlight">
\[fft(a)*conj(fft(b))\]</div>
<p>Note that this is consistent with <code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.correlate()</span></code>.</p>
<p>It detrends the data and uses a minimum of 50% overlap for the
shorter of <cite>a</cite> and <cite>b</cite>. For the longer, the overlap depends on the
difference in size.  1-(l_short/l_long) data will be underutilized
(where l_short and l_long are the length of the shorter and longer
series, respectively).</p>
<p>The units of the spectra is the product of the units of <cite>a</cite> and
<cite>b</cite>, divided by the units of fs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.fft.cpsd_1D">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.fft.</span></span><span class="sig-name descname"><span class="pre">cpsd_1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfft</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/fft.html#cpsd_1D"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.fft.cpsd_1D" title="Link to this definition"></a></dt>
<dd><p>Compute the cross power spectral density (CPSD) of the signals <cite>a</cite> and <cite>b</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The first signal.</p></li>
<li><p><strong>b</strong> (<em>numpy.ndarray</em>) – The second signal.</p></li>
<li><p><strong>nfft</strong> (<em>int</em>) – The number of points in the fft.</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – The sample rate (e.g. sample/second).</p></li>
<li><p><strong>window</strong> (<em>{None</em><em>, </em><em>1</em><em>, </em><em>'hann'</em><em>, </em><em>numpy.ndarray}</em>) – The window to use (default: ‘hann’). Valid entries are:
- None,1               : uses a ‘boxcar’ or ones window.
- ‘hann’               : hanning window.
- a length(nfft) array : use this as the window directly.</p></li>
<li><p><strong>step</strong> (<em>int</em>) – Use this to specify the overlap.  For example:
- step : nfft/2 specifies a 50% overlap.
- step : nfft specifies no overlap.
- step=2*nfft means that half the data will be skipped.
By default, <cite>step</cite> is calculated to maximize data use, have
at least 50% overlap and minimize the number of ensembles.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cpsd</strong> (<em>numpy.ndarray</em>) – The cross-spectral density of <cite>a</cite> and <cite>b</cite>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">psd()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">coherence_1D()</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</div>
<p class="rubric">Notes</p>
<p>cpsd removes a linear trend from the signals.</p>
<p>The two signals should be the same length, and should both be real.</p>
<p>This performs:</p>
<div class="math notranslate nohighlight">
\[fft(a)*conj(fft(b))\]</div>
<p>This implementation is consistent with the numpy.correlate
definition of correlation.  (The conjugate of D.B. Chelton’s
definition of correlation.)</p>
<p>The units of the spectra is the product of the units of <cite>a</cite> and
<cite>b</cite>, divided by the units of fs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.fft.psd_1D">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.fft.</span></span><span class="sig-name descname"><span class="pre">psd_1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfft</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hann'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/fft.html#psd_1D"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.fft.psd_1D" title="Link to this definition"></a></dt>
<dd><p>Compute the power spectral density (PSD).</p>
<p>This function computes the one-dimensional <cite>n</cite>-point PSD.</p>
<p>The units of the spectra is the product of the units of <cite>a</cite> and
<cite>b</cite>, divided by the units of fs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The first signal, as a 1D vector</p></li>
<li><p><strong>nfft</strong> (<em>int</em>) – The number of points in the fft.</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – The sample rate (e.g. sample/second).</p></li>
<li><p><strong>window</strong> (<em>{None</em><em>, </em><em>1</em><em>, </em><em>'hann'</em><em>, </em><em>numpy.ndarray}</em>) – The window to use (default: ‘hann’). Valid entries are:
- None,1               : uses a ‘boxcar’ or ones window.
- ‘hann’               : hanning window.
- a length(nfft) array : use this as the window directly.</p></li>
<li><p><strong>step</strong> (<em>int</em>) – Use this to specify the overlap.  For example:
- step : nfft/2 specifies a 50% overlap.
- step : nfft specifies no overlap.
- step=2*nfft means that half the data will be skipped.
By default, <cite>step</cite> is calculated to maximize data use, have
at least 50% overlap and minimize the number of ensembles.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cpsd</strong> (<em>numpy.ndarray</em>) – The cross-spectral density of <cite>a</cite> and <cite>b</cite>.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Credit: This function’s line of code was copied from JN’s fast_psd.m
routine.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#mhkit.dolfyn.tools.fft.cpsd_1D" title="mhkit.dolfyn.tools.fft.cpsd_1D"><code class="xref py py-func docutils literal notranslate"><span class="pre">cpsd_1D()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">coherence_1D()</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</div>
</dd></dl>

</section>
<section id="module-mhkit.dolfyn.tools.misc">
<span id="other-functions"></span><h3>Other Functions<a class="headerlink" href="#module-mhkit.dolfyn.tools.misc" title="Link to this heading"></a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.detrend_array" title="mhkit.dolfyn.tools.misc.detrend_array"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrend_array</span></code></a></p></td>
<td><p>Remove a linear trend from arr.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.group" title="mhkit.dolfyn.tools.misc.group"><code class="xref py py-obj docutils literal notranslate"><span class="pre">group</span></code></a></p></td>
<td><p>Find continuous segments in a boolean array.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.slice1d_along_axis" title="mhkit.dolfyn.tools.misc.slice1d_along_axis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slice1d_along_axis</span></code></a></p></td>
<td><p>Return an iterator object for looping over 1-D slices, along <code class="docutils literal notranslate"><span class="pre">axis</span></code>, of an array of shape arr_shape.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.convert_degrees" title="mhkit.dolfyn.tools.misc.convert_degrees"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convert_degrees</span></code></a></p></td>
<td><p>Converts between the 'cartesian angle' (counter-clockwise from East) and the 'polar angle' in (degrees clockwise from North)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.fillgaps" title="mhkit.dolfyn.tools.misc.fillgaps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fillgaps</span></code></a></p></td>
<td><p>Linearly fill NaN value in an array.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.interpgaps" title="mhkit.dolfyn.tools.misc.interpgaps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">interpgaps</span></code></a></p></td>
<td><p>Fill gaps (NaN values) in <code class="docutils literal notranslate"><span class="pre">a</span></code> by linear interpolation along dimension <code class="docutils literal notranslate"><span class="pre">dim</span></code> with the point spacing specified in <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.tools.misc.medfiltnan" title="mhkit.dolfyn.tools.misc.medfiltnan"><code class="xref py py-obj docutils literal notranslate"><span class="pre">medfiltnan</span></code></a></p></td>
<td><p>Do a running median filter of the data.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.detrend_array">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">detrend_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_place</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#detrend_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.detrend_array" title="Link to this definition"></a></dt>
<dd><p>Remove a linear trend from arr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>array_like</em>) – The array from which to remove a linear trend.</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – The axis along which to operate.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method is copied from the matplotlib.mlab library, but
implements the covariance calcs explicitly for added speed.</p>
<p>This works much faster than mpl.mlab.detrend for multi-dimensional
arrays, and is also faster than linalg.lstsq methods.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.group">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.group" title="Link to this definition"></a></dt>
<dd><p>Find continuous segments in a boolean array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bl</strong> (<em>numpy.ndarray</em><em> (</em><em>dtype='bool'</em><em>)</em>) – The input boolean array.</p></li>
<li><p><strong>min_length</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) – Specifies the minimum number of continuous points to consider a
<cite>group</cite> (i.e. that will be returned).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>np.ndarray(slices,)</em>) – a vector of slice objects, which indicate the continuous
sections where <cite>bl</cite> is True.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function has funny behavior for single points.  It will
return the same two indices for the beginning and end.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.slice1d_along_axis">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">slice1d_along_axis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#slice1d_along_axis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.slice1d_along_axis" title="Link to this definition"></a></dt>
<dd><p>Return an iterator object for looping over 1-D slices, along <code class="docutils literal notranslate"><span class="pre">axis</span></code>, of
an array of shape arr_shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr_shape</strong> (<em>tuple</em><em>,</em><em>list</em>) – Shape of the array over which the slices will be made.</p></li>
<li><p><strong>axis</strong> (<em>integer</em>) – Axis along which <cite>arr</cite> is sliced.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Iterator</strong> (<em>object</em>) – The iterator object returns slice objects which slices arrays of
shape arr_shape into 1-D arrays.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>&gt;&gt; out=np.empty(replace(arr.shape,0,1))
&gt;&gt; for slc in slice1d_along_axis(arr.shape,axis=0):
&gt;&gt;     out[slc]=my_1d_function(arr[slc])</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.convert_degrees">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">convert_degrees</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tidal_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#convert_degrees"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.convert_degrees" title="Link to this definition"></a></dt>
<dd><p>Converts between the ‘cartesian angle’ (counter-clockwise from East) and
the ‘polar angle’ in (degrees clockwise from North)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deg</strong> (<em>float</em><em> or </em><em>array-like</em>) – Number or array in ‘degrees CCW from East’ or ‘degrees CW from North’</p></li>
<li><p><strong>tidal_mode</strong> (<em>bool</em>) – If true, range is set from 0 to +/-180 degrees. If false, range is 0 to
360 degrees. Default = True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>float or array-like</em>) – Input data transformed to ‘degrees CW from North’ or
‘degrees CCW from East’, respectively (based on <cite>deg</cite>)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The same algorithm is used to convert back and forth between ‘CCW from E’
and ‘CW from N’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.fillgaps">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">fillgaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxgap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extrapFlg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#fillgaps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.fillgaps" title="Link to this definition"></a></dt>
<dd><p>Linearly fill NaN value in an array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The array to be filled.</p></li>
<li><p><strong>maxgap</strong> (<em>numpy.ndarray</em><em> (</em><em>optional: inf</em><em>)</em>) – The maximum gap to fill.</p></li>
<li><p><strong>dim</strong> (<em>int</em><em> (</em><em>optional: 0</em><em>)</em>) – The dimension to operate along.</p></li>
<li><p><strong>extrapFlg</strong> (<em>bool</em><em> (</em><em>optional: False</em><em>)</em>) – Whether to extrapolate if NaNs are found at the ends of the
array.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">mhkit.dolfyn.tools.misc._interpgaps</span></code></dt><dd><p>Linearly interpolates in time.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>This function interpolates assuming spacing/timestep between
successive points is constant. If the spacing is not constant, use
_interpgaps.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.interpgaps">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">interpgaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxgap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extrapFlg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#interpgaps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.interpgaps" title="Link to this definition"></a></dt>
<dd><p>Fill gaps (NaN values) in <code class="docutils literal notranslate"><span class="pre">a</span></code> by linear interpolation along
dimension <code class="docutils literal notranslate"><span class="pre">dim</span></code> with the point spacing specified in <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The array containing NaN values to be filled.</p></li>
<li><p><strong>t</strong> (<em>numpy.ndarray</em><em> (</em><em>len</em><em>(</em><em>t</em><em>) </em><em>== a.shape</em><em>[</em><em>dim</em><em>]</em><em>)</em>) – Independent variable of the points in <code class="docutils literal notranslate"><span class="pre">a</span></code>, e.g. timestep</p></li>
<li><p><strong>maxgap</strong> (<em>numpy.ndarray</em><em> (</em><em>optional: inf</em><em>)</em>) – The maximum gap to fill.</p></li>
<li><p><strong>dim</strong> (<em>int</em><em> (</em><em>optional: 0</em><em>)</em>) – The dimension to operate along.</p></li>
<li><p><strong>extrapFlg</strong> (<em>bool</em><em> (</em><em>optional: False</em><em>)</em>) – Whether to extrapolate if NaNs are found at the ends of the
array.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#mhkit.dolfyn.tools.misc.fillgaps" title="mhkit.dolfyn.tools.misc.fillgaps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mhkit.dolfyn.tools.misc.fillgaps</span></code></a></dt><dd><p>Linearly interpolates in array-index space.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.tools.misc.medfiltnan">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.misc.</span></span><span class="sig-name descname"><span class="pre">medfiltnan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/tools/misc.html#medfiltnan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.tools.misc.medfiltnan" title="Link to this definition"></a></dt>
<dd><p>Do a running median filter of the data. Regions where more than
<code class="docutils literal notranslate"><span class="pre">thresh</span></code> fraction of the points are NaN are set to NaN.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – 2D array containing data to be filtered.</p></li>
<li><p><strong>kernel_size</strong> (<em>numpy.ndarray</em><em> or </em><em>list</em><em>, </em><em>optional</em>) – A scalar or a list of length 2, giving the size of the median
filter window in each dimension. Elements of kernel_size should
be odd. If kernel_size is a scalar, then this scalar is used as
the size in each dimension.</p></li>
<li><p><strong>thresh</strong> (<em>int</em>) – Maximum gap in <em>a</em> to filter over</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>numpy.ndarray</em>) – 2D array of same size containing filtered data</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal.medfilt2d</span></code></p>
</div>
</dd></dl>

</section>
</section>
<section id="time">
<h2>Time<a class="headerlink" href="#time" title="Link to this heading"></a></h2>
<p>The time submodule contains functions to modify the format
of the stored time between a variety of time formats.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.epoch2dt64" title="mhkit.dolfyn.time.epoch2dt64"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epoch2dt64</span></code></a></p></td>
<td><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to numpy.datetime64 array</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.dt642epoch" title="mhkit.dolfyn.time.dt642epoch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dt642epoch</span></code></a></p></td>
<td><p>Convert numpy.datetime64 array to epoch time (seconds since 1/1/1970 00:00:00)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.date2dt64" title="mhkit.dolfyn.time.date2dt64"><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2dt64</span></code></a></p></td>
<td><p>Convert numpy.datetime64 array to list of datetime objects</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.dt642date" title="mhkit.dolfyn.time.dt642date"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dt642date</span></code></a></p></td>
<td><p>Convert numpy.datetime64 array to list of datetime objects</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.epoch2date" title="mhkit.dolfyn.time.epoch2date"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epoch2date</span></code></a></p></td>
<td><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to a list of datetime objects</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.date2str" title="mhkit.dolfyn.time.date2str"><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2str</span></code></a></p></td>
<td><p>Convert list of datetime objects to legible strings</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.date2epoch" title="mhkit.dolfyn.time.date2epoch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2epoch</span></code></a></p></td>
<td><p>Convert list of datetime objects to epoch time</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.date2matlab" title="mhkit.dolfyn.time.date2matlab"><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2matlab</span></code></a></p></td>
<td><p>Convert list of datetime objects to MATLAB datenum</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.time.matlab2date" title="mhkit.dolfyn.time.matlab2date"><code class="xref py py-obj docutils literal notranslate"><span class="pre">matlab2date</span></code></a></p></td>
<td><p>Convert MATLAB datenum to list of datetime objects</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.epoch2dt64">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">epoch2dt64</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ep_time</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#epoch2dt64"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.epoch2dt64" title="Link to this definition"></a></dt>
<dd><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to
numpy.datetime64 array</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ep_time</strong> (<em>xarray.DataArray</em>) – Time coordinate data-array or single time element</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>numpy.datetime64</em>) – The converted datetime64 array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.dt642epoch">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">dt642epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt64</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#dt642epoch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.dt642epoch" title="Link to this definition"></a></dt>
<dd><p>Convert numpy.datetime64 array to epoch time
(seconds since 1/1/1970 00:00:00)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt64</strong> (<em>numpy.datetime64</em>) – Single or array of datetime64 object(s)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>float</em>) – Epoch time (seconds since 1/1/1970 00:00:00)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.date2dt64">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">date2dt64</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#date2dt64"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.date2dt64" title="Link to this definition"></a></dt>
<dd><p>Convert numpy.datetime64 array to list of datetime objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>time</strong> (<em>datetime.datetime</em>) – The converted datetime object</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dt64</strong> (<em>numpy.datetime64</em>) – Single or array of datetime64 object(s)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.dt642date">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">dt642date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt64</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#dt642date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.dt642date" title="Link to this definition"></a></dt>
<dd><p>Convert numpy.datetime64 array to list of datetime objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt64</strong> (<em>numpy.datetime64</em>) – Single or array of datetime64 object(s)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>datetime.datetime</em>) – The converted datetime object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.epoch2date">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">epoch2date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ep_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset_hr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_str</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#epoch2date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.epoch2date" title="Link to this definition"></a></dt>
<dd><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to a list
of datetime objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ep_time</strong> (<em>xarray.DataArray</em>) – Time coordinate data-array or single time element</p></li>
<li><p><strong>offset_hr</strong> (<em>int</em>) – Number of hours to offset time by (e.g. UTC -7 hours = PDT)</p></li>
<li><p><strong>to_str</strong> (<em>logical</em>) – Converts datetime object to a readable string</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>datetime.datetime</em>) – The converted datetime object or list(strings)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The specific time instance is set during deployment, usually sync’d to the
deployment computer. The time seen by DOLfYN is in the timezone of the
deployment computer, which is unknown to DOLfYN.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.date2str">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">date2str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format_str</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#date2str"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.date2str" title="Link to this definition"></a></dt>
<dd><p>Convert list of datetime objects to legible strings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dt</strong> (<em>datetime.datetime</em>) – Single or list of datetime object(s)</p></li>
<li><p><strong>format_str</strong> (<em>string</em>) – Timestamp string formatting. Default is ‘%Y-%m-%d %H:%M:%S.%f’
See datetime.strftime documentation for timestamp string formatting.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>string</em>) – Converted timestamps</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.date2epoch">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">date2epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#date2epoch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.date2epoch" title="Link to this definition"></a></dt>
<dd><p>Convert list of datetime objects to epoch time</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>datetime.datetime</em>) – Single or list of datetime object(s)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>float</em>) – Datetime converted to epoch time (seconds since 1/1/1970 00:00:00)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.date2matlab">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">date2matlab</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#date2matlab"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.date2matlab" title="Link to this definition"></a></dt>
<dd><p>Convert list of datetime objects to MATLAB datenum</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>datetime.datetime</em>) – List of datetime objects</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>time</strong> (<em>float</em>) – List of timestamps in MATLAB datnum format</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mhkit.dolfyn.time.matlab2date">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.time.</span></span><span class="sig-name descname"><span class="pre">matlab2date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matlab_dn</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/time.html#matlab2date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mhkit.dolfyn.time.matlab2date" title="Link to this definition"></a></dt>
<dd><p>Convert MATLAB datenum to list of datetime objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>matlab_dn</strong> (<em>float</em>) – List of timestamps in MATLAB datnum format</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dt</strong> (<em>datetime.datetime</em>) – List of datetime objects</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.loads.html" class="btn btn-neutral float-left" title="Loads Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.mooring.html" class="btn btn-neutral float-right" title="Mooring Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>