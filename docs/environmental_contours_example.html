<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MHKiT Environmental Contours &mdash; MHKiT v0.5.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/mhkit.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MHKiT WEC-Sim Example" href="wecsim_example.html" />
    <link rel="prev" title="MHKiT Loads Module" href="loads_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MHKiT
          </a>
              <div class="version">
                v0.5.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="qc.html">QC Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="wave.html">Wave Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="river.html">River Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="tidal.html">Tidal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="power.html">Power Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="loads.html">Loads Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dolfyn.html">DOLfYN Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils Module</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="python.html">MHKiT-Python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="python.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#api-documentation">API Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="python.html#examples">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="qc_example.html">MHKiT Quality Control Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="wave_example.html">MHKiT Wave Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="river_example.html">MHKiT River Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tidal_example.html">MHKiT Tidal Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_example.html">MHKiT Power Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="loads_example.html">MHKiT Loads Module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MHKiT Environmental Contours</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#1.-Request-Spectral-Wave-Density-Data-from-NDBC">1. Request Spectral Wave Density Data from NDBC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-Calculate-H_{m0}-and-T_e-using-the-NDBC-Data">2. Calculate <span class="math notranslate nohighlight">\(H_{m0}\)</span> and <span class="math notranslate nohighlight">\(T_e\)</span> using the NDBC Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Find-the-contour-line-for-the-100-year">3. Find the contour line for the 100 year</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-Plot-overlay-of-the-data-and-contour">4. Plot overlay of the data and contour</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Other-Contour-Methods">Other Contour Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Resource-Clusters">Resource Clusters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wecsim_example.html">MHKiT WEC-Sim Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="SWAN_example.html">MHKiT SWAN Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="WPTO_hindcast_example.html">MHKiT WPTO Hindcast Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="cdip_example.html">MHKiT CDIP IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="PacWave_resource_characterization_example.html">PacWave Resource Assessment</a></li>
<li class="toctree-l3"><a class="reference internal" href="Delft3D_example.html">Delft3D IO Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="adcp_example.html">Reading ADCP Data with MHKiT</a></li>
<li class="toctree-l3"><a class="reference internal" href="adv_example.html">Reading ADV Data with MHKiT</a></li>
<li class="toctree-l3"><a class="reference internal" href="extreme_response_MLER_example.html">MLER example</a></li>
<li class="toctree-l3"><a class="reference internal" href="extreme_response_contour_example.html">Extreme Conditions Modeling - Contour Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="extreme_response_full_sea_state_example.html">Extreme Conditions Modeling - Full Sea State Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="short_term_extremes_example.html">MHKit Short-term Extreme Loads</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#online-forum">Online Forum</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#software-tests">Software Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="matlab.html">MHKiT-MATLAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="python.html">MHKiT-Python</a></li>
      <li class="breadcrumb-item active">MHKiT Environmental Contours</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/environmental_contours_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="MHKiT-Environmental-Contours">
<h1>MHKiT Environmental Contours<a class="headerlink" href="#MHKiT-Environmental-Contours" title="Permalink to this heading"></a></h1>
<p>Environmental contours of extreme sea states can be used as a part of reliability-based design for offshore structures, including wave energy converters (WECs). Environmental contours provide estimations of extreme sea states based on short-term data (e.g. 10 years used to estimate a 100-year event). These environmental contours describe extreme sea states by characterizing the resource, defining sea states for extreme condition analysis, and developing a framework for analyzing survivability of
a design.</p>
<p>MHKiT includes functions adapted from the <a class="reference external" href="https://github.com/WEC-Sim/WDRT">WDRT</a> for creating environmental contours of extreme sea states using a principal component analysis (PCA) methodology, with additional improvements for characterizing the joint probability distribution of sea states. As a demonstration, this notebook will walk through the following steps to find a 100-year sea state for NDBC buoy 46022 using 16 years of spectral wave density data.</p>
<ol class="arabic simple">
<li><p>Request Spectral Wave Density Data from NDBC</p></li>
<li><p>Calculate Hm0 and Te using the requested data</p></li>
<li><p>Find the data’s 100-year contour</p></li>
<li><p>Plot the data and the 100-year contour</p></li>
</ol>
<p>We will start by importing the necessary python packages (<code class="docutils literal notranslate"><span class="pre">scipy</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code>), and MHKiT <code class="docutils literal notranslate"><span class="pre">wave</span></code> submodules (<code class="docutils literal notranslate"><span class="pre">resource</span></code>, <code class="docutils literal notranslate"><span class="pre">contours</span></code>, <code class="docutils literal notranslate"><span class="pre">graphics</span></code>, and <code class="docutils literal notranslate"><span class="pre">io.ndbc</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from mhkit.wave import resource, contours, graphics
import matplotlib.pyplot as plt
from mhkit.wave.io import ndbc
from scipy import stats
import pandas as pd
import numpy as np
</pre></div>
</div>
</div>
<section id="1.-Request-Spectral-Wave-Density-Data-from-NDBC">
<h2>1. Request Spectral Wave Density Data from NDBC<a class="headerlink" href="#1.-Request-Spectral-Wave-Density-Data-from-NDBC" title="Permalink to this heading"></a></h2>
<p>MHKiT can be used to request historical data from the National Data Buoy Center (<a class="reference external" href="https://www.ndbc.noaa.gov/">NDBC</a>). This process is split into the following steps:</p>
<ul class="simple">
<li><p>Query available NDBC data</p></li>
<li><p>Select years of interest</p></li>
<li><p>Request Data from NDBC</p></li>
<li><p>Convert the DataFrames to DateTime Index</p></li>
</ul>
<section id="Query-available-NDBC-data">
<h3>Query available NDBC data<a class="headerlink" href="#Query-available-NDBC-data" title="Permalink to this heading"></a></h3>
<p>Looking at the help for the <code class="docutils literal notranslate"><span class="pre">ndbc.available_data</span></code> function (<code class="docutils literal notranslate"><span class="pre">help(ndbc.available_data)</span></code>) the function requires a parameter to be specified and optionally the user may provide a station ID as a string. A full list of available historical parameters can be found <a class="reference external" href="https://www.ndbc.noaa.gov/data/historical/">here</a> although only some of these are currently supported. We are interested in historical spectral wave density data <code class="docutils literal notranslate"><span class="pre">'swden'</span></code> (from which we may calculate Hm0 and Te). Additionally,
we will specify the buoy number as <code class="docutils literal notranslate"><span class="pre">'46022'</span></code> to only return data associated with this site.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Specify the parameter as spectral wave density and the buoy number to be 46022
parameter = &#39;swden&#39;
buoy_number = &#39;46022&#39;
ndbc_available_data= ndbc.available_data(parameter, buoy_number)
ndbc_available_data.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>year</th>
      <th>filename</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1541</th>
      <td>46022</td>
      <td>1996</td>
      <td>46022w1996.txt.gz</td>
    </tr>
    <tr>
      <th>1542</th>
      <td>46022</td>
      <td>1997</td>
      <td>46022w1997.txt.gz</td>
    </tr>
    <tr>
      <th>1543</th>
      <td>46022</td>
      <td>1998</td>
      <td>46022w1998.txt.gz</td>
    </tr>
    <tr>
      <th>1544</th>
      <td>46022</td>
      <td>1999</td>
      <td>46022w1999.txt.gz</td>
    </tr>
    <tr>
      <th>1545</th>
      <td>46022</td>
      <td>2000</td>
      <td>46022w2000.txt.gz</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Select-years-of-interest">
<h3>Select years of interest<a class="headerlink" href="#Select-years-of-interest" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ndbc.available_data</span></code> function has returned a DataFrame with columns ‘id’, ‘year’, and ‘filename’. The year column is of type int while the filename and id (5 digit alpha-numeric specifier) are of type string. In this case, the years returned from <code class="docutils literal notranslate"><span class="pre">ndbc_available_data</span></code> span 1996 to the last complete year the buoy was operational (currently 2019 for 46022). For demonstration, we have decided we are interested in the data between the years 1996 and 2012 so we will create a new
<code class="docutils literal notranslate"><span class="pre">years_of_interest</span></code> DataFrame which only contains years less than 2013.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Slice the available data to only include through year 2012
years_of_interest = ndbc_available_data[ndbc_available_data.year &lt; 2013]
years_of_interest.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>year</th>
      <th>filename</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1541</th>
      <td>46022</td>
      <td>1996</td>
      <td>46022w1996.txt.gz</td>
    </tr>
    <tr>
      <th>1542</th>
      <td>46022</td>
      <td>1997</td>
      <td>46022w1997.txt.gz</td>
    </tr>
    <tr>
      <th>1543</th>
      <td>46022</td>
      <td>1998</td>
      <td>46022w1998.txt.gz</td>
    </tr>
    <tr>
      <th>1544</th>
      <td>46022</td>
      <td>1999</td>
      <td>46022w1999.txt.gz</td>
    </tr>
    <tr>
      <th>1545</th>
      <td>46022</td>
      <td>2000</td>
      <td>46022w2000.txt.gz</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Request-Data-from-NDBC">
<h3>Request Data from NDBC<a class="headerlink" href="#Request-Data-from-NDBC" title="Permalink to this heading"></a></h3>
<p>The filename column in our <code class="docutils literal notranslate"><span class="pre">years_of_interest</span></code> DataFrame and the parameter is needed to request the data. To get the data we can use the <code class="docutils literal notranslate"><span class="pre">ndbc.request_data</span></code> function to iterate over each buoy id and year in the passed DataFrame. This function will return the parameter data as a dictionary of DataFrames which may be accessed by buoy id and then the year for multiple buoys or just the year for a single buoy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Get dictionary of parameter data by year
filenames= years_of_interest[&#39;filename&#39;]
ndbc_requested_data = ndbc.request_data(parameter, filenames)
</pre></div>
</div>
</div>
</section>
<section id="Convert-the-DataFrames-to-DateTime-Index">
<h3>Convert the DataFrames to DateTime Index<a class="headerlink" href="#Convert-the-DataFrames-to-DateTime-Index" title="Permalink to this heading"></a></h3>
<p>The data returned for each year has a variable number of columns for the year, month, day, hour, minute, and the way the columns are formatted (this is a primary reason for return a dictionary of DataFrames indexed by years). A common step a user will want to take is to remove the inconsistent NDBC date/ time columns and create a standard DateTime index. The MHKiT function <code class="docutils literal notranslate"><span class="pre">ndbc.to_datetime_index</span></code> will perform this standardization by parsing the NDBC date/ time columns into DateTime format and
setting this as the DataFrame Index and removing the NDBC date/ time columns. This function operates on a DateFrame therefore we will iterate over each year of the <code class="docutils literal notranslate"><span class="pre">ndbc_requested_data</span></code> dictionary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Lastly we will convert a DateTime Index
ndbc_data={}
# Create a Datetime Index and remove NOAA date columns for each year
for year in ndbc_requested_data:
    year_data = ndbc_requested_data[year]
    ndbc_data[year] = ndbc.to_datetime_index(parameter, year_data)

# Display DataFrame of 46022 data from 1996
ndbc_data[&#39;1996&#39;].head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0.03</th>
      <th>0.04</th>
      <th>0.05</th>
      <th>0.06</th>
      <th>0.07</th>
      <th>0.08</th>
      <th>0.09</th>
      <th>0.10</th>
      <th>0.11</th>
      <th>0.12</th>
      <th>...</th>
      <th>0.31</th>
      <th>0.32</th>
      <th>0.33</th>
      <th>0.34</th>
      <th>0.35</th>
      <th>0.36</th>
      <th>0.37</th>
      <th>0.38</th>
      <th>0.39</th>
      <th>0.40</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1996-01-01 00:00:00</th>
      <td>0.0</td>
      <td>2.11</td>
      <td>27.49</td>
      <td>41.63</td>
      <td>27.23</td>
      <td>17.09</td>
      <td>8.61</td>
      <td>5.05</td>
      <td>3.73</td>
      <td>2.82</td>
      <td>...</td>
      <td>0.17</td>
      <td>0.16</td>
      <td>0.14</td>
      <td>0.15</td>
      <td>0.13</td>
      <td>0.09</td>
      <td>0.09</td>
      <td>0.08</td>
      <td>0.06</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>1996-01-01 01:00:00</th>
      <td>0.0</td>
      <td>1.20</td>
      <td>25.13</td>
      <td>57.69</td>
      <td>32.59</td>
      <td>11.75</td>
      <td>6.33</td>
      <td>4.16</td>
      <td>4.22</td>
      <td>2.98</td>
      <td>...</td>
      <td>0.22</td>
      <td>0.18</td>
      <td>0.20</td>
      <td>0.10</td>
      <td>0.12</td>
      <td>0.10</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>1996-01-01 02:00:00</th>
      <td>0.0</td>
      <td>0.90</td>
      <td>15.98</td>
      <td>48.98</td>
      <td>37.98</td>
      <td>23.56</td>
      <td>11.87</td>
      <td>6.80</td>
      <td>3.75</td>
      <td>3.00</td>
      <td>...</td>
      <td>0.14</td>
      <td>0.15</td>
      <td>0.20</td>
      <td>0.12</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.09</td>
      <td>0.07</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>1996-01-01 03:00:00</th>
      <td>0.0</td>
      <td>0.38</td>
      <td>14.73</td>
      <td>38.55</td>
      <td>34.99</td>
      <td>14.79</td>
      <td>9.23</td>
      <td>5.54</td>
      <td>4.43</td>
      <td>2.99</td>
      <td>...</td>
      <td>0.17</td>
      <td>0.20</td>
      <td>0.17</td>
      <td>0.14</td>
      <td>0.12</td>
      <td>0.09</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>0.06</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>1996-01-01 04:00:00</th>
      <td>0.0</td>
      <td>0.12</td>
      <td>22.77</td>
      <td>52.11</td>
      <td>34.88</td>
      <td>18.90</td>
      <td>13.36</td>
      <td>7.49</td>
      <td>2.94</td>
      <td>2.55</td>
      <td>...</td>
      <td>0.12</td>
      <td>0.11</td>
      <td>0.09</td>
      <td>0.13</td>
      <td>0.10</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.03</td>
      <td>0.03</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 38 columns</p>
</div></div>
</div>
</section>
</section>
<section id="2.-Calculate-H_{m0}-and-T_e-using-the-NDBC-Data">
<h2>2. Calculate <span class="math notranslate nohighlight">\(H_{m0}\)</span> and <span class="math notranslate nohighlight">\(T_e\)</span> using the NDBC Data<a class="headerlink" href="#2.-Calculate-H_{m0}-and-T_e-using-the-NDBC-Data" title="Permalink to this heading"></a></h2>
<p>A sea state may be characterized by significant wave height (Hm0) and energy period (Te). Using the historical spectral wave density data from NDBC, we can calculate these variables using MHKiT. Both Hm0 and Te return a single value for a given time (e.g. DateTime index). Currently, the data remains as a dictionary of DataFrames because the frequency binning (range and discretization) change across years of NDBC data. Once we have a single value for each DateTime we can combine all the data into
a single DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Intialize empty lists to store the results from each year
Hm0_list=[]
Te_list=[]

# Iterate over each year and save the result in the initalized dictionary
for year in ndbc_data:
    year_data = ndbc_data[year]
    Hm0_list.append(resource.significant_wave_height(year_data.T))
    Te_list.append(resource.energy_period(year_data.T))

# Concatenate list of Series into a single DataFrame
Te = pd.concat(Te_list ,axis=0)
Hm0 = pd.concat(Hm0_list ,axis=0)
Hm0_Te = pd.concat([Hm0,Te],axis=1)

# Drop any NaNs created from the calculation of Hm0 or Te
Hm0_Te.dropna(inplace=True)
# Sort the DateTime index
Hm0_Te.sort_index(inplace=True)
Hm0_Te
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hm0</th>
      <th>Te</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1996-01-01 00:00:00</th>
      <td>4.819627</td>
      <td>14.856398</td>
    </tr>
    <tr>
      <th>1996-01-01 01:00:00</th>
      <td>5.004158</td>
      <td>14.961679</td>
    </tr>
    <tr>
      <th>1996-01-01 02:00:00</th>
      <td>5.091169</td>
      <td>14.244618</td>
    </tr>
    <tr>
      <th>1996-01-01 03:00:00</th>
      <td>4.679487</td>
      <td>14.042246</td>
    </tr>
    <tr>
      <th>1996-01-01 04:00:00</th>
      <td>5.140895</td>
      <td>14.478961</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012-12-31 19:00:00</th>
      <td>1.995194</td>
      <td>14.757854</td>
    </tr>
    <tr>
      <th>2012-12-31 20:00:00</th>
      <td>1.976259</td>
      <td>14.360242</td>
    </tr>
    <tr>
      <th>2012-12-31 21:00:00</th>
      <td>2.658421</td>
      <td>15.708162</td>
    </tr>
    <tr>
      <th>2012-12-31 22:00:00</th>
      <td>2.364910</td>
      <td>15.247587</td>
    </tr>
    <tr>
      <th>2012-12-31 23:00:00</th>
      <td>2.056891</td>
      <td>14.328179</td>
    </tr>
  </tbody>
</table>
<p>125410 rows × 2 columns</p>
</div></div>
</div>
</section>
<section id="3.-Find-the-contour-line-for-the-100-year">
<h2>3. Find the contour line for the 100 year<a class="headerlink" href="#3.-Find-the-contour-line-for-the-100-year" title="Permalink to this heading"></a></h2>
<p>With the sea state data calculated, we can now use the modified I-FORM method to define reliability for a 100-year sea state based on the 17 years of spectral wave density data obtained from NDBC for buoy 46022. Reliability is the likelihood that a certain event will not occur in a given period. The period will define a line of constant probability in the joint probability of <span class="math notranslate nohighlight">\(H_{m0}\)</span> and <span class="math notranslate nohighlight">\(T_e\)</span> but individually each component different reliability (marginal distribution) which we can
find by evaluating a normal cumulative distribution function (CDF). This CDF returns each component’s quantiles along the iso-reliability line that finally allows us to calculate each sea state value (e.g. the 100-year contour values for Hm0 and Te).</p>
<p>For more detail on the environmental contour method used here please refer to: <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0029801815006721">Eckert-Gallup et. al 2016</a></p>
<p>To apply the <code class="docutils literal notranslate"><span class="pre">environmental_contours</span></code> function we will specify a 100-year sea state, the sea state data (Hm0, Te), and the time difference between measurements (dt in seconds).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Return period (years) of interest
period = 100

# Remove Hm0 Outliers
Hm0_Te_clean = Hm0_Te[Hm0_Te.Hm0 &lt; 20]

# Get only the values from the DataFrame
Hm0 = Hm0_Te_clean.Hm0.values
Te  = Hm0_Te_clean.Te.values

# Delta time of sea-states
dt = (Hm0_Te_clean.index[2]-Hm0_Te_clean.index[1]).seconds

# Get the contour values
copula = contours.environmental_contours(Hm0, Te, dt, period, &#39;PCA&#39;, return_PCA=True)
Hm0_contour=copula[&#39;PCA_x1&#39;]
Te_contour=copula[&#39;PCA_x2&#39;]
</pre></div>
</div>
</div>
</section>
<section id="4.-Plot-overlay-of-the-data-and-contour">
<h2>4. Plot overlay of the data and contour<a class="headerlink" href="#4.-Plot-overlay-of-the-data-and-contour" title="Permalink to this heading"></a></h2>
<p>Lastly we can use the MHKiT graphics module to create a contour plot which shows the data and resultant conotour line.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig,ax=plt.subplots(figsize=(8,4))
#%matplotlib inline
ax=graphics.plot_environmental_contour(Te, Hm0,
                                      Te_contour, Hm0_contour,
                                      data_label=&#39;NDBC 46022&#39;,
                                      contour_label=&#39;100 Year Contour&#39;,
                                      x_label = &#39;Energy Period, $Te$ [s]&#39;,
                                      y_label = &#39;Sig. wave height, $Hm0$ [m]&#39;,
                                      ax=ax)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/environmental_contours_example_15_0.png" src="_images/environmental_contours_example_15_0.png" />
</div>
</div>
</section>
<section id="Other-Contour-Methods">
<h2>Other Contour Methods<a class="headerlink" href="#Other-Contour-Methods" title="Permalink to this heading"></a></h2>
<p>MHKiT has parametric, nonparametric, and Kernel Density Estimation methods for calculating environmental contours housed within the <code class="docutils literal notranslate"><span class="pre">resource.environmental_contours</span></code> function. We can compare other copulas to our PCA method simply by adding more methods. A single string method can be applied if only one copula is of interest as was done above for the PCA method or multiple methods can be sent in using a list of strings. If mutiple methods of the same type are desired is recommended to run them
at the same time if possible as it will reduce the computational expense by utilizing the common computational calls across the copulas. In the example below we will compare the parametric and nonparametric Gaussain contours to the PCA method we ran previously.</p>
<p>We start by using the default settings for our Gaussian methods. The <code class="docutils literal notranslate"><span class="pre">environmental_contours</span></code> function returns a dictionary with component ‘x1’ and ‘x2’ for each method. E.g. if the <code class="docutils literal notranslate"><span class="pre">environmental_contours</span></code> function were called with the <code class="docutils literal notranslate"><span class="pre">'gaussian'</span></code> method then <code class="docutils literal notranslate"><span class="pre">environmental_contours</span></code> function would return a dictionary with keys <code class="docutils literal notranslate"><span class="pre">['gaussian_x1',</span> <span class="pre">'gaussian_x2']</span></code>. The copula methods are a generalized mathematical method and therefore ‘x1’ and ‘x2’ are used in place of Hm0 and Te for the
component values. ‘x1’ refers to the first array passed and ‘x2’ refers to the second array passed. In the example below ‘x1’ would refer to the Hm0 component of the coupla and ‘x2’ would refer to Te.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>copulas = contours.environmental_contours(Hm0, Te, dt, period, method=[&#39;gaussian&#39;, &#39;nonparametric_gaussian&#39;])

fig, ax = plt.subplots(figsize=(9,4))

Tes=[Te_contour]
Hm0s=[Hm0_contour]
methods=[&#39;gaussian&#39;, &#39;nonparametric_gaussian&#39;]
for method in methods:
    Hm0s.append(copulas[f&#39;{method}_x1&#39;])
    Tes.append(copulas[f&#39;{method}_x2&#39;])

ax = graphics.plot_environmental_contour(Te, Hm0,
                                         Tes, Hm0s,
                                         data_label=&#39;NDBC 46050&#39;,
                                         contour_label=[&#39;PCA&#39;,&#39;Gaussian&#39;, &#39;Nonparametric Gaussian&#39;],
                                         x_label = &#39;Energy Period, $Te$ [s]&#39;,
                                         y_label = &#39;Sig. wave height, $Hm0$ [m]&#39;,
                                         ax=ax)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/environmental_contours_example_17_0.png" src="_images/environmental_contours_example_17_0.png" />
</div>
</div>
</section>
<section id="Resource-Clusters">
<h2>Resource Clusters<a class="headerlink" href="#Resource-Clusters" title="Permalink to this heading"></a></h2>
<p>Often in resource characterization we want to pick a few representative sea state to run an alaysis. To do this with the resource data in python we reccomend using a Gaussian Mixture Model (a more generalized k-means clustering method). Using sckitlearn this is very straigth forward. We combine our Hm0 and Te data into an N x 2 numpy array. We specify our number of components (number of representative sea states) and then call the fit method on the data. Fianlly, using the methods <code class="docutils literal notranslate"><span class="pre">means_</span></code> and
<code class="docutils literal notranslate"><span class="pre">weights</span></code> we can organize the results into an easily digestable table.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Intialize empty lists to store the results from each year
Hm0_list=[]
Tp_list=[]

# Iterate over each year and save the result in the initalized dictionary
for year in ndbc_data:
    year_data = ndbc_data[year]
    Hm0_list.append(resource.significant_wave_height(year_data.T))
    Tp_list.append(resource.peak_period(year_data.T))

# Concatenate list of Series into a single DataFrame
Tp = pd.concat(Tp_list ,axis=0)
Hm0 = pd.concat(Hm0_list ,axis=0)
Hm0_Tp = pd.concat([Hm0,Tp],axis=1)

# Drop any NaNs created from the calculation of Hm0 or Te
Hm0_Tp.dropna(inplace=True)
# Sort the DateTime index
Hm0_Tp.sort_index(inplace=True)

# Remove Hm0 Outliers
Hm0_Tp_clean = Hm0_Tp[Hm0_Tp.Hm0 &lt; 20]
Hm0_Tp_clean = Hm0_Tp[Hm0_Tp.Tp &lt; 30]

# Get only the values from the DataFrame
Hm0 = Hm0_Tp_clean.Hm0.values
Tp  = Hm0_Tp_clean.Tp.values


Hm0_Tp
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hm0</th>
      <th>Tp</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1996-01-01 00:00:00</th>
      <td>4.819627</td>
      <td>16.666667</td>
    </tr>
    <tr>
      <th>1996-01-01 01:00:00</th>
      <td>5.004158</td>
      <td>16.666667</td>
    </tr>
    <tr>
      <th>1996-01-01 02:00:00</th>
      <td>5.091169</td>
      <td>16.666667</td>
    </tr>
    <tr>
      <th>1996-01-01 03:00:00</th>
      <td>4.679487</td>
      <td>16.666667</td>
    </tr>
    <tr>
      <th>1996-01-01 04:00:00</th>
      <td>5.140895</td>
      <td>16.666667</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012-12-31 19:00:00</th>
      <td>1.995194</td>
      <td>19.047619</td>
    </tr>
    <tr>
      <th>2012-12-31 20:00:00</th>
      <td>1.976259</td>
      <td>17.391304</td>
    </tr>
    <tr>
      <th>2012-12-31 21:00:00</th>
      <td>2.658421</td>
      <td>17.391304</td>
    </tr>
    <tr>
      <th>2012-12-31 22:00:00</th>
      <td>2.364910</td>
      <td>17.391304</td>
    </tr>
    <tr>
      <th>2012-12-31 23:00:00</th>
      <td>2.056891</td>
      <td>17.391304</td>
    </tr>
  </tbody>
</table>
<p>125426 rows × 2 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.mixture import GaussianMixture

# Compute Gaussian Mixture Model
X = np.vstack((Tp, Hm0)).T
gmm = GaussianMixture(n_components=8).fit(X)

# Save centers and weights
results = pd.DataFrame(gmm.means_, columns=[&#39;Tp&#39;,&#39;Hm0&#39;])
results[&#39;weights&#39;] = gmm.weights_
results
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tp</th>
      <th>Hm0</th>
      <th>weights</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11.836343</td>
      <td>2.451484</td>
      <td>0.289387</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9.435475</td>
      <td>2.361595</td>
      <td>0.167635</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.292837</td>
      <td>4.396167</td>
      <td>0.060054</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.567967</td>
      <td>2.707121</td>
      <td>0.075018</td>
    </tr>
    <tr>
      <th>4</th>
      <td>19.892300</td>
      <td>2.750065</td>
      <td>0.018447</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.940937</td>
      <td>1.431981</td>
      <td>0.101389</td>
    </tr>
    <tr>
      <th>6</th>
      <td>14.294940</td>
      <td>2.783162</td>
      <td>0.131494</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8.049692</td>
      <td>1.990576</td>
      <td>0.156575</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="Viewing-the-Clusters">
<h3>Viewing the Clusters<a class="headerlink" href="#Viewing-the-Clusters" title="Permalink to this heading"></a></h3>
<p>We can visually look at the clusters by predicting which cluster each datapoint belongs in. Then we can plot the means on top of this to show where each cluster is centered and how the data points are being catagorized.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Plot the Sections of Data
labels = gmm.predict(X)
plt.scatter(Tp, Hm0, c=labels, s=40)
plt.plot(results.Tp, results.Hm0, &#39;m+&#39;)
plt.xlabel(&#39;Peak Period, $Tp$ [s]&#39;)
plt.ylabel(&#39;Sig. wave height, $Hm0$ [m]&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Sig. wave height, $Hm0$ [m]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/environmental_contours_example_22_1.png" src="_images/environmental_contours_example_22_1.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="loads_example.html" class="btn btn-neutral float-left" title="MHKiT Loads Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wecsim_example.html" class="btn btn-neutral float-right" title="MHKiT WEC-Sim Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-164358105-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>