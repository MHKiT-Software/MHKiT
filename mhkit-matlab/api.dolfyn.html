

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-164358105-1');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DOLfYN &mdash; MHKiT v1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/mhkit.css?v=70d0d80f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d29a5c0e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="River Module" href="api.river.html" />
    <link rel="prev" title="Wave Module" href="api.wave.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MHKiT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">MHKiT-Python Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab_installation.html">MHKiT-MATLAB Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module.html">Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api.html#mhkit-python-api">MHKiT-Python API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api.html#mhkit-matlab-api">MHKiT-MATLAB API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.qc.html">QC Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.wave.html">Wave Module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">DOLfYN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-mhkit.dolfyn.io">IO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-mhkit.dolfyn.adp">ADP (Acoustic Doppler Profiler)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-mhkit.dolfyn.rotate">Rotate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-mhkit.dolfyn.tools">Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api.river.html">River Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.tidal.html">Tidal Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.power.html">Power Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.loads.html">Loads Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.utils.html">Utils Module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API Documentation</a></li>
      <li class="breadcrumb-item active">DOLfYN</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/mhkit-matlab/api.dolfyn.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dolfyn">
<span id="dolfyn-api-matlab"></span><h1>DOLfYN<a class="headerlink" href="#dolfyn" title="Link to this heading"></a></h1>
<p>The DOLfYN module contains a set of functions to analyze
binary Nortek or TRDI files. <strong>Instrument datafiles</strong> are
processed and returned as MATLAB structures.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>DOLfYN support within MHKiT-MATLAB is a work in progress. Please submit any issues or improvements to the <a class="reference external" href="https://github.com/MHKiT-Software/MHKiT-MATLAB/issues">MHKiT-MATLAB GitHub Repository</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The names of the functions below are of the convention <code class="docutils literal notranslate"><span class="pre">path.path.function</span></code>. Only the function name is used when calling the function in MATLAB. For example, to call on <code class="docutils literal notranslate"><span class="pre">mhkit.dolfyn.io.read_nortek</span></code> simply use <code class="docutils literal notranslate"><span class="pre">read_nortek</span></code>.</p>
</div>
<section id="module-mhkit.dolfyn.io">
<span id="io"></span><h2>IO<a class="headerlink" href="#module-mhkit.dolfyn.io" title="Link to this heading"></a></h2>
<p>The io submodule contains the following functions to read
binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or TRDI
(.000, .PD0, .ENX, etc.) data files.</p>
<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_h5">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_h5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_h5" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Read H5 data structure.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of NetCDF file to read.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – Structure from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_rdi">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_rdi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_rdi" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Read a TRDI binary data file.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of TRDI file to read.</p></li>
<li><p><strong>userdata</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">or</span> <span class="pre">string</span> <span class="pre">(optional)</span></code></span>) – true, false, or string of userdata.json filename (default true)
Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.%</p></li>
<li><p><strong>nens</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">nan,</span> <span class="pre">int,</span> <span class="pre">or</span> <span class="pre">2-element</span> <span class="pre">array</span> <span class="pre">(optional)</span></code></span>) – nan (default: read entire file), int, or 2-element tuple
(start, stop) Number of pings to read from the file.</p></li>
<li><p><strong>read_rdi(filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">call</span> <span class="pre">with</span> <span class="pre">options</span> <span class="pre">-&gt;</span></code></span>)</p></li>
<li><p><strong>'userdata'</strong></p></li>
<li><p><strong>false</strong></p></li>
<li><p><strong>'do_checksum'</strong></p></li>
<li><p><strong>true</strong></p></li>
<li><p><strong>'nens'</strong></p></li>
<li><p><strong>12)</strong></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – Structure from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat script">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.nortek_defs">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">nortek_defs</span></span><a class="headerlink" href="#mhkit.dolfyn.io.nortek_defs" title="Link to this definition"></a></dt>
<dd><p>Run this file to generate the nortek_defs.mat file</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_netcdf">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_netcdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_netcdf" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Read NetCDF data structure.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of NetCDF file to read.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – Structure from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.dolfyn_read">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">dolfyn_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.dolfyn_read" title="Link to this definition"></a></dt>
<dd><p>Read binary ADCP data files from Nortek or RDI instruments</p>
<p>This function reads binary ADCP data files in .VEC, .wpr, .ad2cp (Nortek)-
and .000, .PD0, .ENX, (RDI) formats into MATLAB structures that can be saved
as .nc files and used with MHKiT-MATLAB dolfyn ADCP analysis functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Path to instrument file to read</p></li>
<li><p><strong>userdata</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">logical</span> <span class="pre">or</span> <span class="pre">string,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Whether to read ‘&lt;base-filename&gt;.userdata.json’ file
- true: read userdata.json file (default)
- false: skip userdata.json file
- string: path to specific userdata.json file</p></li>
<li><p><strong>nens</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span> <span class="pre">or</span> <span class="pre">array,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Number of pings/ensembles to read
- nan: read entire file (default)
- scalar: read first N pings
- [start, stop]: read pings from start to stop</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – ADCP dataset structure containing:
ds.vel.data : Velocity data [range x time x beam] [m/s]
ds.coords : Coordinate information (time, range, beam)
ds.attrs : Instrument metadata and deployment information</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Read entire ADCP file, may be slow for large (&gt;1GB) files
ds = dolfyn_read(‘deployment.ad2cp’);</p>
<p>Read first 1000 ensembles without userdata
ds = dolfyn_read(‘deployment.ad2cp’, ‘userdata’, false, ‘nens’, 1000);</p>
<p>Read specific ensemble range
ds = dolfyn_read(‘deployment.ad2cp’, ‘nens’, [500, 1500]);</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_nortek">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_nortek</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_nortek" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Read a classic Nortek (AWAC and Vector) datafile</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of Nortek file to read.</p></li>
<li><p><strong>userdata</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">or</span> <span class="pre">string</span> <span class="pre">(optional)</span></code></span>) – true, false, or string of userdata.json filename (default true)
Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.</p></li>
<li><p><strong>do_checksum</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">(optional)</span></code></span>) – Whether to perform the checksum of each data block. (default
false)</p></li>
<li><p><strong>nens</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">nan,</span> <span class="pre">int,</span> <span class="pre">or</span> <span class="pre">2-element</span> <span class="pre">array</span> <span class="pre">(optional)</span></code></span>) – nan (default: read entire file), int, or 2-element tuple
(start, stop) Number of pings to read from the file.</p></li>
<li><p><strong>read_nortek(filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">call</span> <span class="pre">with</span> <span class="pre">options</span> <span class="pre">-&gt;</span></code></span>)</p></li>
<li><p><strong>'userdata'</strong></p></li>
<li><p><strong>false</strong></p></li>
<li><p><strong>'do_checksum'</strong></p></li>
<li><p><strong>true</strong></p></li>
<li><p><strong>'nens'</strong></p></li>
<li><p><strong>12)</strong></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – Structure from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_signature">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_signature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_signature" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Read a Nortek Signature (.ad2cp) datafile</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of Nortek file to read.</p></li>
<li><p><strong>userdata</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">or</span> <span class="pre">string</span> <span class="pre">(optional)</span></code></span>) – true, false, or string of userdata.json filename (default true)
Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.</p></li>
<li><p><strong>nens</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">nan,</span> <span class="pre">int,</span> <span class="pre">or</span> <span class="pre">2-element</span> <span class="pre">array</span> <span class="pre">(optional)</span></code></span>) – nan (default: read entire file), int, or 2-element tuple
(start, stop) Number of pings to read from the file.</p></li>
<li><p><strong>read_signature(filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">call</span> <span class="pre">with</span> <span class="pre">options</span> <span class="pre">-&gt;</span></code></span>)</p></li>
<li><p><strong>'userdata'</strong></p></li>
<li><p><strong>false</strong></p></li>
<li><p><strong>'nens'</strong></p></li>
<li><p><strong>12)</strong></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>structure</em>) – Structure from the binary instrument data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.read_userdata">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">read_userdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">userdata</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.read_userdata" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Reads a userdata.json file and returns the data it contains
as a structure</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of Nortek file to read.</p></li>
<li><p><strong>userdata</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">or</span> <span class="pre">string</span></code></span>) – true, false, or string of userdata.json filename</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>userdata</strong> (<em>structure</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.io.write_netcdf">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.io.</span></span><span class="sig-name descname"><span class="pre">write_netcdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">filename</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.io.write_netcdf" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Write Dolfyn data set to NetCDF data structure.
Updated for MATLAB R2022b and later versions.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – Structure from the binary instrument data</p></li>
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Filename of NetCDF file to read.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mhkit.dolfyn.adp">
<span id="adp-acoustic-doppler-profiler"></span><h2>ADP (Acoustic Doppler Profiler)<a class="headerlink" href="#module-mhkit.dolfyn.adp" title="Link to this heading"></a></h2>
<p>The ADP module contains routines for reading and working with
ADP/ADCP data. It contains:</p>
<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.adp.water_depth_from_pressure">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.</span></span><span class="sig-name descname"><span class="pre">water_depth_from_pressure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.adp.water_depth_from_pressure" title="Link to this definition"></a></dt>
<dd><p>Calculate water depth from pressure using seawater density</p>
<p>This function calculates the distance to the water surface using pressure
ADCP sensor data. Temperature and salinity are used to calculate seawater density,
which is then used with pressure data to calculate depth%</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – ADCP dataset structure containing pressure and temperature data
ds.pressure.data : Pressure measurements [dbar]
ds.temp.data : Temperature measurements [°C]
ds.attrs.h_deploy : Optional deployment height above seafloor [m]</p></li>
<li><p><strong>salinity</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Water salinity [psu] (default: 35)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>structure</em>) – Input dataset with added depth and density fields:
out.depth.data : Water depth measurements [m]
out.water_density.data : Seawater density [kg/m³]
out.depth.long_name : Descriptive name
out.depth.units : “m”</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.adp.correlation_filter">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.</span></span><span class="sig-name descname"><span class="pre">correlation_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.adp.correlation_filter" title="Link to this definition"></a></dt>
<dd><p>Filters out velocity data where correlation is below a
threshold in the beam correlation data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">Dataset</span></code></span>) – The adcp dataset to clean.</p></li>
<li><p><strong>thresh</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">numeric</span></code></span>) – The maximum value of correlation to screen, in counts or %, default is
50</p></li>
<li><p><strong>val</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">numeric</span></code></span>) – Value to set masked correlation data to, default is nan</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Velocity data with low correlation values set to <cite>val</cite></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Does not edit correlation or amplitude data.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.adp.remove_surface_interference">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.</span></span><span class="sig-name descname"><span class="pre">remove_surface_interference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.adp.remove_surface_interference" title="Link to this definition"></a></dt>
<dd><p>Mask the values of 3D data (vel, amp, corr, echo) that are beyond
the surface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">Dataset</span></code></span>) – The adcp dataset to clean</p></li>
<li><p><strong>val</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">nan</span> <span class="pre">or</span> <span class="pre">numeric</span></code></span>) – Specifies the value to set the bad values to (default nan).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>Dataset</em>) – The adcp dataset where relevant arrays with values greater than
<cite>depth</cite> are set to NaN</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Surface interference expected to happen at
distance &gt; range * cos(beam angle) - cell size</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.adp.set_range_offset">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.adp.</span></span><span class="sig-name descname"><span class="pre">set_range_offset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">h_deploy</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.adp.set_range_offset" title="Link to this definition"></a></dt>
<dd><p>Adds an instrument’s height above seafloor (for an up-facing instrument)
or depth below water surface (for a down-facing instrument) to the range
coordinate. Also adds an attribute to the Dataset with the current
“h_deploy” distance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">xarray.Dataset</span></code></span>) – The adcp dataset to ajust ‘range’ on</p></li>
<li><p><strong>h_deploy</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">numeric</span></code></span>) – Deployment location in the water column, in [m]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None, operates “in place”</em></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Center of bin 1 = h_deploy + blank_dist + cell_size</p>
<p>Nortek doesn’t take h_deploy into account, so the range that DOLfYN
calculates distance is from the ADCP transducers. TRDI asks for h_deploy
input in their deployment software and is thereby known by DOLfYN.</p>
<p>If the ADCP is mounted on a tripod on the seafloor, h_deploy will be
the height of the tripod +/- any extra distance to the transducer faces.
If the instrument is vessel-mounted, h_deploy is the distance between
the surface and downward-facing ADCP’s transducers.</p>
</dd></dl>

</section>
<section id="module-mhkit.dolfyn.rotate">
<span id="rotate"></span><h2>Rotate<a class="headerlink" href="#module-mhkit.dolfyn.rotate" title="Link to this heading"></a></h2>
<p>The rotate submodule contains tools to rotate a dataset
to different coordinate systems. When a file is read into
dolfyn, the data will be stored in the same coordinate
system it was saved in. The different coordinate systems
are “beam” &lt;-&gt; “inst” &lt;-&gt; “earth” &lt;-&gt; “principal”. “Beam”
and “inst” are manufacturer/instrument specific and refer
to the along-beam (either 3 or 4 beams) and instrument (XYZ)
reference frame. Instrument reference frames differ across
sensors, but the rotate code takes this into account when
rotating into the “earth” frame, defined as East-North-Up
(ENU). The earth frame can then be rotated to the principal
axes, defined as streamwise-cross_stream-vertical.</p>
<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.calc_tilt">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">calc_tilt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">pitch</span></em>, <em class="sig-param"><span class="pre">roll</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.calc_tilt" title="Link to this definition"></a></dt>
<dd><p>Calculate instrument tilt from pitch and roll angles.</p>
<p>This function calculates the total tilt angle of an ADCP instrument from
pitch and roll measurements. This function warns the user if the tilt is above 5°
as tilts above this threshold are likely to have a negative affect on the accuracy
of flow and turbulence calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pitch</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – time series of pitch angle (forward/backward tilt)</p></li>
<li><p><strong>roll</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – time series of roll angle (side-to-side tilt)</p></li>
<li><p><strong>units</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Units of input angles: ‘degrees’, ‘deg’, ‘radians’ or ‘rad’
Default: ‘degrees’</p></li>
<li><p><strong>output_units</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Units for output tilt: ‘degrees’, ‘deg’, ‘radians’ or ‘rad’
Default: same as input units</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tilt</strong> (<em>array</em>) – tilt angle in specified output units</p>
</dd>
</dl>
<section id="algorithm">
<h3>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading"></a></h3>
<p>tilt_rad = atan( √( tan(roll_rad)² + tan(pitch_rad)² ) )</p>
<p class="rubric">Example</p>
<p>% Calculate a time series of tilt from pitch and roll time series in degrees
tilt = calc_tilt(pitch_data, roll_data, ‘units’, ‘degrees’);</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Large tilts (&gt; 5°) can affect turbulence measurements</p></li>
<li><p>This function issues warnings for tilts &gt; 5°</p></li>
</ul>
</section>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.tensorproduct_core">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">tensorproduct_core</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">A</span></em>, <em class="sig-param"><span class="pre">B</span></em>, <em class="sig-param"><span class="pre">A_permute</span></em>, <em class="sig-param"><span class="pre">B_permute</span></em>, <em class="sig-param"><span class="pre">R_permute</span></em>, <em class="sig-param"><span class="pre">A_reshape</span></em>, <em class="sig-param"><span class="pre">B_reshape</span></em>, <em class="sig-param"><span class="pre">R_reshape</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.tensorproduct_core" title="Link to this definition"></a></dt>
<dd><p>Rearrangement of input</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.orient2euler">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">orient2euler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">omat</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.orient2euler" title="Link to this definition"></a></dt>
<dd><p>Calculate DOLfYN-defined euler angles from the orientation matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>omat</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – The orientation matrix</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>heading</strong> (<em>|ndarray|</em>) – The heading angle. Heading is defined as the direction the x-axis
points, positive clockwise from North (this is <em>opposite</em> the
right-hand-rule around the Z-axis), range 0-360 degrees.</p></li>
<li><p><strong>pitch</strong> (<em>ndarray</em>) – The pitch angle (degrees). Pitch is positive when the x-axis
pitches up (this is <em>opposite</em> the right-hand-rule around the
Y-axis).</p></li>
<li><p><strong>roll</strong> (<em>ndarray</em>) – The roll angle (degrees). Roll is positive according to the
right-hand-rule around the instrument’s x-axis.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.calc_omat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">calc_omat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hh</span></em>, <em class="sig-param"><span class="pre">pp</span></em>, <em class="sig-param"><span class="pre">rr</span></em>, <em class="sig-param"><span class="pre">orientation_down</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.calc_omat" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.calc_principal_heading">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">calc_principal_heading</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">vel</span></em>, <em class="sig-param"><span class="pre">tidal_mode</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.calc_principal_heading" title="Link to this definition"></a></dt>
<dd><p>Compute the principal angle of the horizontal velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – The 2D or 3D velocity array</p></li>
<li><p><strong>tidal_mode</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span></code></span>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>p_heading</strong> (<em>float or ndarray</em>) – The principal heading in degrees clockwise from North.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>When tidal_mode=True, this tool calculates the heading that is
aligned with the bidirectional flow. It does so following these
steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>rotates vectors with negative velocity by 180 degrees</p></li>
<li><p>then doubles those angles to make a complete circle again</p></li>
<li><p>computes a mean direction from this, and halves that angle
(to undo the doubled-angles in step 2)</p></li>
<li><p>The returned angle is forced to be between 0 and 180. So, you
may need to add 180 to this if you want your positive
direction to be in the western-half of the plane.</p></li>
</ol>
</div></blockquote>
<p>Otherwise, this function simply computes the average direction
using a vector method.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.inst2head">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">inst2head</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">advo</span></em>, <em class="sig-param"><span class="pre">reverse</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.inst2head" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.euler2orient">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">euler2orient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">heading</span></em>, <em class="sig-param"><span class="pre">pitch</span></em>, <em class="sig-param"><span class="pre">roll</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.euler2orient" title="Link to this definition"></a></dt>
<dd><p>For Nortek data only.
The heading, pitch, roll used here are from the Nortek binary files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>heading</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – Heading input is clockwise from North</p></li>
<li><p><strong>pitch</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>)</p></li>
<li><p><strong>roll</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>)</p></li>
<li><p><strong>units</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span> <span class="pre">(optional)</span></code></span>) – radians or degrees (default degrees)
Whether heading, pitch, and roll are in degrees or radians.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>omat</em> – a rotation matrix that rotates earth (ENU) -&gt; inst.
This is based on the Nortek <cite>Transforms.m</cite> file, available in
the refs folder.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.inst2earth">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">inst2earth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">advo</span></em>, <em class="sig-param"><span class="pre">reverse</span></em>, <em class="sig-param"><span class="pre">make</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.inst2earth" title="Link to this definition"></a></dt>
<dd><p>Rotate data in an ADV object to the earth from the instrument
frame (or vice-versa).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>advo</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">The</span> <span class="pre">adv</span> <span class="pre">object</span> <span class="pre">containing</span> <span class="pre">the</span> <span class="pre">data.</span></code></span>)</p></li>
<li><p><strong>reverse</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">(default:</span> <span class="pre">False)</span></code></span>) – If True, this function performs the inverse rotation
(earth-&gt;inst).</p></li>
<li><p><strong>make</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">char</span></code></span>) – awac, vector, signature, rdi</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.beam2inst">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">beam2inst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">dat</span></em>, <em class="sig-param"><span class="pre">reverse</span></em>, <em class="sig-param"><span class="pre">rmod</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.beam2inst" title="Link to this definition"></a></dt>
<dd><p>Rotate velocities from beam to instrument coordinates.</p>
<blockquote>
<div><dl class="simple">
<dt>dat<span class="classifier">The adv object containing the data.</span></dt><dd><p>The ADCP dataset</p>
</dd>
<dt>reverse<span class="classifier">bool</span></dt><dd><p>If True, this function performs the inverse rotation (inst-&gt;beam).</p>
</dd>
<dt>rmod: string</dt><dd><p>awac, vector, signature, rdi</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<hr class="docutils" />
<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.calc_orientmat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">calc_orientmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">adcpo</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.calc_orientmat" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Calculate the orientation matrix using the raw
heading, pitch, roll values from the RDI binary file.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adcpo</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">The</span> <span class="pre">ADP</span> <span class="pre">object</span> <span class="pre">containing</span> <span class="pre">the</span> <span class="pre">data.</span></code></span>)</p></li>
<li><p><strong>08</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">##</span> <span class="pre">RDI-ADCP-MANUAL</span> <span class="pre">(Jan</span></code></span>)</p></li>
<li><p><strong>18)</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">section</span> <span class="pre">5.6</span> <span class="pre">page</span></code></span>)</p></li>
<li><p><strong>same</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">The</span> <span class="pre">internal</span> <span class="pre">tilt</span> <span class="pre">sensors</span> <span class="pre">do</span> <span class="pre">not</span> <span class="pre">measure</span> <span class="pre">exactly</span> <span class="pre">the</span></code></span>)</p></li>
<li><p><strong>in</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">pitch</span> <span class="pre">as</span> <span class="pre">a</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">gimbals</span> <span class="pre">would</span> <span class="pre">(the</span> <span class="pre">roll</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">same).</span> <span class="pre">Only</span></code></span>)</p></li>
<li><p><strong>(EZxxx1xxx)</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">the</span> <span class="pre">case</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">internal</span> <span class="pre">pitch</span> <span class="pre">sensor</span> <span class="pre">being</span> <span class="pre">selected</span></code></span>)</p></li>
</ul>
</dd>
</dl>
<p>:param :
:param the measured pitch is modified using the following algorithm.: P = arctan[tan(Tilt1)*cos(Tilt2)]    (Equation 18)
:param Where:
:type Where: Tilt1 is the measured pitch from the internal sensor, and
:param Tilt2 is the measured roll from the internal sensor The raw pitch:
:param (Tilt 1) is recorded in the variable leader. P is set to 0 if the:
:param “use tilt” bit of the EX command is not set.”””:</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rotmat</strong> (<em>array</em>) – orientation matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.tensorproduct_initialize">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">tensorproduct_initialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ind_A</span></em>, <em class="sig-param"><span class="pre">ind_B</span></em>, <em class="sig-param"><span class="pre">ind_R</span></em>, <em class="sig-param"><span class="pre">sizeA</span></em>, <em class="sig-param"><span class="pre">sizeB</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.tensorproduct_initialize" title="Link to this definition"></a></dt>
<dd><p>TENSORPRODUCT_INITIALIZE
Part of the tensorproduct utility
Copyright 2021 - by David Codony, PhD (<a class="reference external" href="mailto:dcodony&#37;&#52;&#48;cimne&#46;upc&#46;edu">dcodony<span>&#64;</span>cimne<span>&#46;</span>upc<span>&#46;</span>edu</a>)
This software is distributed without any warranty.
Permission is granted for anyone to copy, use, or modify this
software for any uncommercial purposes, provided this copyright
notice is retained, and note is made of any changes that have
been made.
Assert empty inputs</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.quaternion2orient">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">quaternion2orient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">quaternions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.quaternion2orient" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Calculate orientation from Nortek AHRS quaternions, where</dt><dd><p>q = [W, X, Y, Z] instead of the standard
q = [X, Y, Z, W] = [q1, q2, q3, q4]</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>quaternions</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">Structure</span></code></span>) – Quaternion structure from the raw dataset</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>orientmat</strong> (<em>|ndarray|</em>) – The inst2earth rotation maxtrix as calculated from the
quaternions</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial.transform.Rotation</span></code></p>
</div>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.calc_beam_orientmat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">calc_beam_orientmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">theta</span></em>, <em class="sig-param"><span class="pre">convex</span></em>, <em class="sig-param"><span class="pre">degrees</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.calc_beam_orientmat" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Calculate the rotation matrix from beam coordinates to
instrument head coordinates for an RDI ADCP.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">is</span> <span class="pre">the</span> <span class="pre">angle</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">heads</span> <span class="pre">(usually</span> <span class="pre">20</span> <span class="pre">or</span> <span class="pre">30</span> <span class="pre">degrees)</span></code></span>)</p></li>
<li><p><strong>convex</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">is</span> <span class="pre">a</span> <span class="pre">flag</span> <span class="pre">for</span> <span class="pre">convex</span> <span class="pre">or</span> <span class="pre">concave</span> <span class="pre">head</span> <span class="pre">configuration.</span></code></span>)</p></li>
<li><p><strong>degrees</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">is</span> <span class="pre">a</span> <span class="pre">flag</span> <span class="pre">which</span> <span class="pre">specifies</span> <span class="pre">whether</span> <span class="pre">theta</span> <span class="pre">is</span> <span class="pre">in</span> <span class="pre">degrees</span></code></span>) – or radians (default: degrees=True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> (<em>array</em>) – orientation matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.set_declination">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">set_declination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_set</span></em>, <em class="sig-param"><span class="pre">declin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.set_declination" title="Link to this definition"></a></dt>
<dd><p>Set the magnetic declination</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>declination</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – The value of the magnetic declination in degrees (positive
values specify that Magnetic North is clockwise from True North)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>dataset structure</em>) – Dataset adjusted for the magnetic declination</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method modifies the data object in the following ways:</p>
<ul class="simple">
<li><p>If the dataset is in the <em>earth</em> reference frame at the time of
setting declination, it will be rotated into the “<em>True-East</em>,
<em>True-North</em>, Up” (hereafter, ETU) coordinate system</p></li>
<li><p>dat[‘orientmat’] is modified to be an ETU to
instrument (XYZ) rotation matrix (rather than the magnetic-ENU to
XYZ rotation matrix). Therefore, all rotations to/from the ‘earth’
frame will now be to/from this ETU coordinate system.</p></li>
<li><p>The value of the specified declination will be stored in
dat.attrs[‘declination’]</p></li>
<li><p>dat[‘heading’] is adjusted for declination
(i.e., it is relative to True North).</p></li>
<li><p>If dat.attrs[‘principal_heading’] is set, it is
adjusted to account for the orientation of the new ‘True’
earth coordinate system (i.e., calling set_declination on a
data object in the principal coordinate system, then calling
dat.rotate2(‘earth’) will yield a data object in the new
‘True’ earth coordinate system)</p></li>
</ul>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.set_inst2head_rotmat">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">set_inst2head_rotmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">rotmat</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.set_inst2head_rotmat" title="Link to this definition"></a></dt>
<dd><p>Set the instrument to head rotation matrix for cable head Nortek ADVs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rotmat</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – 3x3 rotation matrix</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>data_set</strong> (<em>structure</em>) – Dataset with rotation matrix applied</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.tensorproduct">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">tensorproduct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">A</span></em>, <em class="sig-param"><span class="pre">B</span></em>, <em class="sig-param"><span class="pre">subscripts)</span> <span class="pre">%ind_R</span></em>, <em class="sig-param"><span class="pre">A</span></em>, <em class="sig-param"><span class="pre">ind_A</span></em>, <em class="sig-param"><span class="pre">B</span></em>, <em class="sig-param"><span class="pre">ind_B</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.tensorproduct" title="Link to this definition"></a></dt>
<dd><p>TENSORPRODUCT Implementation of Einstein summation convention for
multidimensional matlab arrays, where repeated indices sum over.</p>
<dl>
<dt>Call:</dt><dd><p>R = tensorproduct(ind_R,A,ind_A,B,ind_B);</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>ind_R<span class="classifier">string with indices of the output</span></dt><dd><p>A : (non-empty) (multidimensional) matlab array</p>
</dd>
<dt>ind_A<span class="classifier">string with indices of array A</span></dt><dd><p>B : (non-empty) (multidimensional) matlab array</p>
</dd>
</dl>
<p>ind_B : string with indices of array B</p>
</dd>
</dl>
<p>Supports multiple:
- Outer products
- Inner products
- Singleton dimensions
- Pages</p>
<p>Does not support (yet):
- Self-contraction</p>
<p class="rubric">Example</p>
<p>A = rand(5, 1,4,8);
B = rand(4,10,5  );
R = tensorproduct(‘jzgi’,A,’gxki’,B,’kjg’); %     Outer: ‘i’,’j’</p>
<blockquote>
<div><p>%     Inner: ‘k’
%      Page: ‘g’
% Singleton: ‘x’,’z’
%  size(R) = [10,1,5,8]</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Provided indices in (ind_R), (ind_A) and (ind_B) are case-sensitive,
i.e. ‘a’ and ‘A’ are different indices.</p>
</div>
<dl>
<dt>Version compatibility:</dt><dd><p>This implementation makes use of Matlab built-in function pagemtimes,
introduced in Matlab version R2020b. To make use of this implementation
in previous Matlab releases, comment out the statement:</p>
<blockquote>
<div><p>R = pagemtimes(A,B);</p>
</div></blockquote>
<p>and uncomment the following lines:</p>
<blockquote>
<div><p>R = zeros(size(A,1),size(B,2),size(A,3));
for i = 1:size(A,3)</p>
<blockquote>
<div><p>R(:,:,i) = A(:,:,i) * B(:,:,i);</p>
</div></blockquote>
<p>end</p>
</div></blockquote>
<p>While it will still work, performance (wall-clock time) might be
degraded.</p>
</dd>
<dt>Benchmarking:</dt><dd><p>The performance of tensorproduct can be assessed by calling the
function tensorproduct_benchmark.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.earth2principal">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">earth2principal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">advo</span></em>, <em class="sig-param"><span class="pre">reverse</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.earth2principal" title="Link to this definition"></a></dt>
<dd><p>Rotate data in an ADV dataset to/from principal axes. Principal
heading must be within the dataset.</p>
<p>All data in the advo.attrs[‘rotate_vars’] list will be
rotated by the principal heading, and also if the data objet has an
orientation matrix (orientmat) it will be rotated so that it
represents the orientation of the ADV in the principal
(reverse:earth) frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>advo</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">The</span> <span class="pre">adv</span> <span class="pre">object</span> <span class="pre">containing</span> <span class="pre">the</span> <span class="pre">data.</span></code></span>)</p></li>
<li><p><strong>reverse</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span> <span class="pre">(default:</span> <span class="pre">False)</span></code></span>) – If True, this function performs the inverse rotation
(principal-&gt;earth).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.rotate.rotate2">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.rotate.</span></span><span class="sig-name descname"><span class="pre">rotate2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_set</span></em>, <em class="sig-param"><span class="pre">out_frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.rotate.rotate2" title="Link to this definition"></a></dt>
<dd><p>Rotate a dataset to a new coordinate system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">xr.Dataset</span></code></span>) – The dolfyn dataset (ADV or ADCP) to rotate.</p></li>
<li><p><strong>out_frame</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span> <span class="pre">{'beam',</span> <span class="pre">'inst',</span> <span class="pre">'earth',</span> <span class="pre">'principal'}</span></code></span>) – The coordinate system to rotate the data into.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The rotated dataset</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function rotates all variables in ds.attrs.rotate_vars</p>
</dd></dl>

</section>
<section id="module-mhkit.dolfyn.tools">
<span id="tools"></span><h2>Tools<a class="headerlink" href="#module-mhkit.dolfyn.tools" title="Link to this heading"></a></h2>
<p>The clean submodule contains basic quality control tools
specific to ADCP and ADVs.</p>
<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.dolfyn_psd_1D">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">dolfyn_psd_1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data</span></em>, <em class="sig-param"><span class="pre">n_fft</span></em>, <em class="sig-param"><span class="pre">fs</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.dolfyn_psd_1D" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Compute 1D power spectral density using Welch’s method</p>
<p>Uses same algorithm as MHKiT-MHKiT-Python psd_1D function</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – 1D ADCP velocity time series data (column vector) [m/s]</p></li>
<li><p><strong>n_fft</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Number of points in the FFT window [samples]</p></li>
<li><p><strong>fs</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Sample rate [Hz]</p></li>
<li><p><strong>window</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">char</span> <span class="pre">or</span> <span class="pre">double,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Window function {‘hann’, ‘hamming’, ‘rectwin’} or custom window vector (default: ‘hann’)</p></li>
<li><p><strong>step</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Step size for segment overlap (default: auto-calculated) [samples]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>psd</strong> (<em>double</em>) – Power spectral density [m^2/s^2/Hz]
Size: [n_freq x 1] where n_freq = floor(n_fft/2)
Frequencies correspond to positive frequencies only (DC component excluded)</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.dolfyn_select">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">dolfyn_select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_field</span></em>, <em class="sig-param"><span class="pre">coord_name</span></em>, <em class="sig-param"><span class="pre">target_value</span></em>, <em class="sig-param"><span class="pre">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.dolfyn_select" title="Link to this definition"></a></dt>
<dd><p>Select ADCP data along coordinates/dimensions with xarray-like functionality</p>
<p>This function provides data selection capabilities similar to xarray’s .sel() method,
enabling efficient selection of  velocity, range, time, or beam data along
specified coordinate dimensions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_field</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – <dl class="simple">
<dt>ADCP data structure containing:</dt><dd><p>.data : Velocity or other data array [varies]
.coords : Coordinate structure with dimension arrays</p>
</dd>
</dl>
</p></li>
<li><p><strong>coord_name</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Name of coordinate dimension to select along</p></li>
<li><p><strong>target_value</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Value(s) to select along coordinate (scalar or array)</p></li>
<li><p><strong>method</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Selection method: ‘exact’, ‘nearest’, ‘pad’, ‘ffill’, ‘backfill’, ‘bfill’
Default: ‘exact’</p></li>
<li><p><strong>tolerance</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Maximum distance for nearest method [same units as coordinate]
Default: Inf</p></li>
<li><p><strong>return_index</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">logical,</span> <span class="pre">optional</span> <span class="pre">(name-value)</span></code></span>) – Return indices instead of data (default: false)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>selected_data</strong> (<em>array or double</em>) – Selected data array or coordinate indices [same units as input data]</p></li>
<li><p><strong>selected_coords</strong> (<em>structure</em>) – Updated coordinate structure with selected coordinate values
.{coord_name} : Selected coordinate array [same units as input]</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.py_struct_2_bytes_format">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">py_struct_2_bytes_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">py_format</span></em>, <em class="sig-param"><span class="pre">size_only</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.py_struct_2_bytes_format" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.fill_time_gaps">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">fill_time_gaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">epoch</span></em>, <em class="sig-param"><span class="pre">sample_rate_hz</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.fill_time_gaps" title="Link to this definition"></a></dt>
<dd><p>Fill gaps (NaN values) in the timeseries by simple linear
interpolation.  The ends are extrapolated by stepping
forward/backward by 1/sample_rate_hz.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.calculate_horizontal_speed_and_direction">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">calculate_horizontal_speed_and_direction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.calculate_horizontal_speed_and_direction" title="Link to this definition"></a></dt>
<dd><p>Calculate horizontal speed and direction from velocity components</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – <dl class="simple">
<dt>Dolfyn data structure containing velocity data. Must include:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>vel: structure with fields:</dt><dd><ul>
<li><p>data: array with velocity components</p></li>
<li><p>dims: cell array of dimension names</p></li>
<li><dl class="simple">
<dt>coords: structure with coordinate information including:</dt><dd><ul>
<li><p>dir: cell array of direction labels (‘E’, ‘N’, ‘U1’, ‘U2’)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>attrs: structure with metadata</p></li>
<li><dl class="simple">
<dt>coord_sys: string</dt><dd><p>Coordinate system identifier (e.g., “earth”, “beam”, “inst”, “principal”)</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>ds_out</strong> (<em>structure</em>) –</p>
<dl>
<dt>Input structure with additional fields:</dt><dd><ul>
<li><dl class="simple">
<dt>U_mag: structure</dt><dd><ul class="simple">
<li><p>data: array of velocity magnitudes (m/s)</p></li>
<li><p>dims: cell array of dimension names (excluding dir)</p></li>
<li><p>coords: coordinate information</p></li>
<li><p>units: “m s-1”</p></li>
<li><p>standard_name: “sea_water_speed”</p></li>
<li><p>long_name: “Water Speed”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>U_dir: structure</dt><dd><ul class="simple">
<li><p>data: array of flow directions</p></li>
<li><p>dims: cell array of dimension names (excluding dir)</p></li>
<li><p>coords: coordinate information</p></li>
<li><dl class="simple">
<dt>units: “degrees_CW_from_[REF]” where [REF] depends on coord_sys:</dt><dd><ul>
<li><p>earth: “degrees_CW_from_N”</p></li>
<li><p>others: “degrees_CW_from_E” (or relevant streamwise component)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>standard_name: “sea_water_to_direction”</p></li>
<li><p>long_name: “Water Direction”</p></li>
</ul>
<p>Note: Direction is NaN where velocity magnitude is zero
Note: For earth coordinates, angles are CW from North [0, 360]</p>
<blockquote>
<div><p>For other coordinates, angles are CW from East/streamwise [0, 360]</p>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.dolfyn_plot">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">dolfyn_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">field</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.dolfyn_plot" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Plot fields from Dolfyn generated data structures</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – Structure from the binary instrument data</p></li>
<li><p><strong>field</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – field from ds to be plotted (ex: ‘vel’)</p></li>
<li><p><strong>dim</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">int</span> <span class="pre">or</span> <span class="pre">array</span> <span class="pre">(optional)</span></code></span>) – for higher dimension fields, which dimension(s) should be plotted
can be a single value or array (e.g., 1:3 or [1,3,5])</p></li>
<li><p><strong>plotArgs</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">cell</span> <span class="pre">array</span> <span class="pre">(optional)</span></code></span>) – Additional options to be passed to the plot function</p></li>
<li><p><strong>cbar_min</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span> <span class="pre">(optional)</span></code></span>) – Minimum value for colorbar in 3D plots</p></li>
<li><p><strong>cbar_max</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span> <span class="pre">(optional)</span></code></span>) – Maximum value for colorbar in 3D plots</p></li>
<li><p><strong>width</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span> <span class="pre">(optional)</span></code></span>) – Width of figure in pixels (default: 400 per column)</p></li>
<li><p><strong>height</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span> <span class="pre">(optional)</span></code></span>) – Height of figure in pixels (default: 300 per row)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.subtract_mean_from_dimension">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">subtract_mean_from_dimension</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_in</span></em>, <em class="sig-param"><span class="pre">dim</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.subtract_mean_from_dimension" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Subtract mean along specified dimension</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_in</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – Input data array</p></li>
<li><p><strong>dim</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Dimension index along which to subtract mean (typically time dimension)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>data_out</strong> (<em>array</em>) – Same dimensions as input data</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.set_coords">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">set_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">ref_frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.set_coords" title="Link to this definition"></a></dt>
<dd><p>Checks the current reference frame and adjusts xarray coords/dims
as necessary. Makes sure assigned dataarray coordinates match what
DOLfYN is reading in.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.fillgaps">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">fillgaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">a</span></em>, <em class="sig-param"><span class="pre">extrapFlg</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.fillgaps" title="Link to this definition"></a></dt>
<dd><p>Linearly fill NaN value in an array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – The array to be filled.</p></li>
<li><p><strong>extrapFlg</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">bool</span></code></span>) – Whether to extrapolate if NaNs are found at the ends of the
array.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function interpolates assuming spacing/timestep between
successive points is constant. If the spacing is not constant, use
interpgaps.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.bluewhitered">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">bluewhitered</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">m</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.bluewhitered" title="Link to this definition"></a></dt>
<dd><p>BLUEWHITERED   Blue, white, and red color map.
BLUEWHITERED(M) returns an M-by-3 matrix containing a blue to white
to red colormap, with white corresponding to the CAXIS value closest
to zero.  This colormap is most useful for images and surface plots
with positive and negative values.  BLUEWHITERED, by itself, is the
same length as the current colormap.</p>
<section id="examples">
<h3>Examples:<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<p>figure
imagesc(peaks(250));
colormap(bluewhitered(256)), colorbar</p>
<p>figure
imagesc(peaks(250), [0 8])
colormap(bluewhitered), colorbar</p>
<p>figure
imagesc(peaks(250), [-6 0])
colormap(bluewhitered), colorbar</p>
<p>figure
surf(peaks)
colormap(bluewhitered)
axis tight</p>
<p>See also HSV, HOT, COOL, BONE, COPPER, PINK, FLAG,
COLORMAP, RGBPLOT.</p>
</section>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.dolfyn_stepsize">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">dolfyn_stepsize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">l</span></em>, <em class="sig-param"><span class="pre">n_fft</span></em>, <em class="sig-param"><span class="pre">n_segments</span></em>, <em class="sig-param"><span class="pre">step</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.dolfyn_stepsize" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Calculate step size for overlapping FFT segments</p>
<p>Use same algorithm as MHKiT-Python _stepsize function</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Length of input data array [samples]</p></li>
<li><p><strong>n_fft</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double</span></code></span>) – Desired FFT window size [samples]</p></li>
<li><p><strong>n_segments</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double,</span> <span class="pre">optional</span></code></span>) – Number of overlapping segments (default: auto-calculated)</p></li>
<li><p><strong>step</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">double,</span> <span class="pre">optional</span></code></span>) – Step size between segments (default: auto-calculated) [samples]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>step</strong> (<em>double</em>) – Step size for segment overlap [samples]</p></li>
<li><p><strong>n_segments</strong> (<em>double</em>) – Number of overlapping segments [dimensionless]</p></li>
<li><p><strong>n_fft_used</strong> (<em>double</em>) – Actual FFT size used (may be reduced if l &lt; n_fft) [samples]</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.reshape_for_ensemble">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">reshape_for_ensemble</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data</span></em>, <em class="sig-param"><span class="pre">n_bin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.reshape_for_ensemble" title="Link to this definition"></a></dt>
<dd><p>Reshape dolfyn time series data into ensemble bins</p>
<p>This function takes continuous time series data and reshapes it into
ensemble bins, enabling calculation of statistics within each ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – Input data with time as the last dimension
Shape: (…, time)</p></li>
<li><p><strong>n_bin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Number of time points per ensemble bin</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>reshaped_data</strong> (<em>array</em>) – Reshaped data with ensemble structure
Shape: (…, n_ensembles, n_bin)
where n_ensembles = floor(time_length / n_bin)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Incomplete ensembles at the end are discarded</p></li>
<li><p>Time dimension must be last dimension of input data</p></li>
<li><p>Equivalent to MHKiT-Python: data[…, :length*n_bin].reshape(…, length, n_bin)</p></li>
</ul>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.create_dataset">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">create_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.create_dataset" title="Link to this definition"></a></dt>
<dd><p>Creates final dataset from structure created from binary readers.
It is meant to try and approximate an xarray dataset
Direction ‘dir’ coordinates get reset in <cite>set_coords</cite></p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="mhkit.dolfyn.tools.average_by_dimension">
<span class="sig-prename descclassname"><span class="pre">mhkit.dolfyn.tools.</span></span><span class="sig-name descname"><span class="pre">average_by_dimension</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ds</span></em>, <em class="sig-param"><span class="pre">n_samples</span></em>, <em class="sig-param"><span class="pre">dim_to_find</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mhkit.dolfyn.tools.average_by_dimension" title="Link to this definition"></a></dt>
<dd><p>Averages data along a specified dimension in a dataset structure</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">structure</span></code></span>) – <dl class="simple">
<dt>Dataset structure containing fields with:</dt><dd><p>.data: N-dimensional array of data
.dims: cell array of dimension names
.coords (optional): structure of coordinate data</p>
</dd>
</dl>
</p></li>
<li><p><strong>n_samples</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Number of samples to average together. Must be positive.
For uneven divisions, the function will use floor(dimension_length/n_samples)
complete bins and discard remaining samples.</p></li>
<li><p><strong>dim_to_find</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span> <span class="pre">(optional,</span> <span class="pre">default='time')</span></code></span>) – Name of the dimension along which to perform averaging.
Must exist in at least one field’s .dims array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>ds_out</strong> (<em>structure</em>) –</p>
<dl class="simple">
<dt>Output dataset with same structure as input but averaged data:</dt><dd><ul class="simple">
<li><p>Data arrays will have reduced size along averaged dimension</p></li>
<li><p>Coordinate arrays will be subsampled to match new data size</p></li>
<li><p>All other fields and dimensions remain unchanged</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>% Average every 2 time points
ds_averaged = average_by_dimension(ds, 2, ‘time’)</p>
<p>% Average every 5 points along spatial dimension
ds_averaged = average_by_dimension(ds, 5, ‘space’)</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>If n_samples doesn’t divide evenly into the dimension length,
the function will issue a warning and discard remaining samples</p></li>
<li><p>NaN values are handled appropriately in the averaging</p></li>
<li><p>Coordinates are subsampled rather than averaged</p></li>
</ul>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.wave.html" class="btn btn-neutral float-left" title="Wave Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.river.html" class="btn btn-neutral float-right" title="River Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Laboratory of the Rockies, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>